!function(){var t=class extends Error{constructor(t,e){super(t+(e?" caused by: "+e:"")),this.error=e,this.name=this.constructor.name,Error.captureStackTrace(this,this.constructor)}},e={ConnectionRefused:class extends t{constructor(t){super("Connection refused while attempting to connect to Persistr Server"+(t?" at "+t:""))}},Fetch:class extends t{constructor(t){super(t)}},InternalError:class extends t{constructor(t){super(t?"Internal error\nWhat went wrong:\n"+t.message:"Internal error")}},InvalidBearerToken:class extends t{constructor({bearer:t}){super("Invalid bearer token: "+t)}},InvalidCredentials:class extends t{constructor(){super("Invalid credentials")}},PersistrError:t,StatusCode:class extends t{constructor(t,e,n,r){let i=r;try{const t=JSON.parse(r);t&&t.error&&(i=""+t.error)}catch(o){}super(i),this.url=t,this.statusCode=e,this.statusText=n,this.responseText=r}},UnexpectedError:class extends t{constructor(t){super(t)}},UnsupportedFilter:class extends t{constructor({filter:t,on:e}){super(`Unsupported filter '${t}' on ${e}`)}},handle:function(t){return t().catch(t=>{if(t instanceof e.PersistrError)throw t;if(t&&t.error&&"ECONNREFUSED"===t.error.code)throw new e.ConnectionRefused;throw t})}},n=e,r={};(function(t){!function(){"use strict";r=function(e){return(e instanceof t?e:t.from(e.toString(),"binary")).toString("base64")}}()}).call(this,require("buffer").Buffer);var i={},o="undefined"!=typeof self?self:this,s=function(){function t(){this.fetch=!1,this.DOMException=o.DOMException}return t.prototype=o,new t}();!function(t){!function(e){var n="URLSearchParams"in t,r="Symbol"in t&&"iterator"in Symbol,i="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),o="FormData"in t,s="ArrayBuffer"in t;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(t){return t&&a.indexOf(Object.prototype.toString.call(t))>-1};function c(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function l(t){return"string"!=typeof t&&(t=String(t)),t}function h(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return r&&(e[Symbol.iterator]=function(){return e}),e}function f(t){this.map={},t instanceof f?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function d(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function p(t){return new Promise((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function y(t){var e=new FileReader,n=p(e);return e.readAsArrayBuffer(t),n}function m(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:i&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:o&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:n&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():s&&i&&(e=t)&&DataView.prototype.isPrototypeOf(e)?(this._bodyArrayBuffer=m(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(t)||u(t))?this._bodyArrayBuffer=m(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i&&(this.blob=function(){var t=d(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var t,e,n,r=d(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,n=p(e=new FileReader),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}f.prototype.append=function(t,e){t=c(t),e=l(e);var n=this.map[t];this.map[t]=n?n+", "+e:e},f.prototype.delete=function(t){delete this.map[c(t)]},f.prototype.get=function(t){return t=c(t),this.has(t)?this.map[t]:null},f.prototype.has=function(t){return this.map.hasOwnProperty(c(t))},f.prototype.set=function(t,e){this.map[c(t)]=l(e)},f.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},f.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),h(t)},f.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),h(t)},f.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),h(t)},r&&(f.prototype[Symbol.iterator]=f.prototype.entries);var g=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function _(t,e){var n,r,i=(e=e||{}).body;if(t instanceof _){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new f(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new f(e.headers)),this.method=(r=(n=e.method||this.method||"GET").toUpperCase(),g.indexOf(r)>-1?r:n),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function b(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}})),e}function w(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new f(e.headers),this.url=e.url||"",this._initBody(t)}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})},v.call(_.prototype),v.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},w.error=function(){var t=new w(null,{status:0,statusText:""});return t.type="error",t};var k=[301,302,303,307,308];w.redirect=function(t,e){if(-1===k.indexOf(e))throw new RangeError("Invalid status code");return new w(null,{status:e,headers:{location:t}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(E){e.DOMException=function(t,e){this.message=t,this.name=e;var n=Error(t);this.stack=n.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function O(t,n){return new Promise((function(r,o){var s=new _(t,n);if(s.signal&&s.signal.aborted)return o(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var t,e,n={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new f,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}})),e)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;r(new w(i,n))},a.onerror=function(){o(new TypeError("Network request failed"))},a.ontimeout=function(){o(new TypeError("Network request failed"))},a.onabort=function(){o(new e.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&i&&(a.responseType="blob"),s.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),s.signal&&(s.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",u)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}O.polyfill=!0,t.fetch||(t.fetch=O,t.Headers=f,t.Request=_,t.Response=w),e.Headers=f,e.Request=_,e.Response=w,e.fetch=O,Object.defineProperty(e,"__esModule",{value:!0})}({})}(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var a=s;function u(t){return Number.isInteger(t)&&t>=0}function c(t){this.name="ArgumentError",this.message=t}(i=a.fetch).default=a.fetch,i.fetch=a.fetch,i.Headers=a.Headers,i.Request=a.Request,i.Response=a.Response;const l=function(t,e){if(e=e||{},"function"!=typeof t)throw new c("fetch must be a function");if("object"!=typeof e)throw new c("defaults must be an object");if(void 0!==e.retries&&!u(e.retries))throw new c("retries must be a positive integer");if(void 0!==e.retryDelay&&!u(e.retryDelay)&&"function"!=typeof e.retryDelay)throw new c("retryDelay must be a positive integer or a function returning a positive integer");if(void 0!==e.retryOn&&!Array.isArray(e.retryOn)&&"function"!=typeof e.retryOn)throw new c("retryOn property expects an array or function");return e=Object.assign({retries:3,retryDelay:1e3,retryOn:[]},e),function(n,r){var i=e.retries,o=e.retryDelay,s=e.retryOn;if(r&&void 0!==r.retries){if(!u(r.retries))throw new c("retries must be a positive integer");i=r.retries}if(r&&void 0!==r.retryDelay){if(!u(r.retryDelay)&&"function"!=typeof r.retryDelay)throw new c("retryDelay must be a positive integer or a function returning a positive integer");o=r.retryDelay}if(r&&r.retryOn){if(!Array.isArray(r.retryOn)&&"function"!=typeof r.retryOn)throw new c("retryOn property expects an array or function");s=r.retryOn}return new Promise((function(e,a){var u=function(o){t(n,r).then((function(t){Array.isArray(s)&&-1===s.indexOf(t.status)?e(t):"function"==typeof s?s(o,null,t)?c(o,null,t):e(t):o<i?c(o,null,t):e(t)})).catch((function(t){"function"==typeof s?s(o,t,null)?c(o,t,null):a(t):o<i?c(o,t,null):a(t)}))};function c(t,e,n){var r="function"==typeof o?o(t,e,n):o;setTimeout((function(){u(++t)}),r)}u(0)}))}}(i=i,{retryOn:[503],retries:3,retryDelay:function(t,e,n){return Math.pow(7,t+1)}});function h(t){let e="";if(t&&Object.keys(t).length>0){const n=encodeURIComponent;e="?"+Object.entries(t).filter(t=>t[0]&&t[1]).map(t=>n(t[0])+"="+n(t[1])).join("&")}return e}var f={};function d(){this.jobs=Array.prototype.slice.call(arguments),this.running=!1}d.prototype={add:function(t){return t&&(arguments.length>1?this.jobs=this.jobs.concat(Array.prototype.slice.call(arguments)):this.jobs.push(t)),this},run:function(t){return this.add(t),this.running||this.start(),this},start:function(){this.running=!0,this.next(!1)},success:function(){this.next(!1)},fail:function(t){t=t||"Job failed",this.next(t)},next:function(t){if(this.jobs.length){var e=this.jobs.shift();try{e(t,this)}catch(n){this.next(n)}}else this.running=!1}},f=d;var p=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t},y={},m=Object.prototype.hasOwnProperty;function v(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return null}}y.stringify=function(t,e){e=e||"";var n,r,i=[];for(r in"string"!=typeof e&&(e="?"),t)if(m.call(t,r)){if((n=t[r])||null!=n&&!isNaN(n)||(n=""),r=encodeURIComponent(r),n=encodeURIComponent(n),null===r||null===n)continue;i.push(r+"="+n)}return i.length?e+i.join("&"):""},y.parse=function(t){for(var e,n=/([^=?&]+)=?([^&]*)/g,r={};e=n.exec(t);){var i=v(e[1]),o=v(e[2]);null===i||null===o||i in r||(r[i]=o)}return r};var g={};(function(t){"use strict";var e=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,n=/[\n\r\t]/g,r=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,i=/:\d+$/,o=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,s=/^[a-zA-Z]:/;function a(t){return(t||"").toString().replace(e,"")}var u=[["#","hash"],["?","query"],function(t,e){return h(e.protocol)?t.replace(/\\/g,"/"):t},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],c={hash:1,query:1};function l(e){var n,i=("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}).location||{},o={},s=typeof(e=e||i);if("blob:"===e.protocol)o=new d(unescape(e.pathname),{});else if("string"===s)for(n in o=new d(e,{}),c)delete o[n];else if("object"===s){for(n in e)n in c||(o[n]=e[n]);void 0===o.slashes&&(o.slashes=r.test(e.href))}return o}function h(t){return"file:"===t||"ftp:"===t||"http:"===t||"https:"===t||"ws:"===t||"wss:"===t}function f(t,e){t=(t=a(t)).replace(n,""),e=e||{};var r,i=o.exec(t),s=i[1]?i[1].toLowerCase():"",u=!!i[2],c=!!i[3],l=0;return u?c?(r=i[2]+i[3]+i[4],l=i[2].length+i[3].length):(r=i[2]+i[4],l=i[2].length):c?(r=i[3]+i[4],l=i[3].length):r=i[4],"file:"===s?l>=2&&(r=r.slice(2)):h(s)?r=i[4]:s?u&&(r=r.slice(2)):l>=2&&h(e.protocol)&&(r=i[4]),{protocol:s,slashes:u||h(s),slashesCount:l,rest:r}}function d(t,e,r){if(t=(t=a(t)).replace(n,""),!(this instanceof d))return new d(t,e,r);var i,o,c,m,v,g,_=u.slice(),b=typeof e,w=this,k=0;for("object"!==b&&"string"!==b&&(r=e,e=null),r&&"function"!=typeof r&&(r=y.parse),i=!(o=f(t||"",e=l(e))).protocol&&!o.slashes,w.slashes=o.slashes||i&&e.slashes,w.protocol=o.protocol||e.protocol||"",t=o.rest,("file:"===o.protocol&&(2!==o.slashesCount||s.test(t))||!o.slashes&&(o.protocol||o.slashesCount<2||!h(w.protocol)))&&(_[3]=[/(.*)/,"pathname"]);k<_.length;k++)"function"!=typeof(m=_[k])?(c=m[0],g=m[1],c!=c?w[g]=t:"string"==typeof c?~(v="@"===c?t.lastIndexOf(c):t.indexOf(c))&&("number"==typeof m[2]?(w[g]=t.slice(0,v),t=t.slice(v+m[2])):(w[g]=t.slice(v),t=t.slice(0,v))):(v=c.exec(t))&&(w[g]=v[1],t=t.slice(0,v.index)),w[g]=w[g]||i&&m[3]&&e[g]||"",m[4]&&(w[g]=w[g].toLowerCase())):t=m(t,w);r&&(w.query=r(w.query)),i&&e.slashes&&"/"!==w.pathname.charAt(0)&&(""!==w.pathname||""!==e.pathname)&&(w.pathname=function(t,e){if(""===t)return e;for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,i=n[r-1],o=!1,s=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),s++):s&&(0===r&&(o=!0),n.splice(r,1),s--);return o&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}(w.pathname,e.pathname)),"/"!==w.pathname.charAt(0)&&h(w.protocol)&&(w.pathname="/"+w.pathname),p(w.port,w.protocol)||(w.host=w.hostname,w.port=""),w.username=w.password="",w.auth&&(~(v=w.auth.indexOf(":"))?(w.username=w.auth.slice(0,v),w.username=encodeURIComponent(decodeURIComponent(w.username)),w.password=w.auth.slice(v+1),w.password=encodeURIComponent(decodeURIComponent(w.password))):w.username=encodeURIComponent(decodeURIComponent(w.auth)),w.auth=w.password?w.username+":"+w.password:w.username),w.origin="file:"!==w.protocol&&h(w.protocol)&&w.host?w.protocol+"//"+w.host:"null",w.href=w.toString()}d.prototype={set:function(t,e,n){var r=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(n||y.parse)(e)),r[t]=e;break;case"port":r[t]=e,p(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[t]="");break;case"hostname":r[t]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[t]=e,i.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!n;break;case"pathname":case"hash":if(e){var o="pathname"===t?"/":"#";r[t]=e.charAt(0)!==o?o+e:e}else r[t]=e;break;case"username":case"password":r[t]=encodeURIComponent(e);break;case"auth":var s=e.indexOf(":");~s?(r.username=e.slice(0,s),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(s+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var a=0;a<u.length;a++){var c=u[a];c[4]&&(r[c[1]]=r[c[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin="file:"!==r.protocol&&h(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r},toString:function(t){t&&"function"==typeof t||(t=y.stringify);var e,n=this,r=n.host,o=n.protocol;o&&":"!==o.charAt(o.length-1)&&(o+=":");var s=o+(n.protocol&&n.slashes||h(n.protocol)?"//":"");return n.username?(s+=n.username,n.password&&(s+=":"+n.password),s+="@"):n.password?(s+=":"+n.password,s+="@"):"file:"!==n.protocol&&h(n.protocol)&&!r&&"/"!==n.pathname&&(s+="@"),(":"===r[r.length-1]||i.test(n.hostname)&&!n.port)&&(r+=":"),s+=r+n.pathname,(e="object"==typeof n.query?t(n.query):n.query)&&(s+="?"!==e.charAt(0)?"?"+e:e),n.hash&&(s+=n.hash),s}},d.extractProtocol=f,d.location=l,d.trimLeft=a,d.qs=y,g=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var _={};function b(t){return"string"==typeof t&&(t=g(t)),t.protocol&&t.hostname?(t.protocol+"//"+t.host).toLowerCase():"null"}b.same=function(t,e){return b(t)===b(e)},_=b;var w={};(function(t,e){var n=require("url").parse,r=require("events"),i=require("https"),o=require("http"),s=require("util"),a=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],u=[239,187,191];function c(r,s){var f=c.CONNECTING;Object.defineProperty(this,"readyState",{get:function(){return f}}),Object.defineProperty(this,"url",{get:function(){return r}});var d,p=this;function y(t){f!==c.CLOSED&&(f=c.CONNECTING,O("error",new l("error",{message:t})),w&&(r=w,w=null),setTimeout((function(){f===c.CONNECTING&&k()}),p.reconnectInterval))}p.reconnectInterval=1e3;var m="";s&&s.headers&&s.headers["Last-Event-ID"]&&(m=s.headers["Last-Event-ID"],delete s.headers["Last-Event-ID"]);var v=!1,g="",b="",w=null;function k(){var h=n(r),g="https:"===h.protocol;if(h.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},m&&(h.headers["Last-Event-ID"]=m),s&&s.headers)for(var _ in s.headers){var b=s.headers[_];b&&(h.headers[_]=b)}if(h.rejectUnauthorized=!(s&&!s.rejectUnauthorized),s&&s.proxy){var C=n(s.proxy);g="https:"===C.protocol,h.protocol=g?"https:":"http:",h.path=r,h.headers.Host=h.host,h.hostname=C.hostname,h.host=C.host,h.port=C.port}if(s&&s.https)for(var x in s.https)if(-1!==a.indexOf(x)){var S=s.https[x];void 0!==S&&(h[x]=S)}s&&void 0!==s.withCredentials&&(h.withCredentials=s.withCredentials),(d=(g?i:o).request(h,(function(n){if(500===n.statusCode||502===n.statusCode||503===n.statusCode||504===n.statusCode)return O("error",new l("error",{status:n.statusCode,message:n.statusMessage})),void y();if(301===n.statusCode||307===n.statusCode)return n.headers.location?(307===n.statusCode&&(w=r),r=n.headers.location,void t.nextTick(k)):void O("error",new l("error",{status:n.statusCode,message:n.statusMessage}));if(200!==n.statusCode)return O("error",new l("error",{status:n.statusCode,message:n.statusMessage})),p.close();f=c.OPEN,n.on("close",(function(){n.removeAllListeners("close"),n.removeAllListeners("end"),y()})),n.on("end",(function(){n.removeAllListeners("close"),n.removeAllListeners("end"),y()})),O("open",new l("open"));var i,o=!0;n.on("data",(function(t){i=i?e.concat([i,t]):t,o&&function(t){return u.every((function(e,n){return t[n]===e}))}(i)&&(i=i.slice(u.length)),o=!1;for(var n=0,r=i.length;n<r;){v&&(10===i[n]&&++n,v=!1);for(var s,a=-1,c=-1,l=n;a<0&&l<r;++l)58===(s=i[l])?c<0&&(c=l-n):13===s?(v=!0,a=l-n):10===s&&(a=l-n);if(a<0)break;E(i,n,c,a),n+=a+1}n===r?i=void 0:n>0&&(i=i.slice(n))}))}))).on("error",(function(t){y(t.message)})),d.setNoDelay&&d.setNoDelay(!0),d.end()}function O(){p.listeners(arguments[0]).length>0&&p.emit.apply(p,arguments)}function E(t,e,n,i){if(0===i){if(g.length>0){var o=b||"message";O(o,new h(o,{data:g.slice(0,-1),lastEventId:m,origin:_(r)})),g=""}b=void 0}else if(n>0){var s,a=n<0,u=t.slice(e,e+(a?i:n)).toString();e+=s=a?i:32!==t[e+n+1]?n+1:n+2;var c=i-s,l=t.slice(e,e+c).toString();if("data"===u)g+=l+"\n";else if("event"===u)b=l;else if("id"===u)m=l;else if("retry"===u){var f=parseInt(l,10);Number.isNaN(f)||(p.reconnectInterval=f)}}}k(),this._close=function(){f!==c.CLOSED&&(f=c.CLOSED,d.abort&&d.abort(),d.xhr&&d.xhr.abort&&d.xhr.abort())}}function l(t,e){if(Object.defineProperty(this,"type",{writable:!1,value:t,enumerable:!0}),e)for(var n in e)e.hasOwnProperty(n)&&Object.defineProperty(this,n,{writable:!1,value:e[n],enumerable:!0})}function h(t,e){for(var n in Object.defineProperty(this,"type",{writable:!1,value:t,enumerable:!0}),e)e.hasOwnProperty(n)&&Object.defineProperty(this,n,{writable:!1,value:e[n],enumerable:!0})}w=c,s.inherits(c,r.EventEmitter),c.prototype.constructor=c,["open","error","message"].forEach((function(t){Object.defineProperty(c.prototype,"on"+t,{get:function(){var e=this.listeners(t)[0];return e?e._listener?e._listener:e:void 0},set:function(e){this.removeAllListeners(t),this.addEventListener(t,e)}})})),Object.defineProperty(c,"CONNECTING",{enumerable:!0,value:0}),Object.defineProperty(c,"OPEN",{enumerable:!0,value:1}),Object.defineProperty(c,"CLOSED",{enumerable:!0,value:2}),c.prototype.CONNECTING=0,c.prototype.OPEN=1,c.prototype.CLOSED=2,c.prototype.close=function(){this._close()},c.prototype.addEventListener=function(t,e){"function"==typeof e&&(e._listener=e,this.on(t,e))},c.prototype.dispatchEvent=function(t){if(!t.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(t.type,t.detail)},c.prototype.removeEventListener=function(t,e){"function"==typeof e&&(e._listener=void 0,this.removeListener(t,e))}}).call(this,require("_process"),require("buffer").Buffer);var k={exports:{}};(function(t,e,n){!function(t){if("object"==typeof k.exports)k.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;"undefined"!=typeof window?n=window:void 0!==e?n=e:"undefined"!=typeof self&&(n=self),n.Promise=t()}}((function(){return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof _dereq_&&_dereq_;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,(function(t){return i(e[s][1][t]||t)}),l,l.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof _dereq_&&_dereq_,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";e.exports=function(t){var e=t._SomePromiseArray;function n(t){var n=new e(t),r=n.promise();return n.setHowMany(1),n.setUnwrap(),n.init(),r}t.any=function(t){return n(t)},t.prototype.any=function(){return n(this)}}},{}],2:[function(e,n,r){"use strict";var i;try{throw new Error}catch(l){i=l}var o=e("./schedule"),s=e("./queue");function a(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new s(16),this._normalQueue=new s(16),this._haveDrainedQueues=!1;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=o}function u(t){for(;t.length()>0;)c(t)}function c(t){var e=t.shift();if("function"!=typeof e)e._settlePromises();else{var n=t.shift(),r=t.shift();e.call(n,r)}}a.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},a.prototype.hasCustomScheduler=function(){return this._customScheduler},a.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},a.prototype.fatalError=function(e,n){n?(t.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),t.exit(2)):this.throwLater(e)},a.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout((function(){t(e)}),0);else try{this._schedule((function(){t(e)}))}catch(l){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},a.prototype.invokeLater=function(t,e,n){this._lateQueue.push(t,e,n),this._queueTick()},a.prototype.invoke=function(t,e,n){this._normalQueue.push(t,e,n),this._queueTick()},a.prototype.settlePromises=function(t){this._normalQueue._pushOne(t),this._queueTick()},a.prototype._drainQueues=function(){u(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,u(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},n.exports=a,n.exports.firstLineError=i},{"./queue":26,"./schedule":29}],3:[function(t,e,n){"use strict";e.exports=function(t,e,n,r){var i=!1,o=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(o,o,null,this,t)},a=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},u=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(o){i||(i=!0,t.prototype._propagateFrom=r.propagateFromFunction(),t.prototype._boundValue=r.boundValueFunction());var c=n(o),l=new t(e);l._propagateFrom(this,1);var h=this._target();if(l._setBoundTo(c),c instanceof t){var f={promiseRejectionQueued:!1,promise:l,target:h,bindingPromise:c};h._then(e,s,void 0,l,f),c._then(a,u,void 0,l,f),l._setOnCancel(c)}else l._resolveCallback(h);return l},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,n){return t.resolve(n).bind(e)}}},{}],4:[function(t,e,n){"use strict";var r;"undefined"!=typeof Promise&&(r=Promise);var i=t("./promise")();i.noConflict=function(){try{Promise===i&&(Promise=r)}catch(t){}return i},e.exports=i},{"./promise":22}],5:[function(t,e,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}e.exports=function(e){var n=t("./util"),r=n.canEvaluate;function i(t){return function(t,r){var i;if(null!=t&&(i=t[r]),"function"!=typeof i){var o="Object "+n.classString(t)+" has no method '"+n.toString(r)+"'";throw new e.TypeError(o)}return i}(t,this.pop()).apply(t,this)}function o(t){return t[this]}function s(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}n.isIdentifier,e.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(i,void 0,void 0,e,void 0)},e.prototype.get=function(t){var e;if("number"==typeof t)e=s;else if(r){var n=(void 0)(t);e=null!==n?n:o}else e=o;return this._then(e,void 0,void 0,t,void 0)}}},{"./util":36}],6:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){var o=t("./util"),s=o.tryCatch,a=o.errorObj,u=e._async;e.prototype.break=e.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var n=t._cancellationParent;if(null==n||!n._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(t,e){if(o.isArray(t))for(var n=0;n<t.length;++n)this._doInvokeOnCancel(t[n],e);else if(void 0!==t)if("function"==typeof t){if(!e){var r=s(t).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),u.throwLater(r.e))}}else t._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,t)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(t,e,n){"use strict";e.exports=function(e){var n=t("./util"),r=t("./es5").keys,i=n.tryCatch,o=n.errorObj;return function(t,s,a){return function(u){var c=a._boundValue();t:for(var l=0;l<t.length;++l){var h=t[l];if(h===Error||null!=h&&h.prototype instanceof Error){if(u instanceof h)return i(s).call(c,u)}else if("function"==typeof h){var f=i(h).call(c,u);if(f===o)return f;if(f)return i(s).call(c,u)}else if(n.isObject(u)){for(var d=r(h),p=0;p<d.length;++p){var y=d[p];if(h[y]!=u[y])continue t}return i(s).call(c,u)}}return e}}}},{"./es5":13,"./util":36}],8:[function(t,e,n){"use strict";e.exports=function(t){var e=!1,n=[];function r(){this._trace=new r.CapturedTrace(i())}function i(){var t=n.length-1;if(t>=0)return n[t]}return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},r.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,n.push(this._trace))},r.prototype._popContext=function(){if(void 0!==this._trace){var t=n.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},r.CapturedTrace=null,r.create=function(){if(e)return new r},r.deactivateLongStackTraces=function(){},r.activateLongStackTraces=function(){var n=t.prototype._pushContext,o=t.prototype._popContext,s=t._peekContext,a=t.prototype._peekContext,u=t.prototype._promiseCreated;r.deactivateLongStackTraces=function(){t.prototype._pushContext=n,t.prototype._popContext=o,t._peekContext=s,t.prototype._peekContext=a,t.prototype._promiseCreated=u,e=!1},e=!0,t.prototype._pushContext=r.prototype._pushContext,t.prototype._popContext=r.prototype._popContext,t._peekContext=t.prototype._peekContext=i,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},r}},{}],9:[function(e,n,r){"use strict";n.exports=function(n,r,i,o){var s,a,u,c,l=n._async,h=e("./errors").Warning,f=e("./util"),d=e("./es5"),p=f.canAttachTrace,y=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,m=/\((?:timers\.js):\d+:\d+\)/,v=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,g=null,_=null,b=!1,w=!(0==f.env("BLUEBIRD_DEBUG")),k=!(0==f.env("BLUEBIRD_WARNINGS")||!w&&!f.env("BLUEBIRD_WARNINGS")),O=!(0==f.env("BLUEBIRD_LONG_STACK_TRACES")||!w&&!f.env("BLUEBIRD_LONG_STACK_TRACES")),E=0!=f.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(k||!!f.env("BLUEBIRD_W_FORGOTTEN_RETURN"));!function(){var t=[];function e(){for(var e=0;e<t.length;++e)t[e]._notifyUnhandledRejection();r()}function r(){t.length=0}c=function(n){t.push(n),setTimeout(e,1)},d.defineProperty(n,"_unhandledRejectionCheck",{value:e}),d.defineProperty(n,"_unhandledRejectionClear",{value:r})}(),n.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},n.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),c(this))},n.prototype._notifyUnhandledRejectionIsHandled=function(){G("rejectionHandled",s,void 0,this)},n.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},n.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),G("unhandledRejection",a,t,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},n.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},n.prototype._warn=function(t,e,n){return H(t,e,n||this)},n.onPossiblyUnhandledRejection=function(t){var e=n._getContext();a=f.contextBind(e,t)},n.onUnhandledRejectionHandled=function(t){var e=n._getContext();s=f.contextBind(e,t)};var C=function(){};n.longStackTraces=function(){if(l.haveItemsQueued()&&!nt.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!nt.longStackTraces&&Q()){var t=n.prototype._captureStackTrace,e=n.prototype._attachExtraTrace,i=n.prototype._dereferenceTrace;nt.longStackTraces=!0,C=function(){if(l.haveItemsQueued()&&!nt.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");n.prototype._captureStackTrace=t,n.prototype._attachExtraTrace=e,n.prototype._dereferenceTrace=i,r.deactivateLongStackTraces(),nt.longStackTraces=!1},n.prototype._captureStackTrace=U,n.prototype._attachExtraTrace=q,n.prototype._dereferenceTrace=z,r.activateLongStackTraces()}},n.hasLongStackTraces=function(){return nt.longStackTraces&&Q()};var x={unhandledrejection:{before:function(){var t=f.global.onunhandledrejection;return f.global.onunhandledrejection=null,t},after:function(t){f.global.onunhandledrejection=t}},rejectionhandled:{before:function(){var t=f.global.onrejectionhandled;return f.global.onrejectionhandled=null,t},after:function(t){f.global.onrejectionhandled=t}}},S=function(){var t=function(t,e){if(!t)return!f.global.dispatchEvent(e);var n;try{return n=t.before(),!f.global.dispatchEvent(e)}finally{t.after(n)}};try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return f.global.dispatchEvent(e),function(e,n){e=e.toLowerCase();var r=new CustomEvent(e,{detail:n,cancelable:!0});return d.defineProperty(r,"promise",{value:n.promise}),d.defineProperty(r,"reason",{value:n.reason}),t(x[e],r)}}return"function"==typeof Event?(e=new Event("CustomEvent"),f.global.dispatchEvent(e),function(e,n){e=e.toLowerCase();var r=new Event(e,{cancelable:!0});return r.detail=n,d.defineProperty(r,"promise",{value:n.promise}),d.defineProperty(r,"reason",{value:n.reason}),t(x[e],r)}):((e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),f.global.dispatchEvent(e),function(e,n){e=e.toLowerCase();var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!1,!0,n),t(x[e],r)})}catch(n){}return function(){return!1}}(),j=f.isNode?function(){return t.emit.apply(t,arguments)}:f.global?function(t){var e="on"+t.toLowerCase(),n=f.global[e];return!!n&&(n.apply(f.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function T(t,e){return{promise:e}}var A={promiseCreated:T,promiseFulfilled:T,promiseRejected:T,promiseResolved:T,promiseCancelled:T,promiseChained:function(t,e,n){return{promise:e,child:n}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,n){return{reason:e,promise:n}},rejectionHandled:T},F=function(t){var e=!1;try{e=j.apply(null,arguments)}catch(r){l.throwLater(r),e=!0}var n=!1;try{n=S(t,A[t].apply(null,arguments))}catch(r){l.throwLater(r),n=!0}return n||e};function N(){return!1}function D(t,e,n){var r=this;try{t(e,n,(function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+f.toString(t));r._attachCancellationCallback(t)}))}catch(i){return i}}function I(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?f.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function M(){return this._onCancelField}function R(t){this._onCancelField=t}function P(){this._cancellationParent=void 0,this._onCancelField=void 0}function L(t,e){if(0!=(1&e)){this._cancellationParent=t;var n=t._branchesRemainingToCancel;void 0===n&&(n=0),t._branchesRemainingToCancel=n+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}n.config=function(t){if("longStackTraces"in(t=Object(t))&&(t.longStackTraces?n.longStackTraces():!t.longStackTraces&&n.hasLongStackTraces()&&C()),"warnings"in t){var e=t.warnings;nt.warnings=!!e,E=nt.warnings,f.isObject(e)&&"wForgottenReturn"in e&&(E=!!e.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!nt.cancellation){if(l.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");n.prototype._clearCancellationData=P,n.prototype._propagateFrom=L,n.prototype._onCancel=M,n.prototype._setOnCancel=R,n.prototype._attachCancellationCallback=I,n.prototype._execute=D,$=L,nt.cancellation=!0}if("monitoring"in t&&(t.monitoring&&!nt.monitoring?(nt.monitoring=!0,n.prototype._fireEvent=F):!t.monitoring&&nt.monitoring&&(nt.monitoring=!1,n.prototype._fireEvent=N)),"asyncHooks"in t&&f.nodeSupportsAsyncResource){var r=nt.asyncHooks,s=!!t.asyncHooks;r!==s&&(nt.asyncHooks=s,s?i():o())}return n},n.prototype._fireEvent=N,n.prototype._execute=function(t,e,n){try{t(e,n)}catch(r){return r}},n.prototype._onCancel=function(){},n.prototype._setOnCancel=function(t){},n.prototype._attachCancellationCallback=function(t){},n.prototype._captureStackTrace=function(){},n.prototype._attachExtraTrace=function(){},n.prototype._dereferenceTrace=function(){},n.prototype._clearCancellationData=function(){},n.prototype._propagateFrom=function(t,e){};var $=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)};function V(){var t=this._boundTo;return void 0!==t&&t instanceof n?t.isFulfilled()?t.value():void 0:t}function U(){this._trace=new tt(this._peekContext())}function q(t,e){if(p(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var r=Z(t);f.notEnumerableProp(t,"stack",r.message+"\n"+r.stack.join("\n")),f.notEnumerableProp(t,"__stackCleaned__",!0)}}}function z(){this._trace=void 0}function H(t,e,r){if(nt.warnings){var i,o=new h(t);if(e)r._attachExtraTrace(o);else if(nt.longStackTraces&&(i=n._peekContext()))i.attachExtraTrace(o);else{var s=Z(o);o.stack=s.message+"\n"+s.stack.join("\n")}F("warning",o)||W(o,"",!0)}}function B(t){for(var e=[],n=0;n<t.length;++n){var r=t[n],i="    (No stack trace)"===r||g.test(r),o=i&&Y(r);i&&!o&&(b&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function Z(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&e.length>0?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var r=e[n];if("    (No stack trace)"===r||g.test(r))break}return n>0&&"SyntaxError"!=t.name&&(e=e.slice(n)),e}(t):["    (No stack trace)"],{message:n,stack:"SyntaxError"==t.name?e:B(e)}}function W(t,e,n){if("undefined"!=typeof console){var r;if(f.isObject(t)){var i=t.stack;r=e+_(i,t)}else r=e+String(t);"function"==typeof u?u(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function G(t,e,n,r){var i=!1;try{"function"==typeof e&&(i=!0,"rejectionHandled"===t?e(r):e(n,r))}catch(o){l.throwLater(o)}"unhandledRejection"===t?F(t,n,r)||i||W(n,"Unhandled rejection "):F(t,r)}function J(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{if(e=t&&"function"==typeof t.toString?t.toString():f.toString(t),/\[object [a-zA-Z0-9$_]+\]/.test(e))try{e=JSON.stringify(t)}catch(n){}0===e.length&&(e="(empty array)")}return"(<"+function(t){return t.length<41?t:t.substr(0,38)+"..."}(e)+">, no stack trace)"}function Q(){return"function"==typeof et}var Y=function(){return!1},X=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function K(t){var e=t.match(X);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function tt(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);et(this,tt),e>32&&this.uncycle()}f.inherits(tt,Error),r.CapturedTrace=tt,tt.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],n={},r=0,i=this;void 0!==i;++r)e.push(i),i=i._parent;for(r=(t=this._length=r)-1;r>=0;--r){var o=e[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<t;++r){var s=n[e[r].stack];if(void 0!==s&&s!==r){s>0&&(e[s-1]._parent=void 0,e[s-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var a=r>0?e[r-1]:this;s<t-1?(a._parent=e[s+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var u=a._length+1,c=r-2;c>=0;--c)e[c]._length=u,u++;return}}}},tt.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=Z(t),n=e.message,r=[e.stack],i=this;void 0!==i;)r.push(B(i.stack.split("\n"))),i=i._parent;!function(t){for(var e=t[0],n=1;n<t.length;++n){for(var r=t[n],i=e.length-1,o=e[i],s=-1,a=r.length-1;a>=0;--a)if(r[a]===o){s=a;break}for(a=s;a>=0;--a){var u=r[a];if(e[i]!==u)break;e.pop(),i--}e=r}}(r),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(r),f.notEnumerableProp(t,"stack",function(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}(n,r)),f.notEnumerableProp(t,"__stackCleaned__",!0)}};var et=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():J(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,g=t,_=e;var n=Error.captureStackTrace;return Y=function(t){return y.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var r,i=new Error;if("string"==typeof i.stack&&i.stack.split("\n")[0].indexOf("stackDetection@")>=0)return g=/@/,_=e,b=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(o){r="stack"in o}return"stack"in i||!r||"number"!=typeof Error.stackTraceLimit?(_=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?J(e):e.toString()},null):(g=t,_=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(o){t.stack=o.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(u=function(t){console.warn(t)},f.isNode&&t.stderr.isTTY?u=function(t,e){var n=e?"\x1b[33m":"\x1b[31m";console.warn(n+t+"\x1b[0m\n")}:f.isNode||"string"!=typeof(new Error).stack||(u=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var nt={warnings:k,longStackTraces:!1,cancellation:!1,monitoring:!1,asyncHooks:!1};return O&&n.longStackTraces(),{asyncHooks:function(){return nt.asyncHooks},longStackTraces:function(){return nt.longStackTraces},warnings:function(){return nt.warnings},cancellation:function(){return nt.cancellation},monitoring:function(){return nt.monitoring},propagateFromFunction:function(){return $},boundValueFunction:function(){return V},checkForgottenReturns:function(t,e,n,r,i){if(void 0===t&&null!==e&&E){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",s="";if(e._trace){for(var a=e._trace.stack.split("\n"),u=B(a),c=u.length-1;c>=0;--c){var l=u[c];if(!m.test(l)){var h=l.match(v);h&&(o="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(u.length>0){var f=u[0];for(c=0;c<a.length;++c)if(a[c]===f){c>0&&(s="\n"+a[c-1]);break}}}var d="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(d,!0,e)}},setBounds:function(t,e){if(Q()){for(var n,r,i=(t.stack||"").split("\n"),o=(e.stack||"").split("\n"),s=-1,a=-1,u=0;u<i.length;++u)if(c=K(i[u])){n=c.fileName,s=c.line;break}for(u=0;u<o.length;++u){var c;if(c=K(o[u])){r=c.fileName,a=c.line;break}}s<0||a<0||!n||!r||n!==r||s>=a||(Y=function(t){if(y.test(t))return!0;var e=K(t);return!!(e&&e.fileName===n&&s<=e.line&&e.line<=a)})}},warn:H,deprecated:function(t,e){var n=t+" is deprecated and will be removed in a future version.";return e&&(n+=" Use "+e+" instead."),H(n)},CapturedTrace:tt,fireDomEvent:S,fireGlobalEvent:j}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(t,e,n){"use strict";e.exports=function(t){function e(){return this.value}function n(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(n){return n instanceof t&&n.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:n},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(n,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:t},void 0);var e=arguments[1];return this.caught(t,(function(){throw e}))},t.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof t&&n.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:n},void 0);var r=arguments[1];return r instanceof t&&r.suppressUnhandledRejections(),this.caught(n,(function(){return r}))}}},{}],11:[function(t,e,n){"use strict";e.exports=function(t,e){var n=t.reduce,r=t.all;function i(){return r(this)}t.prototype.each=function(t){return n(this,t,e,0)._then(i,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return n(this,t,e,e)},t.each=function(t,r){return n(t,r,e,0)._then(i,void 0,void 0,t,void 0)},t.mapSeries=function(t,r){return n(t,r,e,e)}}},{}],12:[function(t,e,n){"use strict";var r,i,o=t("./es5"),s=o.freeze,a=t("./util"),u=a.inherits,c=a.notEnumerableProp;function l(t,e){function n(r){if(!(this instanceof n))return new n(r);c(this,"message","string"==typeof r?r:e),c(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return u(n,Error),n}var h=l("Warning","warning"),f=l("CancellationError","cancellation error"),d=l("TimeoutError","timeout error"),p=l("AggregateError","aggregate error");try{r=TypeError,i=RangeError}catch(b){r=l("TypeError","type error"),i=l("RangeError","range error")}for(var y="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<y.length;++m)"function"==typeof Array.prototype[y[m]]&&(p.prototype[y[m]]=Array.prototype[y[m]]);o.defineProperty(p.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),p.prototype.isOperational=!0;var v=0;function g(t){if(!(this instanceof g))return new g(t);c(this,"name","OperationalError"),c(this,"message",t),this.cause=t,this.isOperational=!0,t instanceof Error?(c(this,"message",t.message),c(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}p.prototype.toString=function(){var t=Array(4*v+1).join(" "),e="\n"+t+"AggregateError of:\n";v++,t=Array(4*v+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=t+i[o];e+=(r=i.join("\n"))+"\n"}return v--,e},u(g,Error);var _=Error.__BluebirdErrorTypes__;_||(_=s({CancellationError:f,TimeoutError:d,OperationalError:g,RejectionError:g,AggregateError:p}),o.defineProperty(Error,"__BluebirdErrorTypes__",{value:_,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:r,RangeError:i,CancellationError:_.CancellationError,OperationalError:_.OperationalError,TimeoutError:_.TimeoutError,AggregateError:_.AggregateError,Warning:h}},{"./es5":13,"./util":36}],13:[function(t,e,n){var r=function(){"use strict";return void 0===this}();if(r)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(t){var e=[];for(var n in t)i.call(t,n)&&e.push(n);return e};e.exports={isArray:function(t){try{return"[object Array]"===o.call(t)}catch(e){return!1}},keys:a,names:a,defineProperty:function(t,e,n){return t[e]=n.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(e){return s}},isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(t,e,n){"use strict";e.exports=function(t,e){var n=t.map;t.prototype.filter=function(t,r){return n(this,t,r,e)},t.filter=function(t,r,i){return n(t,r,i,e)}}},{}],15:[function(t,e,n){"use strict";e.exports=function(e,n,r){var i=t("./util"),o=e.CancellationError,s=i.errorObj,a=t("./catch_filter")(r);function u(t,e,n){this.promise=t,this.type=e,this.handler=n,this.called=!1,this.cancelPromise=null}function c(t){this.finallyHandler=t}function l(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function h(){return d.call(this,this.promise._target()._settledValue())}function f(t){if(!l(this,t))return s.e=t,s}function d(t){var i=this.promise,a=this.handler;if(!this.called){this.called=!0;var u=this.isFinallyHandler()?a.call(i._boundValue()):a.call(i._boundValue(),t);if(u===r)return u;if(void 0!==u){i._setReturnedNonUndefined();var d=n(u,i);if(d instanceof e){if(null!=this.cancelPromise){if(d._isCancelled()){var p=new o("late cancellation observer");return i._attachExtraTrace(p),s.e=p,s}d.isPending()&&d._attachCancellationCallback(new c(this))}return d._then(h,f,void 0,this,void 0)}}}return i.isRejected()?(l(this),s.e=t,s):(l(this),t)}return u.prototype.isFinallyHandler=function(){return 0===this.type},c.prototype._resultCancelled=function(){l(this.finallyHandler)},e.prototype._passThrough=function(t,e,n,r){return"function"!=typeof t?this.then():this._then(n,r,void 0,new u(this,e,t),void 0)},e.prototype.lastly=e.prototype.finally=function(t){return this._passThrough(t,0,d,d)},e.prototype.tap=function(t){return this._passThrough(t,1,d)},e.prototype.tapCatch=function(t){var n=arguments.length;if(1===n)return this._passThrough(t,1,void 0,d);var r,o=new Array(n-1),s=0;for(r=0;r<n-1;++r){var u=arguments[r];if(!i.isObject(u))return e.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+i.classString(u)));o[s++]=u}o.length=s;var c=arguments[r];return this._passThrough(a(o,c,this),1,void 0,d)},u}},{"./catch_filter":7,"./util":36}],16:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,s){var a=t("./errors").TypeError,u=t("./util"),c=u.errorObj,l=u.tryCatch,h=[];function f(t,n,i,o){if(s.cancellation()){var a=new e(r),u=this._finallyPromise=new e(r);this._promise=a.lastly((function(){return u})),a._captureStackTrace(),a._setOnCancel(this)}else(this._promise=new e(r))._captureStackTrace();this._stack=o,this._generatorFunction=t,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}u.inherits(f,o),f.prototype._isResolved=function(){return null===this._promise},f.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},f.prototype._promiseCancelled=function(){if(!this._isResolved()){var t;if(void 0!==this._generator.return)this._promise._pushContext(),t=l(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),t=l(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(t)}},f.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=l(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},f.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=l(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},f.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,t.cancel()}},f.prototype.promise=function(){return this._promise},f.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},f.prototype._continue=function(t){var n=this._promise;if(t===c)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(t.e,!1);var r=t.value;if(!0===t.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(o instanceof e||null!==(o=function(t,n,r){for(var o=0;o<n.length;++o){r._pushContext();var s=l(n[o])(t);if(r._popContext(),s===c){r._pushContext();var a=e.reject(c.e);return r._popContext(),a}var u=i(s,r);if(u instanceof e)return u}return null}(o,this._yieldHandlers,this._promise))){var s=(o=o._target())._bitField;0==(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&s)?e._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&s)?e._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()}else this._promiseRejected(new a("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(r))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},e.coroutine=function(t,e){if("function"!=typeof t)throw new a("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(e).yieldHandler,r=f,i=(new Error).stack;return function(){var e=t.apply(this,arguments),o=new r(void 0,void 0,n,i),s=o.promise();return o._generator=e,o._promiseFulfilled(void 0),s}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new a("expecting a function but got "+u.classString(t));h.push(t)},e.spawn=function(t){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new f(t,this),i=r.promise();return r._run(e.spawn),i}}},{"./errors":12,"./util":36}],17:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o){var s=t("./util");s.canEvaluate,s.tryCatch,s.errorObj,e.join=function(){var t,e=arguments.length-1;e>0&&"function"==typeof arguments[e]&&(t=arguments[e]);var r=[].slice.call(arguments);t&&r.pop();var i=new n(r).promise();return void 0!==t?i.spread(t):i}}},{"./util":36}],18:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,s){var a=t("./util"),u=a.tryCatch,c=a.errorObj,l=e._async;function h(t,n,r,i){this.constructor$(t),this._promise._captureStackTrace();var s=e._getContext();if(this._callback=a.contextBind(s,n),this._preservedValues=i===o?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=[],l.invoke(this._asyncInit,this,void 0),a.isArray(t))for(var u=0;u<t.length;++u){var c=t[u];c instanceof e&&c.suppressUnhandledRejections()}}function f(t,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+a.classString(n));var s=0;if(void 0!==i){if("object"!=typeof i||null===i)return e.reject(new TypeError("options argument must be an object but it is "+a.classString(i)));if("number"!=typeof i.concurrency)return e.reject(new TypeError("'concurrency' must be a number but it is "+a.classString(i.concurrency)));s=i.concurrency}return new h(t,n,s="number"==typeof s&&isFinite(s)&&s>=1?s:0,o).promise()}a.inherits(h,n),h.prototype._asyncInit=function(){this._init$(void 0,-2)},h.prototype._init=function(){},h.prototype._promiseFulfilled=function(t,n){var r=this._values,o=this.length(),a=this._preservedValues,l=this._limit;if(n<0){if(r[n=-1*n-1]=t,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return r[n]=t,this._queue.push(n),!1;null!==a&&(a[n]=t);var h=this._promise,f=this._callback,d=h._boundValue();h._pushContext();var p=u(f).call(d,t,n,o),y=h._popContext();if(s.checkForgottenReturns(p,y,null!==a?"Promise.filter":"Promise.map",h),p===c)return this._reject(p.e),!0;var m=i(p,this._promise);if(m instanceof e){var v=(m=m._target())._bitField;if(0==(50397184&v))return l>=1&&this._inFlight++,r[n]=m,m._proxy(this,-1*(n+1)),!1;if(0==(33554432&v))return 0!=(16777216&v)?(this._reject(m._reason()),!0):(this._cancel(),!0);p=m._value()}r[n]=p}return++this._totalResolved>=o&&(null!==a?this._filter(r,a):this._resolve(r),!0)},h.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,n=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var r=t.pop();this._promiseFulfilled(n[r],r)}},h.prototype._filter=function(t,e){for(var n=e.length,r=new Array(n),i=0,o=0;o<n;++o)t[o]&&(r[i++]=e[o]);r.length=i,this._resolve(r)},h.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return f(this,t,e,null)},e.map=function(t,e,n,r){return f(t,e,n,r)}}},{"./util":36}],19:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o){var s=t("./util"),a=s.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("expecting a function but got "+s.classString(t));return function(){var r=new e(n);r._captureStackTrace(),r._pushContext();var i=a(t).apply(this,arguments),s=r._popContext();return o.checkForgottenReturns(i,s,"Promise.method",r),r._resolveFromSyncValue(i),r}},e.attempt=e.try=function(t){if("function"!=typeof t)return i("expecting a function but got "+s.classString(t));var r,u=new e(n);if(u._captureStackTrace(),u._pushContext(),arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],l=arguments[2];r=s.isArray(c)?a(t).apply(l,c):a(t).call(l,c)}else r=a(t)();var h=u._popContext();return o.checkForgottenReturns(r,h,"Promise.try",u),u._resolveFromSyncValue(r),u},e.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,n){"use strict";var r=t("./util"),i=r.maybeWrapAsError,o=t("./errors").OperationalError,s=t("./es5"),a=/^(?:name|message|stack|cause)$/;function u(t){var e;if(function(t){return t instanceof Error&&s.getPrototypeOf(t)===Error.prototype}(t)){(e=new o(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var n=s.keys(t),i=0;i<n.length;++i){var u=n[i];a.test(u)||(e[u]=t[u])}return e}return r.markAsOriginatingFromRejection(t),t}e.exports=function(t,e){return function(n,r){if(null!==t){if(n){var o=u(i(n));t._attachExtraTrace(o),t._reject(o)}else if(e){var s=[].slice.call(arguments,1);t._fulfill(s)}else t._fulfill(r);t=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,n){"use strict";e.exports=function(e){var n=t("./util"),r=e._async,i=n.tryCatch,o=n.errorObj;function s(t,e){if(!n.isArray(t))return a.call(this,t,e);var s=i(e).apply(this._boundValue(),[null].concat(t));s===o&&r.throwLater(s.e)}function a(t,e){var n=this._boundValue(),s=void 0===t?i(e).call(n,null):i(e).call(n,null,t);s===o&&r.throwLater(s.e)}function u(t,e){if(!t){var n=new Error(t+"");n.cause=t,t=n}var s=i(e).call(this._boundValue(),t);s===o&&r.throwLater(s.e)}e.prototype.asCallback=e.prototype.nodeify=function(t,e){if("function"==typeof t){var n=a;void 0!==e&&Object(e).spread&&(n=s),this._then(n,u,void 0,this,t)}return this}}},{"./util":36}],22:[function(e,n,r){"use strict";n.exports=function(){var r=function(){return new g("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},i=function(){return new D.PromiseInspection(this._target())},o=function(t){return D.reject(new g(t))};function s(){}var a={},u=e("./util");u.setReflectHandler(i);var c=function(){var e=t.domain;return void 0===e?null:e},l=function(){return{domain:c(),async:null}},h=u.isNode&&u.nodeSupportsAsyncResource?e("async_hooks").AsyncResource:null,f=function(){return{domain:c(),async:new h("Bluebird::Promise")}},d=u.isNode?l:function(){return null};u.notEnumerableProp(D,"_getContext",d);var p=e("./es5"),y=e("./async"),m=new y;p.defineProperty(D,"_async",{value:m});var v=e("./errors"),g=D.TypeError=v.TypeError;D.RangeError=v.RangeError;var _=D.CancellationError=v.CancellationError;D.TimeoutError=v.TimeoutError,D.OperationalError=v.OperationalError,D.RejectionError=v.OperationalError,D.AggregateError=v.AggregateError;var b=function(){},w={},k={},O=e("./thenables")(D,b),E=e("./promise_array")(D,b,O,o,s),C=e("./context")(D),x=C.create,S=e("./debuggability")(D,C,(function(){d=f,u.notEnumerableProp(D,"_getContext",f)}),(function(){d=l,u.notEnumerableProp(D,"_getContext",l)})),j=(S.CapturedTrace,e("./finally")(D,O,k)),T=e("./catch_filter")(k),A=e("./nodeback"),F=u.errorObj,N=u.tryCatch;function D(t){t!==b&&function(t,e){if(null==t||t.constructor!==D)throw new g("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new g("expecting a function but got "+u.classString(e))}(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function I(t){this.promise._resolveCallback(t)}function M(t){this.promise._rejectCallback(t,!1)}function R(t){var e=new D(b);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}return D.prototype.toString=function(){return"[object Promise]"},D.prototype.caught=D.prototype.catch=function(t){var e=arguments.length;if(e>1){var n,r=new Array(e-1),i=0;for(n=0;n<e-1;++n){var s=arguments[n];if(!u.isObject(s))return o("Catch statement predicate: expecting an object but got "+u.classString(s));r[i++]=s}if(r.length=i,"function"!=typeof(t=arguments[n]))throw new g("The last argument to .catch() must be a function, got "+u.toString(t));return this.then(void 0,T(r,t,this))}return this.then(void 0,t)},D.prototype.reflect=function(){return this._then(i,i,void 0,this,void 0)},D.prototype.then=function(t,e){if(S.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var n=".then() only accepts functions but was passed: "+u.classString(t);arguments.length>1&&(n+=", "+u.classString(e)),this._warn(n)}return this._then(t,e,void 0,void 0,void 0)},D.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},D.prototype.spread=function(t){return"function"!=typeof t?o("expecting a function but got "+u.classString(t)):this.all()._then(t,void 0,void 0,w,void 0)},D.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},D.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new E(this).promise()},D.prototype.error=function(t){return this.caught(u.originatesFromRejection,t)},D.getNewLibraryCopy=n.exports,D.is=function(t){return t instanceof D},D.fromNode=D.fromCallback=function(t){var e=new D(b);e._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=N(t)(A(e,n));return r===F&&e._rejectCallback(r.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},D.all=function(t){return new E(t).promise()},D.cast=function(t){var e=O(t);return e instanceof D||((e=new D(b))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},D.resolve=D.fulfilled=D.cast,D.reject=D.rejected=function(t){var e=new D(b);return e._captureStackTrace(),e._rejectCallback(t,!0),e},D.setScheduler=function(t){if("function"!=typeof t)throw new g("expecting a function but got "+u.classString(t));return m.setScheduler(t)},D.prototype._then=function(t,e,n,r,i){var o=void 0!==i,s=o?i:new D(b),a=this._target(),c=a._bitField;o||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&c)?this._boundValue():a===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var l=d();if(0!=(50397184&c)){var h,f,p=a._settlePromiseCtx;0!=(33554432&c)?(f=a._rejectionHandler0,h=t):0!=(16777216&c)?(f=a._fulfillmentHandler0,h=e,a._unsetRejectionIsUnhandled()):(p=a._settlePromiseLateCancellationObserver,f=new _("late cancellation observer"),a._attachExtraTrace(f),h=e),m.invoke(p,a,{handler:u.contextBind(l,h),promise:s,receiver:r,value:f})}else a._addCallbacks(t,e,s,r,l);return s},D.prototype._length=function(){return 65535&this._bitField},D.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},D.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},D.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},D.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},D.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},D.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},D.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},D.prototype._isFinal=function(){return(4194304&this._bitField)>0},D.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},D.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},D.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},D.prototype._setAsyncGuaranteed=function(){if(!m.hasCustomScheduler()){var t=this._bitField;this._bitField=t|(536870912&t)>>2^134217728}},D.prototype._setNoAsyncGuarantee=function(){this._bitField=-134217729&(536870912|this._bitField)},D.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==a)return void 0===e&&this._isBound()?this._boundValue():e},D.prototype._promiseAt=function(t){return this[4*t-4+2]},D.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},D.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},D.prototype._boundValue=function(){},D.prototype._migrateCallback0=function(t){t._bitField;var e=t._fulfillmentHandler0,n=t._rejectionHandler0,r=t._promise0,i=t._receiverAt(0);void 0===i&&(i=a),this._addCallbacks(e,n,r,i,null)},D.prototype._migrateCallbackAt=function(t,e){var n=t._fulfillmentHandlerAt(e),r=t._rejectionHandlerAt(e),i=t._promiseAt(e),o=t._receiverAt(e);void 0===o&&(o=a),this._addCallbacks(n,r,i,o,null)},D.prototype._addCallbacks=function(t,e,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof t&&(this._fulfillmentHandler0=u.contextBind(i,t)),"function"==typeof e&&(this._rejectionHandler0=u.contextBind(i,e));else{var s=4*o-4;this[s+2]=n,this[s+3]=r,"function"==typeof t&&(this[s+0]=u.contextBind(i,t)),"function"==typeof e&&(this[s+1]=u.contextBind(i,e))}return this._setLength(o+1),o},D.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},D.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(r(),!1);var n=O(t,this);if(!(n instanceof D))return this._fulfill(t);e&&this._propagateFrom(n,2);var i=n._target();if(i!==this){var o=i._bitField;if(0==(50397184&o)){var s=this._length();s>0&&i._migrateCallback0(this);for(var a=1;a<s;++a)i._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!=(33554432&o))this._fulfill(i._value());else if(0!=(16777216&o))this._reject(i._reason());else{var u=new _("late cancellation observer");i._attachExtraTrace(u),this._reject(u)}}else this._reject(r())}},D.prototype._rejectCallback=function(t,e,n){var r=u.ensureErrorObject(t),i=r===t;if(!i&&!n&&S.warnings()){var o="a promise was rejected with a non-error: "+u.classString(t);this._warn(o,!0)}this._attachExtraTrace(r,!!e&&i),this._reject(t)},D.prototype._resolveFromExecutor=function(t){if(t!==b){var e=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(t,(function(t){e._resolveCallback(t)}),(function(t){e._rejectCallback(t,n)}));n=!1,this._popContext(),void 0!==r&&e._rejectCallback(r,!0)}},D.prototype._settlePromiseFromHandler=function(t,e,n,r){var i=r._bitField;if(0==(65536&i)){var o;r._pushContext(),e===w?n&&"number"==typeof n.length?o=N(t).apply(this._boundValue(),n):(o=F).e=new g("cannot .spread() a non-array: "+u.classString(n)):o=N(t).call(e,n);var s=r._popContext();0==(65536&(i=r._bitField))&&(o===k?r._reject(n):o===F?r._rejectCallback(o.e,!1):(S.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},D.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},D.prototype._followee=function(){return this._rejectionHandler0},D.prototype._setFollowee=function(t){this._rejectionHandler0=t},D.prototype._settlePromise=function(t,e,n,r){var o=t instanceof D,a=this._bitField,u=0!=(134217728&a);0!=(65536&a)?(o&&t._invokeInternalOnCancel(),n instanceof j&&n.isFinallyHandler()?(n.cancelPromise=t,N(e).call(n,r)===F&&t._reject(F.e)):e===i?t._fulfill(i.call(n)):n instanceof s?n._promiseCancelled(t):o||t instanceof E?t._cancel():n.cancel()):"function"==typeof e?o?(u&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,n,r,t)):e.call(n,r,t):n instanceof s?n._isResolved()||(0!=(33554432&a)?n._promiseFulfilled(r,t):n._promiseRejected(r,t)):o&&(u&&t._setAsyncGuaranteed(),0!=(33554432&a)?t._fulfill(r):t._reject(r))},D.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,n=t.promise,r=t.receiver,i=t.value;"function"==typeof e?n instanceof D?this._settlePromiseFromHandler(e,r,i,n):e.call(r,i,n):n instanceof D&&n._reject(i)},D.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},D.prototype._settlePromise0=function(t,e,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,t,i,e)},D.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},D.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var n=r();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!=(134217728&e)?this._settlePromises():m.settlePromises(this),this._dereferenceTrace())}},D.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=t,this._isFinal())return m.fatalError(t,u.isNode);(65535&e)>0?m.settlePromises(this):this._ensurePossibleRejectionHandled()}},D.prototype._fulfillPromises=function(t,e){for(var n=1;n<t;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},D.prototype._rejectPromises=function(t,e){for(var n=1;n<t;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},D.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,t),this._rejectPromises(e,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,t),this._fulfillPromises(e,r)}this._setLength(0)}this._clearCancellationData()},D.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},"undefined"!=typeof Symbol&&Symbol.toStringTag&&p.defineProperty(D.prototype,Symbol.toStringTag,{get:function(){return"Object"}}),D.defer=D.pending=function(){return S.deprecated("Promise.defer","new Promise"),{promise:new D(b),resolve:I,reject:M}},u.notEnumerableProp(D,"_makeSelfResolutionError",r),e("./method")(D,b,O,o,S),e("./bind")(D,b,O,S),e("./cancel")(D,E,o,S),e("./direct_resolve")(D),e("./synchronous_inspection")(D),e("./join")(D,E,O,b,m),D.Promise=D,D.version="3.7.2",e("./call_get.js")(D),e("./generators.js")(D,o,b,O,s,S),e("./map.js")(D,E,o,O,b,S),e("./nodeify.js")(D),e("./promisify.js")(D,b),e("./props.js")(D,E,O,o),e("./race.js")(D,b,O,o),e("./reduce.js")(D,E,o,O,b,S),e("./settle.js")(D,E,S),e("./some.js")(D,E,o),e("./timers.js")(D,b,S),e("./using.js")(D,o,O,x,b,S),e("./any.js")(D),e("./each.js")(D,b),e("./filter.js")(D,b),u.toFastProperties(D),u.toFastProperties(D.prototype),R({a:1}),R({b:2}),R({c:3}),R(1),R((function(){})),R(void 0),R(!1),R(new D(b)),S.setBounds(y.firstLineError,u.lastLineError),D}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36,async_hooks:void 0}],23:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o){var s=t("./util");function a(t){var r=this._promise=new e(n);t instanceof e&&(r._propagateFrom(t,3),t.suppressUnhandledRejections()),r._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return s.isArray,s.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function t(n,o){var a=r(this._values,this._promise);if(a instanceof e){var u=(a=a._target())._bitField;if(this._values=a,0==(50397184&u))return this._promise._setAsyncGuaranteed(),a._then(t,this._reject,void 0,this,o);if(0==(33554432&u))return 0!=(16777216&u)?this._reject(a._reason()):this._cancel();a=a._value()}if(null!==(a=s.asArray(a)))0!==a.length?this._iterate(a):-5===o?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}(o));else{var c=i("expecting an array or an iterable object but got "+s.classString(a)).reason();this._promise._rejectCallback(c,!1)}},a.prototype._iterate=function(t){var n=this.getActualLength(t.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,s=null,a=0;a<n;++a){var u=r(t[a],i);s=u instanceof e?(u=u._target())._bitField:null,o?null!==s&&u.suppressUnhandledRejections():null!==s?0==(50397184&s)?(u._proxy(this,a),this._values[a]=u):o=0!=(33554432&s)?this._promiseFulfilled(u._value(),a):0!=(16777216&s)?this._promiseRejected(u._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(u,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},a.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var n=0;n<t.length;++n)t[n]instanceof e&&t[n].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(t){return t},a}},{"./util":36}],24:[function(t,e,n){"use strict";e.exports=function(e,n){var r={},i=t("./util"),o=t("./nodeback"),s=i.withAppended,a=i.maybeWrapAsError,u=i.canEvaluate,c=t("./errors").TypeError,l={__isPromisified__:!0},h=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),f=function(t){return i.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t};function d(t){return!h.test(t)}function p(t){try{return!0===t.__isPromisified__}catch(e){return!1}}function y(t,e,n){var r=i.getDataPropertyOrDefault(t,e+n,l);return!!r&&p(r)}var m=u?void 0:function(t,u,c,l,h,f){var d=function(){return this}(),p=t;function y(){var i=u;u===r&&(i=this);var c=new e(n);c._captureStackTrace();var l="string"==typeof p&&this!==d?this[p]:t,h=o(c,f);try{l.apply(i,s(arguments,h))}catch(y){c._rejectCallback(a(y),!0,!0)}return c._isFateSealed()||c._setAsyncGuaranteed(),c}return"string"==typeof p&&(t=l),i.notEnumerableProp(y,"__isPromisified__",!0),y};function v(t,e,n,o,s){for(var a=new RegExp(e.replace(/([$])/,"\\$")+"$"),u=function(t,e,n,r){for(var o=i.inheritedDataKeys(t),s=[],a=0;a<o.length;++a){var u=o[a],l=t[u],h=r===f||f(u);"function"!=typeof l||p(l)||y(t,u,e)||!r(u,l,t,h)||s.push(u,l)}return function(t,e,n){for(var r=0;r<t.length;r+=2){var i=t[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<t.length;s+=2)if(t[s]===o)throw new c("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}(s,e,n),s}(t,e,a,n),l=0,h=u.length;l<h;l+=2){var d=u[l],v=u[l+1],g=d+e;if(o===m)t[g]=m(d,r,d,v,e,s);else{var _=o(v,(function(){return m(d,r,d,v,e,s)}));i.notEnumerableProp(_,"__isPromisified__",!0),t[g]=_}}return i.toFastProperties(t),t}e.promisify=function(t,e){if("function"!=typeof t)throw new c("expecting a function but got "+i.classString(t));if(p(t))return t;var n,o,s,a=(n=t,o=void 0===(e=Object(e)).context?r:e.context,s=!!e.multiArgs,m(n,o,void 0,n,null,s));return i.copyDescriptors(t,a,d),a},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new c("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(e=Object(e)).multiArgs,r=e.suffix;"string"!=typeof r&&(r="Async");var o=e.filter;"function"!=typeof o&&(o=f);var s=e.promisifier;if("function"!=typeof s&&(s=m),!i.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=i.inheritedDataKeys(t),u=0;u<a.length;++u){var l=t[a[u]];"constructor"!==a[u]&&i.isClass(l)&&(v(l.prototype,r,o,s,n),v(l,r,o,s,n))}return v(t,r,o,s,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){var o,s=t("./util"),a=s.isObject,u=t("./es5");"function"==typeof Map&&(o=Map);var c=function(){var t=0,e=0;function n(n,r){this[t]=n,this[t+e]=r,t++}return function(r){e=r.size,t=0;var i=new Array(2*r.size);return r.forEach(n,i),i}}();function l(t){var e,n=!1;if(void 0!==o&&t instanceof o)e=c(t),n=!0;else{var r=u.keys(t),i=r.length;e=new Array(2*i);for(var s=0;s<i;++s){var a=r[s];e[s]=t[a],e[s+i]=a}}this.constructor$(e),this._isMap=n,this._init$(void 0,n?-6:-3)}function h(t){var n,o=r(t);return a(o)?(n=o instanceof e?o._then(e.props,void 0,void 0,void 0,void 0):new l(o).promise(),o instanceof e&&n._propagateFrom(o,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}s.inherits(l,n),l.prototype._init=function(){},l.prototype._promiseFulfilled=function(t,e){if(this._values[e]=t,++this._totalResolved>=this._length){var n;if(this._isMap)n=function(t){for(var e=new o,n=t.length/2|0,r=0;r<n;++r){var i=t[n+r],s=t[r];e.set(i,s)}return e}(this._values);else{n={};for(var r=this.length(),i=0,s=this.length();i<s;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},l.prototype.shouldCopyValues=function(){return!1},l.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return h(this)},e.props=function(t){return h(t)}}},{"./es5":13,"./util":36}],26:[function(t,e,n){"use strict";function r(t){this._capacity=t,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(t){return this._capacity<t},r.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},r.prototype.push=function(t,e,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=t,this[i+1&o]=e,this[i+2&o]=n,this._length=r},r.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,function(t,e,n,r,i){for(var o=0;o<i;++o)n[o+r]=t[o+0],t[o+0]=void 0}(this,0,this,e,this._front+this._length&e-1)},e.exports=r},{}],27:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){var o=t("./util");function s(t,a){var u,c=r(t);if(c instanceof e)return(u=c).then((function(t){return s(t,u)}));if(null===(t=o.asArray(t)))return i("expecting an array or an iterable object but got "+o.classString(t));var l=new e(n);void 0!==a&&l._propagateFrom(a,3);for(var h=l._fulfill,f=l._reject,d=0,p=t.length;d<p;++d){var y=t[d];(void 0!==y||d in t)&&e.cast(y)._then(h,f,void 0,l,null)}return l}e.race=function(t){return s(t,void 0)},e.prototype.race=function(){return s(this,void 0)}}},{"./util":36}],28:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,s){var a=t("./util"),u=a.tryCatch;function c(t,n,r,i){this.constructor$(t);var s=e._getContext();this._fn=a.contextBind(s,n),void 0!==r&&(r=e.resolve(r))._attachCancellationCallback(this),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function l(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function h(t,e,n,i){return"function"!=typeof e?r("expecting a function but got "+a.classString(e)):new c(t,e,n,i).promise()}function f(t){this.accum=t,this.array._gotAccum(t);var n=i(this.value,this.array._promise);return n instanceof e?(this.array._currentCancellable=n,n._then(d,void 0,void 0,this,void 0)):d.call(this,n)}function d(t){var n,r=this.array,i=r._promise,o=u(r._fn);i._pushContext(),(n=void 0!==r._eachValues?o.call(i._boundValue(),t,this.index,this.length):o.call(i._boundValue(),this.accum,t,this.index,this.length))instanceof e&&(r._currentCancellable=n);var a=i._popContext();return s.checkForgottenReturns(n,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",i),n}a.inherits(c,n),c.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==o&&this._eachValues.push(t)},c.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},c.prototype._init=function(){},c.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},c.prototype.shouldCopyValues=function(){return!1},c.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},c.prototype._resultCancelled=function(t){if(t===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel())},c.prototype._iterate=function(t){var n,r;this._values=t;var i=t.length;void 0!==this._initialValue?(n=this._initialValue,r=0):(n=e.resolve(t[0]),r=1),this._currentCancellable=n;for(var o=r;o<i;++o){var s=t[o];s instanceof e&&s.suppressUnhandledRejections()}if(!n.isRejected())for(;r<i;++r){var a={accum:null,value:t[r],index:r,length:i,array:this};n=n._then(f,void 0,void 0,a,void 0),0==(127&r)&&n._setNoAsyncGuarantee()}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(l,l,void 0,n,this)},e.prototype.reduce=function(t,e){return h(this,t,e,null)},e.reduce=function(t,e,n,r){return h(t,e,n,r)}}},{"./util":36}],29:[function(r,i,o){"use strict";var s,a,u,c,l,h=r("./util"),f=h.getNativePromise();if(h.isNode&&"undefined"==typeof MutationObserver){var d=e.setImmediate,p=t.nextTick;s=h.isRecentNode?function(t){d.call(e,t)}:function(e){p.call(t,e)}}else if("function"==typeof f&&"function"==typeof f.resolve){var y=f.resolve();s=function(t){y.then(t)}}else s="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)||!("classList"in document.documentElement)?void 0!==n?function(t){n(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:(a=document.createElement("div"),u={attributes:!0},c=!1,l=document.createElement("div"),new MutationObserver((function(){a.classList.toggle("foo"),c=!1})).observe(l,u),function(t){var e=new MutationObserver((function(){e.disconnect(),t()}));e.observe(a,u),c||(c=!0,l.classList.toggle("foo"))});i.exports=s},{"./util":36}],30:[function(t,e,n){"use strict";e.exports=function(e,n,r){var i=e.PromiseInspection;function o(t){this.constructor$(t)}t("./util").inherits(o,n),o.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},o.prototype._promiseFulfilled=function(t,e){var n=new i;return n._bitField=33554432,n._settledValueField=t,this._promiseResolved(e,n)},o.prototype._promiseRejected=function(t,e){var n=new i;return n._bitField=16777216,n._settledValueField=t,this._promiseResolved(e,n)},e.settle=function(t){return r.deprecated(".settle()",".reflect()"),new o(t).promise()},e.allSettled=function(t){return new o(t).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(t,e,n){"use strict";e.exports=function(e,n,r){var i=t("./util"),o=t("./errors").RangeError,s=t("./errors").AggregateError,a=i.isArray,u={};function c(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function l(t,e){if((0|e)!==e||e<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new c(t),i=n.promise();return n.setHowMany(e),n.init(),i}i.inherits(c,n),c.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var t=a(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},c.prototype.init=function(){this._initialized=!0,this._init()},c.prototype.setUnwrap=function(){this._unwrap=!0},c.prototype.howMany=function(){return this._howMany},c.prototype.setHowMany=function(t){this._howMany=t},c.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},c.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},c.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(u),this._checkOutcome())},c.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new s,e=this.length();e<this._values.length;++e)this._values[e]!==u&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},c.prototype._fulfilled=function(){return this._totalResolved},c.prototype._rejected=function(){return this._values.length-this.length()},c.prototype._addRejected=function(t){this._values.push(t)},c.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},c.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},c.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new o(e)},c.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return l(t,e)},e.prototype.some=function(t){return l(this,t)},e._SomePromiseArray=c}},{"./errors":12,"./util":36}],32:[function(t,e,n){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var n=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return i.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return n.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),r.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,n){"use strict";e.exports=function(e,n){var r=t("./util"),i=r.errorObj,o=r.isObject,s={}.hasOwnProperty;return function(t,a){if(o(t)){if(t instanceof e)return t;var u=function(t){try{return function(t){return t.then}(t)}catch(e){return i.e=e,i}}(t);if(u===i){a&&a._pushContext();var c=e.reject(u.e);return a&&a._popContext(),c}if("function"==typeof u)return function(t){try{return s.call(t,"_promise0")}catch(e){return!1}}(t)?(c=new e(n),t._then(c._fulfill,c._reject,void 0,c,null),c):function(t,o,s){var a=new e(n),u=a;s&&s._pushContext(),a._captureStackTrace(),s&&s._popContext();var c=!0,l=r.tryCatch(o).call(t,(function(t){a&&(a._resolveCallback(t),a=null)}),(function(t){a&&(a._rejectCallback(t,c,!0),a=null)}));return c=!1,a&&l===i&&(a._rejectCallback(l.e,!0,!0),a=null),u}(t,u,a)}return t}}},{"./util":36}],34:[function(t,e,n){"use strict";e.exports=function(e,n,r){var i=t("./util"),o=e.TimeoutError;function s(t){this.handle=t}s.prototype._resultCancelled=function(){clearTimeout(this.handle)};var a=function(t){return u(+this).thenReturn(t)},u=e.delay=function(t,i){var o,u;return void 0!==i?(o=e.resolve(i)._then(a,null,null,t,void 0),r.cancellation()&&i instanceof e&&o._setOnCancel(i)):(o=new e(n),u=setTimeout((function(){o._fulfill()}),+t),r.cancellation()&&o._setOnCancel(new s(u)),o._captureStackTrace()),o._setAsyncGuaranteed(),o};function c(t){return clearTimeout(this.handle),t}function l(t){throw clearTimeout(this.handle),t}e.prototype.delay=function(t){return u(t,this)},e.prototype.timeout=function(t,e){var n,a;t=+t;var u=new s(setTimeout((function(){n.isPending()&&function(t,e,n){var r;r="string"!=typeof e?e instanceof Error?e:new o("operation timed out"):new o(e),i.markAsOriginatingFromRejection(r),t._attachExtraTrace(r),t._reject(r),null!=n&&n.cancel()}(n,e,a)}),t));return r.cancellation()?(a=this.then(),(n=a._then(c,l,void 0,u,void 0))._setOnCancel(u)):n=this._then(c,l,void 0,u,void 0),n}}},{"./util":36}],35:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,s){var a=t("./util"),u=t("./errors").TypeError,c=t("./util").inherits,l=a.errorObj,h=a.tryCatch,f={};function d(t){setTimeout((function(){throw t}),0)}function p(t,n){var i=0,s=t.length,a=new e(o);return function o(){if(i>=s)return a._fulfill();var u=function(t){var e=r(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}(t[i++]);if(u instanceof e&&u._isDisposable()){try{u=r(u._getDisposer().tryDispose(n),t.promise)}catch(c){return d(c)}if(u instanceof e)return u._then(o,d,null,null,null)}o()}(),a}function y(t,e,n){this._data=t,this._promise=e,this._context=n}function m(t,e,n){this.constructor$(t,e,n)}function v(t){return y.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function g(t){this.length=t,this.promise=null,this[t-1]=null}y.prototype.data=function(){return this._data},y.prototype.promise=function(){return this._promise},y.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():f},y.prototype.tryDispose=function(t){var e=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=e!==f?this.doDispose(e,t):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},y.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},c(m,y),m.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},g.prototype._resultCancelled=function(){for(var t=this.length,n=0;n<t;++n){var r=this[n];r instanceof e&&r.cancel()}},e.using=function(){var t=arguments.length;if(t<2)return n("you must pass at least 2 arguments to Promise.using");var i,o=arguments[t-1];if("function"!=typeof o)return n("expecting a function but got "+a.classString(o));var u=!0;2===t&&Array.isArray(arguments[0])?(t=(i=arguments[0]).length,u=!1):(i=arguments,t--);for(var c=new g(t),f=0;f<t;++f){var d=i[f];if(y.isDisposer(d)){var m=d;(d=d.promise())._setDisposable(m)}else{var _=r(d);_ instanceof e&&(d=_._then(v,null,null,{resources:c,index:f},void 0))}c[f]=d}var b=new Array(c.length);for(f=0;f<b.length;++f)b[f]=e.resolve(c[f]).reflect();var w=e.all(b).then((function(t){for(var e=0;e<t.length;++e){var n=t[e];if(n.isRejected())return l.e=n.error(),l;if(!n.isFulfilled())return void w.cancel();t[e]=n.value()}k._pushContext(),o=h(o);var r=u?o.apply(void 0,t):o(t),i=k._popContext();return s.checkForgottenReturns(r,i,"Promise.using",k),r})),k=w.lastly((function(){var t=new e.PromiseInspection(w);return p(c,t)}));return c.promise=k,k._setOnCancel(c),k},e.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new m(t,this,i());throw new u}}},{"./errors":12,"./util":36}],36:[function(n,r,i){"use strict";var o,s=n("./es5"),a="undefined"==typeof navigator,u={e:{}},c="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:void 0!==this?this:null;function l(){try{var t=o;return o=null,t.apply(this,arguments)}catch(e){return u.e=e,u}}function h(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function f(t,e,n){if(h(t))return t;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return s.defineProperty(t,e,r),t}var d=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1};if(s.isES5){var n=Object.getOwnPropertyNames;return function(t){for(var r=[],i=Object.create(null);null!=t&&!e(t);){var o;try{o=n(t)}catch(l){return r}for(var a=0;a<o.length;++a){var u=o[a];if(!i[u]){i[u]=!0;var c=Object.getOwnPropertyDescriptor(t,u);null!=c&&null==c.get&&null==c.set&&r.push(u)}}t=s.getPrototypeOf(t)}return r}}var r={}.hasOwnProperty;return function(n){if(e(n))return[];var i=[];t:for(var o in n)if(r.call(n,o))i.push(o);else{for(var s=0;s<t.length;++s)if(r.call(t[s],o))continue t;i.push(o)}return i}}(),p=/this\s*\.\s*\S+\s*=/;var y=/^[a-z$_][a-z$_0-9]*$/i;function m(t){try{return t+""}catch(e){return"[no string representation]"}}function v(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function g(t){return v(t)&&s.propertyIsWritable(t,"stack")}var _="stack"in new Error?function(t){return g(t)?t:new Error(m(t))}:function(t){if(g(t))return t;try{throw new Error(m(t))}catch(e){return e}};function b(t){return{}.toString.call(t)}var w=function(t){return s.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var k="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,n=[],r=t[Symbol.iterator]();!(e=r.next()).done;)n.push(e.value);return n};w=function(t){return s.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?k(t):null}}var O,E=void 0!==t&&"[object process]"===b(t).toLowerCase(),C=void 0!==t&&void 0!==t.env;var x,S={setReflectHandler:function(t){O=t},isClass:function(t){try{if("function"==typeof t){var e=s.names(t.prototype),n=s.isES5&&e.length>1,r=e.length>0&&!(1===e.length&&"constructor"===e[0]),i=p.test(t+"")&&s.names(t).length>0;if(n||r||i)return!0}return!1}catch(o){return!1}},isIdentifier:function(t){return y.test(t)},inheritedDataKeys:d,getDataPropertyOrDefault:function(t,e,n){if(!s.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var r=Object.getOwnPropertyDescriptor(t,e);return null!=r?null==r.get&&null==r.set?r.value:n:void 0},thrower:function(t){throw t},isArray:s.isArray,asArray:w,notEnumerableProp:f,isPrimitive:h,isObject:function(t){return"function"==typeof t||"object"==typeof t&&null!==t},isError:v,canEvaluate:a,errorObj:u,tryCatch:function(t){return o=t,l},inherits:function(t,e){var n={}.hasOwnProperty;function r(){for(var r in this.constructor=t,this.constructor$=e,e.prototype)n.call(e.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=e.prototype[r])}return r.prototype=e.prototype,t.prototype=new r,t.prototype},withAppended:function(t,e){var n,r=t.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=t[n];return i[n]=e,i},maybeWrapAsError:function(t){return h(t)?new Error(m(t)):t},toFastProperties:function(t){function e(){}e.prototype=t;var n=new e;function r(){return typeof n.foo}return r(),r(),t},filledRange:function(t,e,n){for(var r=new Array(t),i=0;i<t;++i)r[i]=e+i+n;return r},toString:m,canAttachTrace:g,ensureErrorObject:_,originatesFromRejection:function(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)},markAsOriginatingFromRejection:function(t){try{f(t,"isOperational",!0)}catch(e){}},classString:b,copyDescriptors:function(t,e,n){for(var r=s.names(t),i=0;i<r.length;++i){var o=r[i];if(n(o))try{s.defineProperty(e,o,s.getDescriptor(t,o))}catch(a){}}},isNode:E,hasEnvVariables:C,env:function(e){return C?t.env[e]:void 0},global:c,getNativePromise:function(){if("function"==typeof Promise)try{if("[object Promise]"===b(new Promise((function(){}))))return Promise}catch(t){}},contextBind:function(t,e){if(null===t||"function"!=typeof e||e===O)return e;null!==t.domain&&(e=t.domain.bind(e));var n=t.async;if(null!==n){var r=e;e=function(){var t=new Array(2).concat([].slice.call(arguments));return t[0]=r,t[1]=this,n.runInAsyncScope.apply(n,t)}}return e}};S.isRecentNode=S.isNode&&(t.versions&&t.versions.node?x=t.versions.node.split(".").map(Number):t.version&&(x=t.version.split(".").map(Number)),0===x[0]&&x[1]>10||x[0]>0),S.nodeSupportsAsyncResource=S.isNode&&function(){var t=!1;try{t="function"==typeof n("async_hooks").AsyncResource.prototype.runInAsyncScope}catch(e){t=!1}return t}(),S.isNode&&S.toFastProperties(t);try{throw new Error}catch(j){S.lastLineError=j}r.exports=S},{"./es5":13,async_hooks:void 0}]},{},[4])(4)})),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},require("timers").setImmediate);var O;(k=k.exports).config({cancellation:!0}),O=async function(t,{db:e,cursor:r,ns:i,stream:o,from:s,after:a,to:u,until:c,types:l,limit:h,each:d}){const p=t.url({endpoint:`/db/${e}/cursors/${r}/events`,headers:{accept:"text/event-stream"}}),y=new w(p,{headers:await t.auth()});let m=!0;const v=new f;let g,_;y.addEventListener("error",e=>{let r;try{(r=JSON.parse(e.data))&&r.name&&r.status||(r=void 0)}catch(i){}if(!e.message&&!r)return y.close(),void(v.running||g());y.close(),v.jobs.length=0,e&&"ECONNREFUSED"===e.code?_(new n.ConnectionRefused(t.server)):_(r?new n.StatusCode(e.origin,r.status,r.name,r.message):new n.UnexpectedError(e.message))});const b=async(n,i,o)=>{v.run(async(s,a)=>{await i(n,o),a.success(),v.running||g(),m&&this.advanceCursor(t,{db:e,cursor:r,last:n.meta.id})})};return y.addEventListener("message",t=>{const e=JSON.parse(t.data);b(e,d,{cancel:async()=>{m=!1,y.close(),v.jobs.length=0,g()}})}),new k((t,e,n)=>{g=t,_=e,n((function(){m=!1,y.close(),v.jobs.length=0}))})};var E;k.config({cancellation:!0}),E=async function(t,{db:e,ns:r,stream:i,from:o,after:s,to:a,until:u,types:c,limit:l,each:h}){const d=t.url({endpoint:`/db/${e}/events`,query:{ns:r,stream:i,types:c,from:o,after:s,to:a,until:u,limit:l,schema:"jsonapi"},headers:{accept:"text/event-stream"}}),p=new w(d,{headers:await t.auth()}),y=new f;let m,v;return p.addEventListener("error",e=>{let r;try{(r=JSON.parse(e.data))&&r.name&&r.status||(r=void 0)}catch(i){}if(!e.message&&!r)return p.close(),void(y.running||m());p.close(),y.jobs.length=0,e&&"ECONNREFUSED"===e.code?v(new n.ConnectionRefused(t.server)):v(r?new n.StatusCode(e.origin,r.status,r.name,r.message):new n.UnexpectedError(e.message))}),p.addEventListener("message",t=>{!async function(t,e,n){y.run(async(r,i)=>{await e(t,n),i.success(),y.running||m()})}(JSON.parse(t.data),h,{cancel:async()=>{p.close(),y.jobs.length=0,m()}})}),new k((t,e,n)=>{m=t,v=e,n((function(){p.close(),y.jobs.length=0}))})};var C={};function x(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function S(t,e,n){return e&&x(t.prototype,e),n&&x(t,n),t}function j(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function F(t,e,n){return(F=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&A(i,n.prototype),i}).apply(null,arguments)}function N(t){var e="function"==typeof Map?new Map:void 0;return(N=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return F(t,arguments,T(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),A(r,t)})(t)}Object.defineProperty(C,"__esModule",{value:!0});var D=function(t){function e(){return t.apply(this,arguments)||this}return j(e,t),e}(N(Error)),I=function(t){function e(e){return t.call(this,"Invalid DateTime: "+e.toMessage())||this}return j(e,t),e}(D),M=function(t){function e(e){return t.call(this,"Invalid Interval: "+e.toMessage())||this}return j(e,t),e}(D),R=function(t){function e(e){return t.call(this,"Invalid Duration: "+e.toMessage())||this}return j(e,t),e}(D),P=function(t){function e(){return t.apply(this,arguments)||this}return j(e,t),e}(D),L=function(t){function e(e){return t.call(this,"Invalid unit "+e)||this}return j(e,t),e}(D),$=function(t){function e(){return t.apply(this,arguments)||this}return j(e,t),e}(D),V=function(t){function e(){return t.call(this,"Zone is an abstract class")||this}return j(e,t),e}(D),U="numeric",q="short",z="long",H={year:U,month:U,day:U},B={year:U,month:q,day:U},Z={year:U,month:z,day:U},W={year:U,month:z,day:U,weekday:z},G={hour:U,minute:U},J={hour:U,minute:U,second:U},Q={hour:U,minute:U,second:U,timeZoneName:q},Y={hour:U,minute:U,second:U,timeZoneName:z},X={hour:U,minute:U,hour12:!1},K={hour:U,minute:U,second:U,hour12:!1},tt={hour:U,minute:U,second:U,hour12:!1,timeZoneName:q},et={hour:U,minute:U,second:U,hour12:!1,timeZoneName:z},nt={year:U,month:U,day:U,hour:U,minute:U},rt={year:U,month:U,day:U,hour:U,minute:U,second:U},it={year:U,month:q,day:U,hour:U,minute:U},ot={year:U,month:q,day:U,hour:U,minute:U,second:U},st={year:U,month:q,day:U,weekday:q,hour:U,minute:U},at={year:U,month:z,day:U,hour:U,minute:U,timeZoneName:q},ut={year:U,month:z,day:U,hour:U,minute:U,second:U,timeZoneName:q},ct={year:U,month:z,day:U,weekday:z,hour:U,minute:U,timeZoneName:z},lt={year:U,month:z,day:U,weekday:z,hour:U,minute:U,second:U,timeZoneName:z};function ht(t){return void 0===t}function ft(t){return"number"==typeof t}function dt(t){return"number"==typeof t&&t%1==0}function pt(){try{return"undefined"!=typeof Intl&&Intl.DateTimeFormat}catch(t){return!1}}function yt(){return!ht(Intl.DateTimeFormat.prototype.formatToParts)}function mt(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(t){return!1}}function vt(t,e,n){if(0!==t.length)return t.reduce((function(t,r){var i=[e(r),r];return t&&n(t[0],i[0])===t[0]?t:i}),null)[1]}function gt(t,e){return e.reduce((function(e,n){return e[n]=t[n],e}),{})}function _t(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function bt(t,e,n){return dt(t)&&t>=e&&t<=n}function wt(t,e){return void 0===e&&(e=2),t.toString().length<e?("0".repeat(e)+t).slice(-e):t.toString()}function kt(t){return ht(t)||null===t||""===t?void 0:parseInt(t,10)}function Ot(t){if(!ht(t)&&null!==t&&""!==t){var e=1e3*parseFloat("0."+t);return Math.floor(e)}}function Et(t,e,n){void 0===n&&(n=!1);var r=Math.pow(10,e);return(n?Math.trunc:Math.round)(t*r)/r}function Ct(t){return t%4==0&&(t%100!=0||t%400==0)}function xt(t){return Ct(t)?366:365}function St(t,e){var n,r=(n=e-1)-12*Math.floor(n/12)+1;return 2===r?Ct(t+(e-r)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function jt(t){var e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e)).setUTCFullYear(e.getUTCFullYear()-1900),+e}function Tt(t){var e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,n=t-1,r=(n+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400))%7;return 4===e||3===r?53:52}function At(t){return t>99?t:t>60?1900+t:2e3+t}function Ft(t,e,n,r){void 0===r&&(r=null);var i=new Date(t),o={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(o.timeZone=r);var s=Object.assign({timeZoneName:e},o),a=pt();if(a&&yt()){var u=new Intl.DateTimeFormat(n,s).formatToParts(i).find((function(t){return"timezonename"===t.type.toLowerCase()}));return u?u.value:null}if(a){var c=new Intl.DateTimeFormat(n,o).format(i);return new Intl.DateTimeFormat(n,s).format(i).substring(c.length).replace(/^[, \u200e]+/,"")}return null}function Nt(t,e){var n=parseInt(t,10);Number.isNaN(n)&&(n=0);var r=parseInt(e,10)||0;return 60*n+(n<0||Object.is(n,-0)?-r:r)}function Dt(t){var e=Number(t);if("boolean"==typeof t||""===t||Number.isNaN(e))throw new $("Invalid unit value "+t);return e}function It(t,e,n){var r={};for(var i in t)if(_t(t,i)){if(n.indexOf(i)>=0)continue;var o=t[i];if(null==o)continue;r[e(i)]=Dt(o)}return r}function Mt(t,e){var n=Math.trunc(t/60),r=Math.abs(t%60),i=n>=0&&!Object.is(n,-0)?"+":"-",o=""+i+Math.abs(n);switch(e){case"short":return""+i+wt(Math.abs(n),2)+":"+wt(r,2);case"narrow":return r>0?o+":"+r:o;case"techie":return""+i+wt(Math.abs(n),2)+wt(r,2);default:throw new RangeError("Value format "+e+" is out of range for property format")}}function Rt(t){return gt(t,["hour","minute","second","millisecond"])}var Pt=/[A-Za-z_+-]{1,256}(:?\/[A-Za-z_+-]{1,256}(\/[A-Za-z_+-]{1,256})?)?/;function Lt(t){return JSON.stringify(t,Object.keys(t).sort())}var $t=["January","February","March","April","May","June","July","August","September","October","November","December"],Vt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Ut=["J","F","M","A","M","J","J","A","S","O","N","D"];function qt(t){switch(t){case"narrow":return Ut;case"short":return Vt;case"long":return $t;case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var zt=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ht=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Bt=["M","T","W","T","F","S","S"];function Zt(t){switch(t){case"narrow":return Bt;case"short":return Ht;case"long":return zt;case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var Wt=["AM","PM"],Gt=["Before Christ","Anno Domini"],Jt=["BC","AD"],Qt=["B","A"];function Yt(t){switch(t){case"narrow":return Qt;case"short":return Jt;case"long":return Gt;default:return null}}function Xt(t,e){var n="",r=t,i=Array.isArray(r),o=0;for(r=i?r:r[Symbol.iterator]();;){var s;if(i){if(o>=r.length)break;s=r[o++]}else{if((o=r.next()).done)break;s=o.value}var a=s;a.literal?n+=a.val:n+=e(a.val)}return n}var Kt={D:H,DD:B,DDD:Z,DDDD:W,t:G,tt:J,ttt:Q,tttt:Y,T:X,TT:K,TTT:tt,TTTT:et,f:nt,ff:it,fff:at,ffff:ct,F:rt,FF:ot,FFF:ut,FFFF:lt},te=function(){function t(t,e){this.opts=e,this.loc=t,this.systemLoc=null}t.create=function(e,n){return void 0===n&&(n={}),new t(e,n)},t.parseFormat=function(t){for(var e=null,n="",r=!1,i=[],o=0;o<t.length;o++){var s=t.charAt(o);"'"===s?(n.length>0&&i.push({literal:r,val:n}),e=null,n="",r=!r):r||s===e?n+=s:(n.length>0&&i.push({literal:!1,val:n}),n=s,e=s)}return n.length>0&&i.push({literal:r,val:n}),i},t.macroTokenToFormatOpts=function(t){return Kt[t]};var e=t.prototype;return e.formatWithSystemDefault=function(t,e){return null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,Object.assign({},this.opts,e)).format()},e.formatDateTime=function(t,e){return void 0===e&&(e={}),this.loc.dtFormatter(t,Object.assign({},this.opts,e)).format()},e.formatDateTimeParts=function(t,e){return void 0===e&&(e={}),this.loc.dtFormatter(t,Object.assign({},this.opts,e)).formatToParts()},e.resolvedOptions=function(t,e){return void 0===e&&(e={}),this.loc.dtFormatter(t,Object.assign({},this.opts,e)).resolvedOptions()},e.num=function(t,e){if(void 0===e&&(e=0),this.opts.forceSimple)return wt(t,e);var n=Object.assign({},this.opts);return e>0&&(n.padTo=e),this.loc.numberFormatter(n).format(t)},e.formatDateTimeFromString=function(e,n){var r=this,i="en"===this.loc.listingMode(),o=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar&&yt(),s=function(t,n){return r.loc.extract(e,t,n)},a=function(t){return e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):""},u=function(t,n){return i?function(t,e){return qt(e)[t.month-1]}(e,t):s(n?{month:t}:{month:t,day:"numeric"},"month")},c=function(t,n){return i?function(t,e){return Zt(e)[t.weekday-1]}(e,t):s(n?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday")},l=function(t){return i?function(t,e){return Yt(e)[t.year<0?0:1]}(e,t):s({era:t},"era")};return Xt(t.parseFormat(n),(function(n){switch(n){case"S":return r.num(e.millisecond);case"u":case"SSS":return r.num(e.millisecond,3);case"s":return r.num(e.second);case"ss":return r.num(e.second,2);case"m":return r.num(e.minute);case"mm":return r.num(e.minute,2);case"h":return r.num(e.hour%12==0?12:e.hour%12);case"hh":return r.num(e.hour%12==0?12:e.hour%12,2);case"H":return r.num(e.hour);case"HH":return r.num(e.hour,2);case"Z":return a({format:"narrow",allowZ:r.opts.allowZ});case"ZZ":return a({format:"short",allowZ:r.opts.allowZ});case"ZZZ":return a({format:"techie",allowZ:!1});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:r.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:r.loc.locale});case"z":return e.zoneName;case"a":return i?function(t){return Wt[t.hour<12?0:1]}(e):s({hour:"numeric",hour12:!0},"dayperiod");case"d":return o?s({day:"numeric"},"day"):r.num(e.day);case"dd":return o?s({day:"2-digit"},"day"):r.num(e.day,2);case"c":return r.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return r.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return o?s({month:"numeric",day:"numeric"},"month"):r.num(e.month);case"LL":return o?s({month:"2-digit",day:"numeric"},"month"):r.num(e.month,2);case"LLL":return u("short",!0);case"LLLL":return u("long",!0);case"LLLLL":return u("narrow",!0);case"M":return o?s({month:"numeric"},"month"):r.num(e.month);case"MM":return o?s({month:"2-digit"},"month"):r.num(e.month,2);case"MMM":return u("short",!1);case"MMMM":return u("long",!1);case"MMMMM":return u("narrow",!1);case"y":return o?s({year:"numeric"},"year"):r.num(e.year);case"yy":return o?s({year:"2-digit"},"year"):r.num(e.year.toString().slice(-2),2);case"yyyy":return o?s({year:"numeric"},"year"):r.num(e.year,4);case"yyyyyy":return o?s({year:"numeric"},"year"):r.num(e.year,6);case"G":return l("short");case"GG":return l("long");case"GGGGG":return l("narrow");case"kk":return r.num(e.weekYear.toString().slice(-2),2);case"kkkk":return r.num(e.weekYear,4);case"W":return r.num(e.weekNumber);case"WW":return r.num(e.weekNumber,2);case"o":return r.num(e.ordinal);case"ooo":return r.num(e.ordinal,3);case"q":return r.num(e.quarter);case"qq":return r.num(e.quarter,2);case"X":return r.num(Math.floor(e.ts/1e3));case"x":return r.num(e.ts);default:return function(n){var i=t.macroTokenToFormatOpts(n);return i?r.formatWithSystemDefault(e,i):n}(n)}}))},e.formatDurationFromString=function(e,n){var r,i=this,o=function(t){switch(t[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"M":return"month";case"y":return"year";default:return null}},s=t.parseFormat(n),a=s.reduce((function(t,e){var n=e.literal,r=e.val;return n?t:t.concat(r)}),[]),u=e.shiftTo.apply(e,a.map(o).filter((function(t){return t})));return Xt(s,(r=u,function(t){var e=o(t);return e?i.num(r.get(e),t.length):t}))},t}(),ee=function(){function t(t,e){this.reason=t,this.explanation=e}return t.prototype.toMessage=function(){return this.explanation?this.reason+": "+this.explanation:this.reason},t}(),ne=function(){function t(){}var e=t.prototype;return e.offsetName=function(t,e){throw new V},e.formatOffset=function(t,e){throw new V},e.offset=function(t){throw new V},e.equals=function(t){throw new V},S(t,[{key:"type",get:function(){throw new V}},{key:"name",get:function(){throw new V}},{key:"universal",get:function(){throw new V}},{key:"isValid",get:function(){throw new V}}]),t}(),re=null,ie=function(t){function e(){return t.apply(this,arguments)||this}j(e,t);var n=e.prototype;return n.offsetName=function(t,e){return Ft(t,e.format,e.locale)},n.formatOffset=function(t,e){return Mt(this.offset(t),e)},n.offset=function(t){return-new Date(t).getTimezoneOffset()},n.equals=function(t){return"local"===t.type},S(e,[{key:"type",get:function(){return"local"}},{key:"name",get:function(){return pt()?(new Intl.DateTimeFormat).resolvedOptions().timeZone:"local"}},{key:"universal",get:function(){return!1}},{key:"isValid",get:function(){return!0}}],[{key:"instance",get:function(){return null===re&&(re=new e),re}}]),e}(ne),oe=RegExp("^"+Pt.source+"$"),se={},ae={year:0,month:1,day:2,hour:3,minute:4,second:5},ue={},ce=function(t){function e(n){var r;return(r=t.call(this)||this).zoneName=n,r.valid=e.isValidZone(n),r}j(e,t),e.create=function(t){return ue[t]||(ue[t]=new e(t)),ue[t]},e.resetCache=function(){ue={},se={}},e.isValidSpecifier=function(t){return!(!t||!t.match(oe))},e.isValidZone=function(t){try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch(e){return!1}},e.parseGMTOffset=function(t){if(t){var e=t.match(/^Etc\/GMT([+-]\d{1,2})$/i);if(e)return-60*parseInt(e[1])}return null};var n=e.prototype;return n.offsetName=function(t,e){return Ft(t,e.format,e.locale,this.name)},n.formatOffset=function(t,e){return Mt(this.offset(t),e)},n.offset=function(t){var e,n=new Date(t),r=(e=this.name,se[e]||(se[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),se[e]),i=r.formatToParts?function(t,e){for(var n=t.formatToParts(e),r=[],i=0;i<n.length;i++){var o=n[i],s=o.type,a=o.value,u=ae[s];ht(u)||(r[u]=parseInt(a,10))}return r}(r,n):function(t,e){var n=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(n),i=r[1],o=r[2];return[r[3],i,o,r[4],r[5],r[6]]}(r,n),o=i[0],s=i[1],a=i[2],u=i[3],c=jt({year:o,month:s,day:a,hour:24===u?0:u,minute:i[4],second:i[5],millisecond:0}),l=n.valueOf();return(c-(l-=l%1e3))/6e4},n.equals=function(t){return"iana"===t.type&&t.name===this.name},S(e,[{key:"type",get:function(){return"iana"}},{key:"name",get:function(){return this.zoneName}},{key:"universal",get:function(){return!1}},{key:"isValid",get:function(){return this.valid}}]),e}(ne),le=null,he=function(t){function e(e){var n;return(n=t.call(this)||this).fixed=e,n}j(e,t),e.instance=function(t){return 0===t?e.utcInstance:new e(t)},e.parseSpecifier=function(t){if(t){var n=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(n)return new e(Nt(n[1],n[2]))}return null},S(e,null,[{key:"utcInstance",get:function(){return null===le&&(le=new e(0)),le}}]);var n=e.prototype;return n.offsetName=function(){return this.name},n.formatOffset=function(t,e){return Mt(this.fixed,e)},n.offset=function(){return this.fixed},n.equals=function(t){return"fixed"===t.type&&t.fixed===this.fixed},S(e,[{key:"type",get:function(){return"fixed"}},{key:"name",get:function(){return 0===this.fixed?"UTC":"UTC"+Mt(this.fixed,"narrow")}},{key:"universal",get:function(){return!0}},{key:"isValid",get:function(){return!0}}]),e}(ne),fe=function(t){function e(e){var n;return(n=t.call(this)||this).zoneName=e,n}j(e,t);var n=e.prototype;return n.offsetName=function(){return null},n.formatOffset=function(){return""},n.offset=function(){return NaN},n.equals=function(){return!1},S(e,[{key:"type",get:function(){return"invalid"}},{key:"name",get:function(){return this.zoneName}},{key:"universal",get:function(){return!1}},{key:"isValid",get:function(){return!1}}]),e}(ne);function de(t,e){var n;if(ht(t)||null===t)return e;if(t instanceof ne)return t;if("string"==typeof t){var r=t.toLowerCase();return"local"===r?e:"utc"===r||"gmt"===r?he.utcInstance:null!=(n=ce.parseGMTOffset(t))?he.instance(n):ce.isValidSpecifier(r)?ce.create(t):he.parseSpecifier(r)||new fe(t)}return ft(t)?he.instance(t):"object"==typeof t&&t.offset&&"number"==typeof t.offset?t:new fe(t)}var pe=function(){return Date.now()},ye=null,me=null,ve=null,ge=null,_e=!1,be=function(){function t(){}return t.resetCaches=function(){Ae.resetCache(),ce.resetCache()},S(t,null,[{key:"now",get:function(){return pe},set:function(t){pe=t}},{key:"defaultZoneName",get:function(){return t.defaultZone.name},set:function(t){ye=t?de(t):null}},{key:"defaultZone",get:function(){return ye||ie.instance}},{key:"defaultLocale",get:function(){return me},set:function(t){me=t}},{key:"defaultNumberingSystem",get:function(){return ve},set:function(t){ve=t}},{key:"defaultOutputCalendar",get:function(){return ge},set:function(t){ge=t}},{key:"throwOnInvalid",get:function(){return _e},set:function(t){_e=t}}]),t}(),we={};function ke(t,e){void 0===e&&(e={});var n=JSON.stringify([t,e]),r=we[n];return r||(r=new Intl.DateTimeFormat(t,e),we[n]=r),r}var Oe={},Ee={},Ce=null;function xe(t,e,n,r,i){var o=t.listingMode(n);return"error"===o?null:"en"===o?r(e):i(e)}var Se=function(){function t(t,e,n){if(this.padTo=n.padTo||0,this.floor=n.floor||!1,!e&&pt()){var r={useGrouping:!1};n.padTo>0&&(r.minimumIntegerDigits=n.padTo),this.inf=function(t,e){void 0===e&&(e={});var n=JSON.stringify([t,e]),r=Oe[n];return r||(r=new Intl.NumberFormat(t,e),Oe[n]=r),r}(t,r)}}return t.prototype.format=function(t){if(this.inf){var e=this.floor?Math.floor(t):t;return this.inf.format(e)}return wt(this.floor?Math.floor(t):Et(t,3),this.padTo)},t}(),je=function(){function t(t,e,n){var r;if(this.opts=n,this.hasIntl=pt(),t.zone.universal&&this.hasIntl?(r="UTC",n.timeZoneName?this.dt=t:this.dt=0===t.offset?t:Or.fromMillis(t.ts+60*t.offset*1e3)):"local"===t.zone.type?this.dt=t:(this.dt=t,r=t.zone.name),this.hasIntl){var i=Object.assign({},this.opts);r&&(i.timeZone=r),this.dtf=ke(e,i)}}var e=t.prototype;return e.format=function(){if(this.hasIntl)return this.dtf.format(this.dt.toJSDate());var t=function(t){switch(Lt(gt(t,["weekday","era","year","month","day","hour","minute","second","timeZoneName","hour12"]))){case Lt(H):return"M/d/yyyy";case Lt(B):return"LLL d, yyyy";case Lt(Z):return"LLLL d, yyyy";case Lt(W):return"EEEE, LLLL d, yyyy";case Lt(G):return"h:mm a";case Lt(J):return"h:mm:ss a";case Lt(Q):case Lt(Y):return"h:mm a";case Lt(X):return"HH:mm";case Lt(K):return"HH:mm:ss";case Lt(tt):case Lt(et):return"HH:mm";case Lt(nt):return"M/d/yyyy, h:mm a";case Lt(it):return"LLL d, yyyy, h:mm a";case Lt(at):return"LLLL d, yyyy, h:mm a";case Lt(ct):return"EEEE, LLLL d, yyyy, h:mm a";case Lt(rt):return"M/d/yyyy, h:mm:ss a";case Lt(ot):return"LLL d, yyyy, h:mm:ss a";case Lt(st):return"EEE, d LLL yyyy, h:mm a";case Lt(ut):return"LLLL d, yyyy, h:mm:ss a";case Lt(lt):return"EEEE, LLLL d, yyyy, h:mm:ss a";default:return"EEEE, LLLL d, yyyy, h:mm a"}}(this.opts),e=Ae.create("en-US");return te.create(e).formatDateTimeFromString(this.dt,t)},e.formatToParts=function(){return this.hasIntl&&yt()?this.dtf.formatToParts(this.dt.toJSDate()):[]},e.resolvedOptions=function(){return this.hasIntl?this.dtf.resolvedOptions():{locale:"en-US",numberingSystem:"latn",outputCalendar:"gregory"}},t}(),Te=function(){function t(t,e,n){this.opts=Object.assign({style:"long"},n),!e&&mt()&&(this.rtf=function(t,e){void 0===e&&(e={});var n=JSON.stringify([t,e]),r=Ee[n];return r||(r=new Intl.RelativeTimeFormat(t,e),Ee[n]=r),r}(t,n))}var e=t.prototype;return e.format=function(t,e){return this.rtf?this.rtf.format(t,e):function(t,e,n,r){void 0===n&&(n="always"),void 0===r&&(r=!1);var i={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},o=-1===["hours","minutes","seconds"].indexOf(t);if("auto"===n&&o){var s="days"===t;switch(e){case 1:return s?"tomorrow":"next "+i[t][0];case-1:return s?"yesterday":"last "+i[t][0];case 0:return s?"today":"this "+i[t][0]}}var a=Object.is(e,-0)||e<0,u=Math.abs(e),c=1===u,l=i[t],h=r?c?l[1]:l[2]||l[1]:c?i[t][0]:t;return a?u+" "+h+" ago":"in "+u+" "+h}(e,t,this.opts.numeric,"long"!==this.opts.style)},e.formatToParts=function(t,e){return this.rtf?this.rtf.formatToParts(t,e):[]},t}(),Ae=function(){function t(t,e,n,r){var i=function(t){var e=t.indexOf("-u-");if(-1===e)return[t];var n,r=t.substring(0,e);try{n=ke(t).resolvedOptions()}catch(o){n=ke(r).resolvedOptions()}var i=n;return[r,i.numberingSystem,i.calendar]}(t),o=i[0],s=i[1],a=i[2];this.locale=o,this.numberingSystem=e||s||null,this.outputCalendar=n||a||null,this.intl=function(t,e,n){return pt()?n||e?(t+="-u",n&&(t+="-ca-"+n),e&&(t+="-nu-"+e),t):t:[]}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}t.fromOpts=function(e){return t.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)},t.create=function(e,n,r,i){void 0===i&&(i=!1);var o=e||be.defaultLocale;return new t(o||(i?"en-US":function(){if(Ce)return Ce;if(pt()){var t=(new Intl.DateTimeFormat).resolvedOptions().locale;return Ce=t&&"und"!==t?t:"en-US"}return Ce="en-US"}()),n||be.defaultNumberingSystem,r||be.defaultOutputCalendar,o)},t.resetCache=function(){Ce=null,we={},Oe={},Ee={}},t.fromObject=function(e){var n=void 0===e?{}:e,r=n.locale,i=n.numberingSystem,o=n.outputCalendar;return t.create(r,i,o)};var e=t.prototype;return e.listingMode=function(t){void 0===t&&(t=!0);var e=pt()&&yt(),n=this.isEnglish(),r=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e||n&&r||t?!e||n&&r?"en":"intl":"error"},e.clone=function(e){return e&&0!==Object.getOwnPropertyNames(e).length?t.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1):this},e.redefaultToEN=function(t){return void 0===t&&(t={}),this.clone(Object.assign({},t,{defaultToEN:!0}))},e.redefaultToSystem=function(t){return void 0===t&&(t={}),this.clone(Object.assign({},t,{defaultToEN:!1}))},e.months=function(t,e,n){var r=this;return void 0===e&&(e=!1),void 0===n&&(n=!0),xe(this,t,n,qt,(function(){var n=e?{month:t,day:"numeric"}:{month:t},i=e?"format":"standalone";return r.monthsCache[i][t]||(r.monthsCache[i][t]=function(t){for(var e=[],n=1;n<=12;n++){var r=Or.utc(2016,n,1);e.push(t(r))}return e}((function(t){return r.extract(t,n,"month")}))),r.monthsCache[i][t]}))},e.weekdays=function(t,e,n){var r=this;return void 0===e&&(e=!1),void 0===n&&(n=!0),xe(this,t,n,Zt,(function(){var n=e?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},i=e?"format":"standalone";return r.weekdaysCache[i][t]||(r.weekdaysCache[i][t]=function(t){for(var e=[],n=1;n<=7;n++){var r=Or.utc(2016,11,13+n);e.push(t(r))}return e}((function(t){return r.extract(t,n,"weekday")}))),r.weekdaysCache[i][t]}))},e.meridiems=function(t){var e=this;return void 0===t&&(t=!0),xe(this,void 0,t,(function(){return Wt}),(function(){if(!e.meridiemCache){var t={hour:"numeric",hour12:!0};e.meridiemCache=[Or.utc(2016,11,13,9),Or.utc(2016,11,13,19)].map((function(n){return e.extract(n,t,"dayperiod")}))}return e.meridiemCache}))},e.eras=function(t,e){var n=this;return void 0===e&&(e=!0),xe(this,t,e,Yt,(function(){var e={era:t};return n.eraCache[t]||(n.eraCache[t]=[Or.utc(-40,1,1),Or.utc(2017,1,1)].map((function(t){return n.extract(t,e,"era")}))),n.eraCache[t]}))},e.extract=function(t,e,n){var r=this.dtFormatter(t,e).formatToParts().find((function(t){return t.type.toLowerCase()===n}));return r?r.value:null},e.numberFormatter=function(t){return void 0===t&&(t={}),new Se(this.intl,t.forceSimple||this.fastNumbers,t)},e.dtFormatter=function(t,e){return void 0===e&&(e={}),new je(t,this.intl,e)},e.relFormatter=function(t){return void 0===t&&(t={}),new Te(this.intl,this.isEnglish(),t)},e.isEnglish=function(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||pt()&&new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")},e.equals=function(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar},S(t,[{key:"fastNumbers",get:function(){return null==this.fastNumbersCached&&(this.fastNumbersCached=(!this.numberingSystem||"latn"===this.numberingSystem)&&("latn"===this.numberingSystem||!this.locale||this.locale.startsWith("en")||pt()&&"latn"===new Intl.DateTimeFormat(this.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}}]),t}();function Fe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.reduce((function(t,e){return t+e.source}),"");return RegExp("^"+r+"$")}function Ne(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce((function(e,n){var r=e[0],i=e[1],o=e[2],s=n(t,o),a=s[0],u=s[1],c=s[2];return[Object.assign(r,a),i||u,c]}),[{},null,1]).slice(0,2)}}function De(t){if(null==t)return[null,null];for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var s=o[i],a=s[0],u=s[1],c=a.exec(t);if(c)return u(c)}return[null,null]}function Ie(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t,n){var r,i={};for(r=0;r<e.length;r++)i[e[r]]=kt(t[n+r]);return[i,null,n+r]}}var Me=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Re=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,9}))?)?)?/,Pe=RegExp(""+Re.source+Me.source+"?"),Le=RegExp("(?:T"+Pe.source+")?"),$e=Ie("weekYear","weekNumber","weekDay"),Ve=Ie("year","ordinal"),Ue=RegExp(Re.source+" ?(?:"+Me.source+"|("+Pt.source+"))?"),qe=RegExp("(?: "+Ue.source+")?");function ze(t,e,n){var r=t[e];return ht(r)?n:kt(r)}function He(t,e){return[{year:ze(t,e),month:ze(t,e+1,1),day:ze(t,e+2,1)},null,e+3]}function Be(t,e){return[{hour:ze(t,e,0),minute:ze(t,e+1,0),second:ze(t,e+2,0),millisecond:Ot(t[e+3])},null,e+4]}function Ze(t,e){var n=!t[e]&&!t[e+1],r=Nt(t[e+1],t[e+2]);return[{},n?null:he.instance(r),e+3]}function We(t,e){return[{},t[e]?ce.create(t[e]):null,e+1]}var Ge=/^P(?:(?:(-?\d{1,9})Y)?(?:(-?\d{1,9})M)?(?:(-?\d{1,9})W)?(?:(-?\d{1,9})D)?(?:T(?:(-?\d{1,9})H)?(?:(-?\d{1,9})M)?(?:(-?\d{1,9})(?:[.,](-?\d{1,9}))?S)?)?)$/;function Je(t){var e=t[1],n=t[2],r=t[3],i=t[4],o=t[5],s=t[6],a=t[7],u=t[8];return[{years:kt(e),months:kt(n),weeks:kt(r),days:kt(i),hours:kt(o),minutes:kt(s),seconds:kt(a),milliseconds:Ot(u)}]}var Qe={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Ye(t,e,n,r,i,o,s){var a={year:2===e.length?At(kt(e)):kt(e),month:Vt.indexOf(n)+1,day:kt(r),hour:kt(i),minute:kt(o)};return s&&(a.second=kt(s)),t&&(a.weekday=t.length>3?zt.indexOf(t)+1:Ht.indexOf(t)+1),a}var Xe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Ke(t){var e,n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],u=t[7],c=t[8],l=t[9],h=t[10],f=t[11],d=Ye(n,o,i,r,s,a,u);return e=c?Qe[c]:l?0:Nt(h,f),[d,new he(e)]}var tn=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,en=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,nn=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function rn(t){var e=t[1],n=t[2],r=t[3];return[Ye(e,t[4],r,n,t[5],t[6],t[7]),he.utcInstance]}function on(t){var e=t[1],n=t[2],r=t[3],i=t[4],o=t[5],s=t[6];return[Ye(e,t[7],n,r,i,o,s),he.utcInstance]}var sn=Fe(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Le),an=Fe(/(\d{4})-?W(\d\d)(?:-?(\d))?/,Le),un=Fe(/(\d{4})-?(\d{3})/,Le),cn=Fe(Pe),ln=Ne(He,Be,Ze),hn=Ne($e,Be,Ze),fn=Ne(Ve,Be),dn=Ne(Be,Ze),pn=Fe(/(\d{4})-(\d\d)-(\d\d)/,qe),yn=Fe(Ue),mn=Ne(He,Be,Ze,We),vn=Ne(Be,Ze,We),gn={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},_n=Object.assign({years:{months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6}},gn),bn=Object.assign({years:{months:12,weeks:52.1775,days:365.2425,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:30.436875/7,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3}},gn),wn=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],kn=wn.slice(0).reverse();function On(t,e,n){void 0===n&&(n=!1);var r={values:n?e.values:Object.assign({},t.values,e.values||{}),loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy};return new xn(r)}function En(t,e,n,r,i){var o,s=t[i][n],a=e[n]/s,u=Math.sign(a)!==Math.sign(r[i])&&0!==r[i]&&Math.abs(a)<=1?(o=a)<0?Math.floor(o):Math.ceil(o):Math.trunc(a);r[i]+=u,e[n]-=u*s}function Cn(t,e){kn.reduce((function(n,r){return ht(e[r])?n:(n&&En(t,e,n,e,r),r)}),null)}var xn=function(){function t(t){var e="longterm"===t.conversionAccuracy||!1;this.values=t.values,this.loc=t.loc||Ae.create(),this.conversionAccuracy=e?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=e?bn:_n,this.isLuxonDuration=!0}t.fromMillis=function(e,n){return t.fromObject(Object.assign({milliseconds:e},n))},t.fromObject=function(e){if(null==e||"object"!=typeof e)throw new $("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new t({values:It(e,t.normalizeUnit,["locale","numberingSystem","conversionAccuracy","zone"]),loc:Ae.fromObject(e),conversionAccuracy:e.conversionAccuracy})},t.fromISO=function(e,n){var r=De(e,[Ge,Je])[0];if(r){var i=Object.assign(r,n);return t.fromObject(i)}return t.invalid("unparsable",'the input "'+e+"\" can't be parsed as ISO 8601")},t.invalid=function(e,n){if(void 0===n&&(n=null),!e)throw new $("need to specify a reason the Duration is invalid");var r=e instanceof ee?e:new ee(e,n);if(be.throwOnInvalid)throw new R(r);return new t({invalid:r})},t.normalizeUnit=function(t){var e={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t?t.toLowerCase():t];if(!e)throw new L(t);return e},t.isDuration=function(t){return t&&t.isLuxonDuration||!1};var e=t.prototype;return e.toFormat=function(t,e){void 0===e&&(e={});var n=Object.assign({},e,{floor:!1!==e.round&&!1!==e.floor});return this.isValid?te.create(this.loc,n).formatDurationFromString(this,t):"Invalid Duration"},e.toObject=function(t){if(void 0===t&&(t={}),!this.isValid)return{};var e=Object.assign({},this.values);return t.includeConfig&&(e.conversionAccuracy=this.conversionAccuracy,e.numberingSystem=this.loc.numberingSystem,e.locale=this.loc.locale),e},e.toISO=function(){if(!this.isValid)return null;var t="P";return 0!==this.years&&(t+=this.years+"Y"),0===this.months&&0===this.quarters||(t+=this.months+3*this.quarters+"M"),0!==this.weeks&&(t+=this.weeks+"W"),0!==this.days&&(t+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(t+="T"),0!==this.hours&&(t+=this.hours+"H"),0!==this.minutes&&(t+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(t+=Et(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===t&&(t+="T0S"),t},e.toJSON=function(){return this.toISO()},e.toString=function(){return this.toISO()},e.valueOf=function(){return this.as("milliseconds")},e.plus=function(t){if(!this.isValid)return this;for(var e=Sn(t),n={},r=0,i=wn;r<i.length;r++){var o=i[r];(_t(e.values,o)||_t(this.values,o))&&(n[o]=e.get(o)+this.get(o))}return On(this,{values:n},!0)},e.minus=function(t){if(!this.isValid)return this;var e=Sn(t);return this.plus(e.negate())},e.mapUnits=function(t){if(!this.isValid)return this;for(var e={},n=0,r=Object.keys(this.values);n<r.length;n++){var i=r[n];e[i]=Dt(t(this.values[i],i))}return On(this,{values:e},!0)},e.get=function(e){return this[t.normalizeUnit(e)]},e.set=function(e){return this.isValid?On(this,{values:Object.assign(this.values,It(e,t.normalizeUnit,[]))}):this},e.reconfigure=function(t){var e=void 0===t?{}:t,n=e.locale,r=e.numberingSystem,i=e.conversionAccuracy,o={loc:this.loc.clone({locale:n,numberingSystem:r})};return i&&(o.conversionAccuracy=i),On(this,o)},e.as=function(t){return this.isValid?this.shiftTo(t).get(t):NaN},e.normalize=function(){if(!this.isValid)return this;var t=this.toObject();return Cn(this.matrix,t),On(this,{values:t},!0)},e.shiftTo=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(!this.isValid)return this;if(0===n.length)return this;n=n.map((function(e){return t.normalizeUnit(e)}));var i,o={},s={},a=this.toObject();Cn(this.matrix,a);for(var u=0,c=wn;u<c.length;u++){var l=c[u];if(n.indexOf(l)>=0){i=l;var h=0;for(var f in s)h+=this.matrix[f][l]*s[f],s[f]=0;ft(a[l])&&(h+=a[l]);var d=Math.trunc(h);for(var p in o[l]=d,s[l]=h-d,a)wn.indexOf(p)>wn.indexOf(l)&&En(this.matrix,a,p,o,l)}else ft(a[l])&&(s[l]=a[l])}for(var y in s)0!==s[y]&&(o[i]+=y===i?s[y]:s[y]/this.matrix[i][y]);return On(this,{values:o},!0).normalize()},e.negate=function(){if(!this.isValid)return this;for(var t={},e=0,n=Object.keys(this.values);e<n.length;e++){var r=n[e];t[r]=-this.values[r]}return On(this,{values:t},!0)},e.equals=function(t){if(!this.isValid||!t.isValid)return!1;if(!this.loc.equals(t.loc))return!1;for(var e=0,n=wn;e<n.length;e++){var r=n[e];if(this.values[r]!==t.values[r])return!1}return!0},S(t,[{key:"locale",get:function(){return this.isValid?this.loc.locale:null}},{key:"numberingSystem",get:function(){return this.isValid?this.loc.numberingSystem:null}},{key:"years",get:function(){return this.isValid?this.values.years||0:NaN}},{key:"quarters",get:function(){return this.isValid?this.values.quarters||0:NaN}},{key:"months",get:function(){return this.isValid?this.values.months||0:NaN}},{key:"weeks",get:function(){return this.isValid?this.values.weeks||0:NaN}},{key:"days",get:function(){return this.isValid?this.values.days||0:NaN}},{key:"hours",get:function(){return this.isValid?this.values.hours||0:NaN}},{key:"minutes",get:function(){return this.isValid?this.values.minutes||0:NaN}},{key:"seconds",get:function(){return this.isValid?this.values.seconds||0:NaN}},{key:"milliseconds",get:function(){return this.isValid?this.values.milliseconds||0:NaN}},{key:"isValid",get:function(){return null===this.invalid}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}}]),t}();function Sn(t){if(ft(t))return xn.fromMillis(t);if(xn.isDuration(t))return t;if("object"==typeof t)return xn.fromObject(t);throw new $("Unknown duration argument "+t+" of type "+typeof t)}var jn="Invalid Interval";function Tn(t,e){return t&&t.isValid?e&&e.isValid?e<t?An.invalid("end before start","The end of an interval must be after its start, but you had start="+t.toISO()+" and end="+e.toISO()):null:An.invalid("missing or invalid end"):An.invalid("missing or invalid start")}var An=function(){function t(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}t.invalid=function(e,n){if(void 0===n&&(n=null),!e)throw new $("need to specify a reason the Interval is invalid");var r=e instanceof ee?e:new ee(e,n);if(be.throwOnInvalid)throw new M(r);return new t({invalid:r})},t.fromDateTimes=function(e,n){var r=Er(e),i=Er(n),o=Tn(r,i);return null==o?new t({start:r,end:i}):o},t.after=function(e,n){var r=Sn(n),i=Er(e);return t.fromDateTimes(i,i.plus(r))},t.before=function(e,n){var r=Sn(n),i=Er(e);return t.fromDateTimes(i.minus(r),i)},t.fromISO=function(e,n){var r=(e||"").split("/",2),i=r[0],o=r[1];if(i&&o){var s=Or.fromISO(i,n),a=Or.fromISO(o,n);if(s.isValid&&a.isValid)return t.fromDateTimes(s,a);if(s.isValid){var u=xn.fromISO(o,n);if(u.isValid)return t.after(s,u)}else if(a.isValid){var c=xn.fromISO(i,n);if(c.isValid)return t.before(a,c)}}return t.invalid("unparsable",'the input "'+e+"\" can't be parsed asISO 8601")},t.isInterval=function(t){return t&&t.isLuxonInterval||!1};var e=t.prototype;return e.length=function(t){return void 0===t&&(t="milliseconds"),this.isValid?this.toDuration.apply(this,[t]).get(t):NaN},e.count=function(t){if(void 0===t&&(t="milliseconds"),!this.isValid)return NaN;var e=this.start.startOf(t),n=this.end.startOf(t);return Math.floor(n.diff(e,t).get(t))+1},e.hasSame=function(t){return!!this.isValid&&this.e.minus(1).hasSame(this.s,t)},e.isEmpty=function(){return this.s.valueOf()===this.e.valueOf()},e.isAfter=function(t){return!!this.isValid&&this.s>t},e.isBefore=function(t){return!!this.isValid&&this.e<=t},e.contains=function(t){return!!this.isValid&&this.s<=t&&this.e>t},e.set=function(e){var n=void 0===e?{}:e,r=n.start,i=n.end;return this.isValid?t.fromDateTimes(r||this.s,i||this.e):this},e.splitAt=function(){var e=this;if(!this.isValid)return[];for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(var o=r.map(Er).filter((function(t){return e.contains(t)})).sort(),s=[],a=this.s,u=0;a<this.e;){var c=o[u]||this.e,l=+c>+this.e?this.e:c;s.push(t.fromDateTimes(a,l)),a=l,u+=1}return s},e.splitBy=function(e){var n=Sn(e);if(!this.isValid||!n.isValid||0===n.as("milliseconds"))return[];for(var r,i,o=this.s,s=[];o<this.e;)i=+(r=o.plus(n))>+this.e?this.e:r,s.push(t.fromDateTimes(o,i)),o=i;return s},e.divideEqually=function(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]},e.overlaps=function(t){return this.e>t.s&&this.s<t.e},e.abutsStart=function(t){return!!this.isValid&&+this.e==+t.s},e.abutsEnd=function(t){return!!this.isValid&&+t.e==+this.s},e.engulfs=function(t){return!!this.isValid&&this.s<=t.s&&this.e>=t.e},e.equals=function(t){return!(!this.isValid||!t.isValid)&&this.s.equals(t.s)&&this.e.equals(t.e)},e.intersection=function(e){if(!this.isValid)return this;var n=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return n>r?null:t.fromDateTimes(n,r)},e.union=function(e){if(!this.isValid)return this;var n=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return t.fromDateTimes(n,r)},t.merge=function(t){var e=t.sort((function(t,e){return t.s-e.s})).reduce((function(t,e){var n=t[0],r=t[1];return r?r.overlaps(e)||r.abutsStart(e)?[n,r.union(e)]:[n.concat([r]),e]:[n,e]}),[[],null]),n=e[0],r=e[1];return r&&n.push(r),n},t.xor=function(e){var n,r=null,i=0,o=[],s=e.map((function(t){return[{time:t.s,type:"s"},{time:t.e,type:"e"}]})),a=(n=Array.prototype).concat.apply(n,s).sort((function(t,e){return t.time-e.time})),u=Array.isArray(a),c=0;for(a=u?a:a[Symbol.iterator]();;){var l;if(u){if(c>=a.length)break;l=a[c++]}else{if((c=a.next()).done)break;l=c.value}var h=l;1===(i+="s"===h.type?1:-1)?r=h.time:(r&&+r!=+h.time&&o.push(t.fromDateTimes(r,h.time)),r=null)}return t.merge(o)},e.difference=function(){for(var e=this,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.xor([this].concat(r)).map((function(t){return e.intersection(t)})).filter((function(t){return t&&!t.isEmpty()}))},e.toString=function(){return this.isValid?"["+this.s.toISO()+" \u2013 "+this.e.toISO()+")":jn},e.toISO=function(t){return this.isValid?this.s.toISO(t)+"/"+this.e.toISO(t):jn},e.toISODate=function(){return this.isValid?this.s.toISODate()+"/"+this.e.toISODate():jn},e.toISOTime=function(t){return this.isValid?this.s.toISOTime(t)+"/"+this.e.toISOTime(t):jn},e.toFormat=function(t,e){var n=(void 0===e?{}:e).separator,r=void 0===n?" \u2013 ":n;return this.isValid?""+this.s.toFormat(t)+r+this.e.toFormat(t):jn},e.toDuration=function(t,e){return this.isValid?this.e.diff(this.s,t,e):xn.invalid(this.invalidReason)},e.mapEndpoints=function(e){return t.fromDateTimes(e(this.s),e(this.e))},S(t,[{key:"start",get:function(){return this.isValid?this.s:null}},{key:"end",get:function(){return this.isValid?this.e:null}},{key:"isValid",get:function(){return null===this.invalidReason}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}}]),t}(),Fn=function(){function t(){}return t.hasDST=function(t){void 0===t&&(t=be.defaultZone);var e=Or.local().setZone(t).set({month:12});return!t.universal&&e.offset!==e.set({month:6}).offset},t.isValidIANAZone=function(t){return ce.isValidSpecifier(t)&&ce.isValidZone(t)},t.normalizeZone=function(t){return de(t,be.defaultZone)},t.months=function(t,e){void 0===t&&(t="long");var n=void 0===e?{}:e,r=n.locale,i=void 0===r?null:r,o=n.numberingSystem,s=void 0===o?null:o,a=n.outputCalendar,u=void 0===a?"gregory":a;return Ae.create(i,s,u).months(t)},t.monthsFormat=function(t,e){void 0===t&&(t="long");var n=void 0===e?{}:e,r=n.locale,i=void 0===r?null:r,o=n.numberingSystem,s=void 0===o?null:o,a=n.outputCalendar,u=void 0===a?"gregory":a;return Ae.create(i,s,u).months(t,!0)},t.weekdays=function(t,e){void 0===t&&(t="long");var n=void 0===e?{}:e,r=n.locale,i=void 0===r?null:r,o=n.numberingSystem,s=void 0===o?null:o;return Ae.create(i,s,null).weekdays(t)},t.weekdaysFormat=function(t,e){void 0===t&&(t="long");var n=void 0===e?{}:e,r=n.locale,i=void 0===r?null:r,o=n.numberingSystem,s=void 0===o?null:o;return Ae.create(i,s,null).weekdays(t,!0)},t.meridiems=function(t){var e=(void 0===t?{}:t).locale,n=void 0===e?null:e;return Ae.create(n).meridiems()},t.eras=function(t,e){void 0===t&&(t="short");var n=(void 0===e?{}:e).locale,r=void 0===n?null:n;return Ae.create(r,null,"gregory").eras(t)},t.features=function(){var t=!1,e=!1,n=!1,r=!1;if(pt()){t=!0,e=yt(),r=mt();try{n="America/New_York"===new Intl.DateTimeFormat("en",{timeZone:"America/New_York"}).resolvedOptions().timeZone}catch(i){n=!1}}return{intl:t,intlTokens:e,zones:n,relative:r}},t}();function Nn(t,e){var n=function(t){return t.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf()},r=n(e)-n(t);return Math.floor(xn.fromMillis(r).as("days"))}var Dn={arab:"[\u0660-\u0669]",arabext:"[\u06f0-\u06f9]",bali:"[\u1b50-\u1b59]",beng:"[\u09e6-\u09ef]",deva:"[\u0966-\u096f]",fullwide:"[\uff10-\uff19]",gujr:"[\u0ae6-\u0aef]",hanidec:"[\u3007|\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d]",khmr:"[\u17e0-\u17e9]",knda:"[\u0ce6-\u0cef]",laoo:"[\u0ed0-\u0ed9]",limb:"[\u1946-\u194f]",mlym:"[\u0d66-\u0d6f]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0b66-\u0b6f]",tamldec:"[\u0be6-\u0bef]",telu:"[\u0c66-\u0c6f]",thai:"[\u0e50-\u0e59]",tibt:"[\u0f20-\u0f29]",latn:"\\d"},In={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Mn=Dn.hanidec.replace(/[\[|\]]/g,"").split("");function Rn(t,e){var n=t.numberingSystem;return void 0===e&&(e=""),new RegExp(""+Dn[n||"latn"]+e)}function Pn(t,e){return void 0===e&&(e=function(t){return t}),{regex:t,deser:function(t){var n=t[0];return e(function(t){var e=parseInt(t,10);if(isNaN(e)){e="";for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);if(-1!==t[n].search(Dn.hanidec))e+=Mn.indexOf(t[n]);else for(var i in In){var o=In[i],s=o[0],a=o[1];r>=s&&r<=a&&(e+=r-s)}}return parseInt(e,10)}return e}(n))}}}function Ln(t){return t.replace(/\./,"\\.?")}function $n(t){return t.replace(/\./,"").toLowerCase()}function Vn(t,e){return null===t?null:{regex:RegExp(t.map(Ln).join("|")),deser:function(n){var r=n[0];return t.findIndex((function(t){return $n(r)===$n(t)}))+e}}}function Un(t,e){return{regex:t,deser:function(t){return Nt(t[1],t[2])},groups:e}}function qn(t){return{regex:t,deser:function(t){return t[0]}}}var zn={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}},Hn=null;function Bn(t,e,n){var r=function(t,e){var n;return(n=Array.prototype).concat.apply(n,t.map((function(t){return function(t,e){if(t.literal)return t;var n=te.macroTokenToFormatOpts(t.val);if(!n)return t;var r=te.create(e,n).formatDateTimeParts((Hn||(Hn=Or.fromMillis(1555555555555)),Hn)).map((function(t){return function(t,e,n){var r=t.type,i=t.value;if("literal"===r)return{literal:!0,val:i};var o=n[r],s=zn[r];return"object"==typeof s&&(s=s[o]),s?{literal:!1,val:s}:void 0}(t,0,n)}));return r.includes(void 0)?t:r}(t,e)})))}(te.parseFormat(n),t),i=r.map((function(e){return n=e,i=Rn(r=t),o=Rn(r,"{2}"),s=Rn(r,"{3}"),a=Rn(r,"{4}"),u=Rn(r,"{6}"),c=Rn(r,"{1,2}"),l=Rn(r,"{1,3}"),h=Rn(r,"{1,6}"),f=Rn(r,"{1,9}"),d=Rn(r,"{2,4}"),p=Rn(r,"{4,6}"),y=function(t){return{regex:RegExp((e=t.val,e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:function(t){return t[0]},literal:!0};var e},(m=function(t){if(n.literal)return y(t);switch(t.val){case"G":return Vn(r.eras("short",!1),0);case"GG":return Vn(r.eras("long",!1),0);case"y":return Pn(h);case"yy":return Pn(d,At);case"yyyy":return Pn(a);case"yyyyy":return Pn(p);case"yyyyyy":return Pn(u);case"M":return Pn(c);case"MM":return Pn(o);case"MMM":return Vn(r.months("short",!0,!1),1);case"MMMM":return Vn(r.months("long",!0,!1),1);case"L":return Pn(c);case"LL":return Pn(o);case"LLL":return Vn(r.months("short",!1,!1),1);case"LLLL":return Vn(r.months("long",!1,!1),1);case"d":return Pn(c);case"dd":return Pn(o);case"o":return Pn(l);case"ooo":return Pn(s);case"HH":return Pn(o);case"H":return Pn(c);case"hh":return Pn(o);case"h":return Pn(c);case"mm":return Pn(o);case"m":case"q":return Pn(c);case"qq":return Pn(o);case"s":return Pn(c);case"ss":return Pn(o);case"S":return Pn(l);case"SSS":return Pn(s);case"u":return qn(f);case"a":return Vn(r.meridiems(),0);case"kkkk":return Pn(a);case"kk":return Pn(d,At);case"W":return Pn(c);case"WW":return Pn(o);case"E":case"c":return Pn(i);case"EEE":return Vn(r.weekdays("short",!1,!1),1);case"EEEE":return Vn(r.weekdays("long",!1,!1),1);case"ccc":return Vn(r.weekdays("short",!0,!1),1);case"cccc":return Vn(r.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Un(new RegExp("([+-]"+c.source+")(?::("+o.source+"))?"),2);case"ZZZ":return Un(new RegExp("([+-]"+c.source+")("+o.source+")?"),2);case"z":return qn(/[a-z_+-/]{1,256}?/i);default:return y(t)}}(n)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"}).token=n,m;var n,r,i,o,s,a,u,c,l,h,f,d,p,y,m})),o=i.find((function(t){return t.invalidReason}));if(o)return{input:e,tokens:r,invalidReason:o.invalidReason};var s=function(t){return["^"+t.map((function(t){return t.regex})).reduce((function(t,e){return t+"("+e.source+")"}),"")+"$",t]}(i),a=s[0],u=s[1],c=RegExp(a,"i"),l=function(t,e,n){var r=t.match(e);if(r){var i={},o=1;for(var s in n)if(_t(n,s)){var a=n[s],u=a.groups?a.groups+1:1;!a.literal&&a.token&&(i[a.token.val[0]]=a.deser(r.slice(o,o+u))),o+=u}return[r,i]}return[r,{}]}(e,c,u),h=l[0],f=l[1],d=f?function(t){var e;return e=ht(t.Z)?ht(t.z)?null:ce.create(t.z):new he(t.Z),ht(t.q)||(t.M=3*(t.q-1)+1),ht(t.h)||(t.h<12&&1===t.a?t.h+=12:12===t.h&&0===t.a&&(t.h=0)),0===t.G&&t.y&&(t.y=-t.y),ht(t.u)||(t.S=Ot(t.u)),[Object.keys(t).reduce((function(e,n){var r=function(t){switch(t){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}}(n);return r&&(e[r]=t[n]),e}),{}),e]}(f):[null,null];return{input:e,tokens:r,regex:c,rawMatches:h,matches:f,result:d[0],zone:d[1]}}var Zn=[0,31,59,90,120,151,181,212,243,273,304,334],Wn=[0,31,60,91,121,152,182,213,244,274,305,335];function Gn(t,e){return new ee("unit out of range","you specified "+e+" (of type "+typeof e+") as a "+t+", which is invalid")}function Jn(t,e,n){var r=new Date(Date.UTC(t,e-1,n)).getUTCDay();return 0===r?7:r}function Qn(t,e,n){return n+(Ct(t)?Wn:Zn)[e-1]}function Yn(t,e){var n=Ct(t)?Wn:Zn,r=n.findIndex((function(t){return t<e}));return{month:r+1,day:e-n[r]}}function Xn(t){var e,n=t.year,r=t.month,i=t.day,o=Qn(n,r,i),s=Jn(n,r,i),a=Math.floor((o-s+10)/7);return a<1?a=Tt(e=n-1):a>Tt(n)?(e=n+1,a=1):e=n,Object.assign({weekYear:e,weekNumber:a,weekday:s},Rt(t))}function Kn(t){var e,n=t.weekYear,r=t.weekNumber,i=t.weekday,o=Jn(n,1,4),s=xt(n),a=7*r+i-o-3;a<1?a+=xt(e=n-1):a>s?(e=n+1,a-=xt(n)):e=n;var u=Yn(e,a),c=u.month,l=u.day;return Object.assign({year:e,month:c,day:l},Rt(t))}function tr(t){var e=t.year,n=Qn(e,t.month,t.day);return Object.assign({year:e,ordinal:n},Rt(t))}function er(t){var e=t.year,n=Yn(e,t.ordinal),r=n.month,i=n.day;return Object.assign({year:e,month:r,day:i},Rt(t))}function nr(t){var e=dt(t.year),n=bt(t.month,1,12),r=bt(t.day,1,St(t.year,t.month));return e?n?!r&&Gn("day",t.day):Gn("month",t.month):Gn("year",t.year)}function rr(t){var e=t.hour,n=t.minute,r=t.second,i=t.millisecond,o=bt(e,0,23)||24===e&&0===n&&0===r&&0===i,s=bt(n,0,59),a=bt(r,0,59),u=bt(i,0,999);return o?s?a?!u&&Gn("millisecond",i):Gn("second",r):Gn("minute",n):Gn("hour",e)}function ir(t){return new ee("unsupported zone",'the zone "'+t.name+'" is not supported')}function or(t){return null===t.weekData&&(t.weekData=Xn(t.c)),t.weekData}function sr(t,e){var n={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Or(Object.assign({},n,e,{old:n}))}function ar(t,e,n){var r=t-60*e*1e3,i=n.offset(r);if(e===i)return[r,e];r-=60*(i-e)*1e3;var o=n.offset(r);return i===o?[r,i]:[t-60*Math.min(i,o)*1e3,Math.max(i,o)]}function ur(t,e){var n=new Date(t+=60*e*1e3);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function cr(t,e,n){return ar(jt(t),e,n)}function lr(t,e){var n,r=Object.keys(e.values);-1===r.indexOf("milliseconds")&&r.push("milliseconds"),e=(n=e).shiftTo.apply(n,r);var i=t.o,o=t.c.year+e.years,s=t.c.month+e.months+3*e.quarters,a=Object.assign({},t.c,{year:o,month:s,day:Math.min(t.c.day,St(o,s))+e.days+7*e.weeks}),u=xn.fromObject({hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),c=ar(jt(a),i,t.zone),l=c[0],h=c[1];return 0!==u&&(l+=u,h=t.zone.offset(l)),{ts:l,o:h}}function hr(t,e,n,r,i){var o=n.setZone,s=n.zone;if(t&&0!==Object.keys(t).length){var a=e||s,u=Or.fromObject(Object.assign(t,n,{zone:a,setZone:void 0}));return o?u:u.setZone(s)}return Or.invalid(new ee("unparsable",'the input "'+i+"\" can't be parsed as "+r))}function fr(t,e){return t.isValid?te.create(Ae.create("en-US"),{allowZ:!0,forceSimple:!0}).formatDateTimeFromString(t,e):null}function dr(t,e){var n=e.suppressSeconds,r=void 0!==n&&n,i=e.suppressMilliseconds,o=void 0!==i&&i,s=e.includeOffset,a=e.includeZone,u=void 0!==a&&a,c=e.spaceZone,l=void 0!==c&&c,h="HH:mm";return r&&0===t.second&&0===t.millisecond||(h+=":ss",o&&0===t.millisecond||(h+=".SSS")),(u||s)&&l&&(h+=" "),u?h+="z":s&&(h+="ZZ"),fr(t,h)}var pr={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},yr={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},mr={ordinal:1,hour:0,minute:0,second:0,millisecond:0},vr=["year","month","day","hour","minute","second","millisecond"],gr=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],_r=["year","ordinal","hour","minute","second","millisecond"];function br(t){var e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new L(t);return e}function wr(t,e){for(var n=0,r=vr;n<r.length;n++){var i=r[n];ht(t[i])&&(t[i]=pr[i])}var o=nr(t)||rr(t);if(o)return Or.invalid(o);var s=be.now(),a=cr(t,e.offset(s),e),u=a[0],c=a[1];return new Or({ts:u,zone:e,o:c})}function kr(t,e,n){var r=!!ht(n.round)||n.round,i=function(t,i){return t=Et(t,r||n.calendary?0:2,!0),e.loc.clone(n).relFormatter(n).format(t,i)},o=function(r){return n.calendary?e.hasSame(t,r)?0:e.startOf(r).diff(t.startOf(r),r).get(r):e.diff(t,r).get(r)};if(n.unit)return i(o(n.unit),n.unit);var s=n.units,a=Array.isArray(s),u=0;for(s=a?s:s[Symbol.iterator]();;){var c;if(a){if(u>=s.length)break;c=s[u++]}else{if((u=s.next()).done)break;c=u.value}var l=c,h=o(l);if(Math.abs(h)>=1)return i(h,l)}return i(0,n.units[n.units.length-1])}var Or=function(){function t(t){var e=t.zone||be.defaultZone,n=t.invalid||(Number.isNaN(t.ts)?new ee("invalid input"):null)||(e.isValid?null:ir(e));this.ts=ht(t.ts)?be.now():t.ts;var r=null,i=null;if(!n)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(e)){var o=[t.old.c,t.old.o];r=o[0],i=o[1]}else r=ur(this.ts,e.offset(this.ts)),r=(n=Number.isNaN(r.year)?new ee("invalid input"):null)?null:r,i=n?null:e.offset(this.ts);this._zone=e,this.loc=t.loc||Ae.create(),this.invalid=n,this.weekData=null,this.c=r,this.o=i,this.isLuxonDateTime=!0}t.local=function(e,n,r,i,o,s,a){return ht(e)?new t({ts:be.now()}):wr({year:e,month:n,day:r,hour:i,minute:o,second:s,millisecond:a},be.defaultZone)},t.utc=function(e,n,r,i,o,s,a){return ht(e)?new t({ts:be.now(),zone:he.utcInstance}):wr({year:e,month:n,day:r,hour:i,minute:o,second:s,millisecond:a},he.utcInstance)},t.fromJSDate=function(e,n){void 0===n&&(n={});var r,i=(r=e,"[object Date]"===Object.prototype.toString.call(r)?e.valueOf():NaN);if(Number.isNaN(i))return t.invalid("invalid input");var o=de(n.zone,be.defaultZone);return o.isValid?new t({ts:i,zone:o,loc:Ae.fromObject(n)}):t.invalid(ir(o))},t.fromMillis=function(e,n){if(void 0===n&&(n={}),ft(e))return e<-864e13||e>864e13?t.invalid("Timestamp out of range"):new t({ts:e,zone:de(n.zone,be.defaultZone),loc:Ae.fromObject(n)});throw new $("fromMillis requires a numerical input")},t.fromSeconds=function(e,n){if(void 0===n&&(n={}),ft(e))return new t({ts:1e3*e,zone:de(n.zone,be.defaultZone),loc:Ae.fromObject(n)});throw new $("fromSeconds requires a numerical input")},t.fromObject=function(e){var n=de(e.zone,be.defaultZone);if(!n.isValid)return t.invalid(ir(n));var r=be.now(),i=n.offset(r),o=It(e,br,["zone","locale","outputCalendar","numberingSystem"]),s=!ht(o.ordinal),a=!ht(o.year),u=!ht(o.month)||!ht(o.day),c=a||u,l=o.weekYear||o.weekNumber,h=Ae.fromObject(e);if((c||s)&&l)throw new P("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&s)throw new P("Can't mix ordinal dates with month/day");var f,d,p=l||o.weekday&&!c,y=ur(r,i);p?(f=gr,d=yr,y=Xn(y)):s?(f=_r,d=mr,y=tr(y)):(f=vr,d=pr);var m=!1,v=f,g=Array.isArray(v),_=0;for(v=g?v:v[Symbol.iterator]();;){var b;if(g){if(_>=v.length)break;b=v[_++]}else{if((_=v.next()).done)break;b=_.value}var w=b;ht(o[w])?o[w]=m?d[w]:y[w]:m=!0}var k=(p?function(t){var e=dt(t.weekYear),n=bt(t.weekNumber,1,Tt(t.weekYear)),r=bt(t.weekday,1,7);return e?n?!r&&Gn("weekday",t.weekday):Gn("week",t.week):Gn("weekYear",t.weekYear)}(o):s?function(t){var e=dt(t.year),n=bt(t.ordinal,1,xt(t.year));return e?!n&&Gn("ordinal",t.ordinal):Gn("year",t.year)}(o):nr(o))||rr(o);if(k)return t.invalid(k);var O=cr(p?Kn(o):s?er(o):o,i,n),E=new t({ts:O[0],zone:n,o:O[1],loc:h});return o.weekday&&c&&e.weekday!==E.weekday?t.invalid("mismatched weekday","you can't specify both a weekday of "+o.weekday+" and a date of "+E.toISO()):E},t.fromISO=function(t,e){void 0===e&&(e={});var n=De(t,[sn,ln],[an,hn],[un,fn],[cn,dn]);return hr(n[0],n[1],e,"ISO 8601",t)},t.fromRFC2822=function(t,e){void 0===e&&(e={});var n=De(function(t){return t.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(t),[Xe,Ke]);return hr(n[0],n[1],e,"RFC 2822",t)},t.fromHTTP=function(t,e){void 0===e&&(e={});var n=De(t,[tn,rn],[en,rn],[nn,on]);return hr(n[0],n[1],e,"HTTP",e)},t.fromFormat=function(e,n,r){if(void 0===r&&(r={}),ht(e)||ht(n))throw new $("fromFormat requires an input string and a format");var i=r,o=i.locale,s=void 0===o?null:o,a=i.numberingSystem,u=void 0===a?null:a,c=function(t,e,n){var r=Bn(t,e,n);return[r.result,r.zone,r.invalidReason]}(Ae.fromOpts({locale:s,numberingSystem:u,defaultToEN:!0}),e,n),l=c[0],h=c[1],f=c[2];return f?t.invalid(f):hr(l,h,r,"format "+n,e)},t.fromString=function(e,n,r){return void 0===r&&(r={}),t.fromFormat(e,n,r)},t.fromSQL=function(t,e){void 0===e&&(e={});var n=De(t,[pn,mn],[yn,vn]);return hr(n[0],n[1],e,"SQL",t)},t.invalid=function(e,n){if(void 0===n&&(n=null),!e)throw new $("need to specify a reason the DateTime is invalid");var r=e instanceof ee?e:new ee(e,n);if(be.throwOnInvalid)throw new I(r);return new t({invalid:r})},t.isDateTime=function(t){return t&&t.isLuxonDateTime||!1};var e=t.prototype;return e.get=function(t){return this[t]},e.resolvedLocaleOpts=function(t){void 0===t&&(t={});var e=te.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:e.locale,numberingSystem:e.numberingSystem,outputCalendar:e.calendar}},e.toUTC=function(t,e){return void 0===t&&(t=0),void 0===e&&(e={}),this.setZone(he.instance(t),e)},e.toLocal=function(){return this.setZone(be.defaultZone)},e.setZone=function(e,n){var r=void 0===n?{}:n,i=r.keepLocalTime,o=void 0!==i&&i,s=r.keepCalendarTime,a=void 0!==s&&s;if((e=de(e,be.defaultZone)).equals(this.zone))return this;if(e.isValid){var u=this.ts;if(o||a){var c=this.o-e.offset(this.ts);u=cr(this.toObject(),c,e)[0]}return sr(this,{ts:u,zone:e})}return t.invalid(ir(e))},e.reconfigure=function(t){var e=void 0===t?{}:t,n=e.locale,r=e.numberingSystem,i=e.outputCalendar;return sr(this,{loc:this.loc.clone({locale:n,numberingSystem:r,outputCalendar:i})})},e.setLocale=function(t){return this.reconfigure({locale:t})},e.set=function(t){if(!this.isValid)return this;var e,n=It(t,br,[]);ht(n.weekYear)&&ht(n.weekNumber)&&ht(n.weekday)?ht(n.ordinal)?(e=Object.assign(this.toObject(),n),ht(n.day)&&(e.day=Math.min(St(e.year,e.month),e.day))):e=er(Object.assign(tr(this.c),n)):e=Kn(Object.assign(Xn(this.c),n));var r=cr(e,this.o,this.zone);return sr(this,{ts:r[0],o:r[1]})},e.plus=function(t){return this.isValid?sr(this,lr(this,Sn(t))):this},e.minus=function(t){return this.isValid?sr(this,lr(this,Sn(t).negate())):this},e.startOf=function(t){if(!this.isValid)return this;var e={},n=xn.normalizeUnit(t);switch(n){case"years":e.month=1;case"quarters":case"months":e.day=1;case"weeks":case"days":e.hour=0;case"hours":e.minute=0;case"minutes":e.second=0;case"seconds":e.millisecond=0}if("weeks"===n&&(e.weekday=1),"quarters"===n){var r=Math.ceil(this.month/3);e.month=3*(r-1)+1}return this.set(e)},e.endOf=function(t){var e;return this.isValid?this.plus((e={},e[t]=1,e)).startOf(t).minus(1):this},e.toFormat=function(t,e){return void 0===e&&(e={}),this.isValid?te.create(this.loc.redefaultToEN(e)).formatDateTimeFromString(this,t):"Invalid DateTime"},e.toLocaleString=function(t){return void 0===t&&(t=H),this.isValid?te.create(this.loc.clone(t),t).formatDateTime(this):"Invalid DateTime"},e.toLocaleParts=function(t){return void 0===t&&(t={}),this.isValid?te.create(this.loc.clone(t),t).formatDateTimeParts(this):[]},e.toISO=function(t){return void 0===t&&(t={}),this.isValid?this.toISODate()+"T"+this.toISOTime(t):null},e.toISODate=function(){var t="yyyy-MM-dd";return this.year>9999&&(t="+"+t),fr(this,t)},e.toISOWeekDate=function(){return fr(this,"kkkk-'W'WW-c")},e.toISOTime=function(t){var e=void 0===t?{}:t,n=e.suppressMilliseconds,r=void 0!==n&&n,i=e.suppressSeconds,o=void 0!==i&&i,s=e.includeOffset;return dr(this,{suppressSeconds:o,suppressMilliseconds:r,includeOffset:void 0===s||s})},e.toRFC2822=function(){return fr(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ")},e.toHTTP=function(){return fr(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")},e.toSQLDate=function(){return fr(this,"yyyy-MM-dd")},e.toSQLTime=function(t){var e=void 0===t?{}:t,n=e.includeOffset,r=void 0===n||n,i=e.includeZone;return dr(this,{includeOffset:r,includeZone:void 0!==i&&i,spaceZone:!0})},e.toSQL=function(t){return void 0===t&&(t={}),this.isValid?this.toSQLDate()+" "+this.toSQLTime(t):null},e.toString=function(){return this.isValid?this.toISO():"Invalid DateTime"},e.valueOf=function(){return this.toMillis()},e.toMillis=function(){return this.isValid?this.ts:NaN},e.toSeconds=function(){return this.isValid?this.ts/1e3:NaN},e.toJSON=function(){return this.toISO()},e.toBSON=function(){return this.toJSDate()},e.toObject=function(t){if(void 0===t&&(t={}),!this.isValid)return{};var e=Object.assign({},this.c);return t.includeConfig&&(e.outputCalendar=this.outputCalendar,e.numberingSystem=this.loc.numberingSystem,e.locale=this.loc.locale),e},e.toJSDate=function(){return new Date(this.isValid?this.ts:NaN)},e.diff=function(t,e,n){if(void 0===e&&(e="milliseconds"),void 0===n&&(n={}),!this.isValid||!t.isValid)return xn.invalid(this.invalid||t.invalid,"created by diffing an invalid DateTime");var r,i=Object.assign({locale:this.locale,numberingSystem:this.numberingSystem},n),o=(r=e,Array.isArray(r)?r:[r]).map(xn.normalizeUnit),s=t.valueOf()>this.valueOf(),a=function(t,e,n,r){var i,o=function(t,e,n){for(var r,i,o={},s=0,a=[["years",function(t,e){return e.year-t.year}],["months",function(t,e){return e.month-t.month+12*(e.year-t.year)}],["weeks",function(t,e){var n=Nn(t,e);return(n-n%7)/7}],["days",Nn]];s<a.length;s++){var u=a[s],c=u[0],l=u[1];if(n.indexOf(c)>=0){var h;r=c;var f,d=l(t,e);(i=t.plus(((h={})[c]=d,h)))>e?(t=t.plus(((f={})[c]=d-1,f)),d-=1):t=i,o[c]=d}}return[t,o,i,r]}(t,e,n),s=o[0],a=o[1],u=o[2],c=o[3],l=e-s,h=n.filter((function(t){return["hours","minutes","seconds","milliseconds"].indexOf(t)>=0}));0===h.length&&(u<e&&(u=s.plus(((i={})[c]=1,i))),u!==s&&(a[c]=(a[c]||0)+l/(u-s)));var f,d=xn.fromObject(Object.assign(a,r));return h.length>0?(f=xn.fromMillis(l,r)).shiftTo.apply(f,h).plus(d):d}(s?this:t,s?t:this,o,i);return s?a.negate():a},e.diffNow=function(e,n){return void 0===e&&(e="milliseconds"),void 0===n&&(n={}),this.diff(t.local(),e,n)},e.until=function(t){return this.isValid?An.fromDateTimes(this,t):this},e.hasSame=function(t,e){if(!this.isValid)return!1;if("millisecond"===e)return this.valueOf()===t.valueOf();var n=t.valueOf();return this.startOf(e)<=n&&n<=this.endOf(e)},e.equals=function(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)},e.toRelative=function(e){if(void 0===e&&(e={}),!this.isValid)return null;var n=e.base||t.fromObject({zone:this.zone}),r=e.padding?this<n?-e.padding:e.padding:0;return kr(n,this.plus(r),Object.assign(e,{numeric:"always",units:["years","months","days","hours","minutes","seconds"]}))},e.toRelativeCalendar=function(e){return void 0===e&&(e={}),this.isValid?kr(e.base||t.fromObject({zone:this.zone}),this,Object.assign(e,{numeric:"auto",units:["years","months","days"],calendary:!0})):null},t.min=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(!n.every(t.isDateTime))throw new $("min requires all arguments be DateTimes");return vt(n,(function(t){return t.valueOf()}),Math.min)},t.max=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(!n.every(t.isDateTime))throw new $("max requires all arguments be DateTimes");return vt(n,(function(t){return t.valueOf()}),Math.max)},t.fromFormatExplain=function(t,e,n){void 0===n&&(n={});var r=n,i=r.locale,o=void 0===i?null:i,s=r.numberingSystem,a=void 0===s?null:s;return Bn(Ae.fromOpts({locale:o,numberingSystem:a,defaultToEN:!0}),t,e)},t.fromStringExplain=function(e,n,r){return void 0===r&&(r={}),t.fromFormatExplain(e,n,r)},S(t,[{key:"isValid",get:function(){return null===this.invalid}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}},{key:"locale",get:function(){return this.isValid?this.loc.locale:null}},{key:"numberingSystem",get:function(){return this.isValid?this.loc.numberingSystem:null}},{key:"outputCalendar",get:function(){return this.isValid?this.loc.outputCalendar:null}},{key:"zone",get:function(){return this._zone}},{key:"zoneName",get:function(){return this.isValid?this.zone.name:null}},{key:"year",get:function(){return this.isValid?this.c.year:NaN}},{key:"quarter",get:function(){return this.isValid?Math.ceil(this.c.month/3):NaN}},{key:"month",get:function(){return this.isValid?this.c.month:NaN}},{key:"day",get:function(){return this.isValid?this.c.day:NaN}},{key:"hour",get:function(){return this.isValid?this.c.hour:NaN}},{key:"minute",get:function(){return this.isValid?this.c.minute:NaN}},{key:"second",get:function(){return this.isValid?this.c.second:NaN}},{key:"millisecond",get:function(){return this.isValid?this.c.millisecond:NaN}},{key:"weekYear",get:function(){return this.isValid?or(this).weekYear:NaN}},{key:"weekNumber",get:function(){return this.isValid?or(this).weekNumber:NaN}},{key:"weekday",get:function(){return this.isValid?or(this).weekday:NaN}},{key:"ordinal",get:function(){return this.isValid?tr(this.c).ordinal:NaN}},{key:"monthShort",get:function(){return this.isValid?Fn.months("short",{locale:this.locale})[this.month-1]:null}},{key:"monthLong",get:function(){return this.isValid?Fn.months("long",{locale:this.locale})[this.month-1]:null}},{key:"weekdayShort",get:function(){return this.isValid?Fn.weekdays("short",{locale:this.locale})[this.weekday-1]:null}},{key:"weekdayLong",get:function(){return this.isValid?Fn.weekdays("long",{locale:this.locale})[this.weekday-1]:null}},{key:"offset",get:function(){return this.isValid?+this.o:NaN}},{key:"offsetNameShort",get:function(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}},{key:"offsetNameLong",get:function(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}},{key:"isOffsetFixed",get:function(){return this.isValid?this.zone.universal:null}},{key:"isInDST",get:function(){return!this.isOffsetFixed&&(this.offset>this.set({month:1}).offset||this.offset>this.set({month:5}).offset)}},{key:"isInLeapYear",get:function(){return Ct(this.year)}},{key:"daysInMonth",get:function(){return St(this.year,this.month)}},{key:"daysInYear",get:function(){return this.isValid?xt(this.year):NaN}},{key:"weeksInWeekYear",get:function(){return this.isValid?Tt(this.weekYear):NaN}}],[{key:"DATE_SHORT",get:function(){return H}},{key:"DATE_MED",get:function(){return B}},{key:"DATE_FULL",get:function(){return Z}},{key:"DATE_HUGE",get:function(){return W}},{key:"TIME_SIMPLE",get:function(){return G}},{key:"TIME_WITH_SECONDS",get:function(){return J}},{key:"TIME_WITH_SHORT_OFFSET",get:function(){return Q}},{key:"TIME_WITH_LONG_OFFSET",get:function(){return Y}},{key:"TIME_24_SIMPLE",get:function(){return X}},{key:"TIME_24_WITH_SECONDS",get:function(){return K}},{key:"TIME_24_WITH_SHORT_OFFSET",get:function(){return tt}},{key:"TIME_24_WITH_LONG_OFFSET",get:function(){return et}},{key:"DATETIME_SHORT",get:function(){return nt}},{key:"DATETIME_SHORT_WITH_SECONDS",get:function(){return rt}},{key:"DATETIME_MED",get:function(){return it}},{key:"DATETIME_MED_WITH_SECONDS",get:function(){return ot}},{key:"DATETIME_MED_WITH_WEEKDAY",get:function(){return st}},{key:"DATETIME_FULL",get:function(){return at}},{key:"DATETIME_FULL_WITH_SECONDS",get:function(){return ut}},{key:"DATETIME_HUGE",get:function(){return ct}},{key:"DATETIME_HUGE_WITH_SECONDS",get:function(){return lt}}]),t}();function Er(t){if(Or.isDateTime(t))return t;if(t&&t.valueOf&&ft(t.valueOf()))return Or.fromJSDate(t);if(t&&"object"==typeof t)return Or.fromObject(t);throw new $("Unknown datetime argument: "+t+", of type "+typeof t)}C.DateTime=Or,C.Duration=xn,C.FixedOffsetZone=he,C.IANAZone=ce,C.Info=Fn,C.Interval=An,C.InvalidZone=fe,C.LocalZone=ie,C.Settings=be,C.Zone=ne;var Cr={},xr="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(xr){var Sr=new Uint8Array(16);Cr=function(){return xr(Sr),Sr}}else{var jr=new Array(16);Cr=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),jr[e]=t>>>((3&e)<<3)&255;return jr}}for(var Tr=[],Ar=0;Ar<256;++Ar)Tr[Ar]=(Ar+256).toString(16).substr(1);var Fr=function(t,e,n){var r=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var i=(t=t||{}).random||(t.rng||Cr)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e)for(var o=0;o<16;++o)e[r+o]=i[o];return e||function(t,e){var n=e||0,r=Tr;return[r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]]].join("")}(i)};const{DateTime:Nr}=C;const{DateTime:Dr}=C;const{DateTime:Ir}=C;const{DateTime:Mr}=C;const Rr={activateAccount:async function(t,{username:e}){await t.post({endpoint:`/accounts/${e}/activate`})},createAccount:async function(t,{name:e,username:n,password:r}){return await t.post({endpoint:"/accounts/"+n,body:{name:e,password:r}})},deactivateAccount:async function(t,{username:e}){await t.post({endpoint:`/accounts/${e}/deactivate`})},destroyAccount:async function(t,{username:e}){await t.delete({endpoint:"/accounts/"+e})},getAccount:async function(t){const{body:e}=await t.get({endpoint:"/accounts/current"});return e},grantAccount:async function(t,{identity:e,db:n,role:r,email:i}){return await t.post({identity:e,endpoint:`/db/${n}/grant`,query:{role:r,email:i}})},profileAccount:async function(t,{username:e}){const{body:n}=await t.get({endpoint:"/accounts/"+e});return n},revokeAccount:async function(t,{identity:e,db:n,email:r}){return await t.post({identity:e,endpoint:`/db/${n}/revoke`,query:{email:r}})},listAccounts:async function(t,{each:e}){const{body:n}=await t.get({endpoint:"/accounts"});for(const r of n)await e(r)},destroyAnnotation:async function(t,{db:e,ns:n,stream:r}){await t.delete({endpoint:`/db/${e}/ns/${n}/streams/${r}/annotation`})},readAnnotation:async function(t,{db:e,ns:n,stream:r}){try{const{body:i}=await t.get({endpoint:`/db/${e}/ns/${n}/streams/${r}/annotation`});return i}catch(i){if(i&&404===i.statusCode)return;if(i)throw i}},advanceCursor:async function(t,{db:e,cursor:n,last:r}){await t.post({endpoint:`/db/${e}/cursors/${n}/advance`,query:{last:r}})},createCursor:async function(t,{identity:e,db:n,cursor:r,options:i}){await t.post({identity:e,endpoint:`/db/${n}/cursors/${r}`,body:i})},destroyCursor:async function(t,{identity:e,db:n,cursor:r}){await t.delete({identity:e,endpoint:`/db/${n}/cursors/${r}`})},getCursor:async function(t,{identity:e,db:n,cursor:r}){const{body:i}=await t.get({identity:e,endpoint:`/db/${n}/cursors/${r}`});return i},readCursor:O,rewindCursor:async function(t,{db:e,cursor:n}){await t.post({endpoint:`/db/${e}/cursors/${n}/rewind`})},listCursors:async function(t,{db:e,each:n}){const{body:r}=await t.get({endpoint:`/db/${e}/cursors`});for(const i of r)await n(i)},cloneDatabase:async function(t,{db:e,to:n}){await t.post({endpoint:`/db/${e}/clone?to=${n}`})},createDatabase:async function(t,{identity:e,db:n}){await t.put({identity:e,endpoint:"/db/"+n})},destroyDatabase:async function(t,{identity:e,db:n}){await t.delete({identity:e,endpoint:"/db/"+n})},readDatabase:E,renameDatabase:async function(t,{db:e,to:n}){await t.post({endpoint:`/db/${e}/rename?to=${n}`})},listDatabases:async function(t,{each:e}){const{body:n}=await t.get({endpoint:"/db"});for(const r of n)await e(r)},destroyEvent:async function(t,{db:e,ns:n,stream:r,event:i}){await t.delete({endpoint:`/db/${e}/ns/${n}/streams/${r}/events/${i}`})},readEvent:async function(t,{identity:e,db:n,ns:r,stream:i,event:o}){let{body:s}=await t.get({identity:e,endpoint:`/db/${n}/ns/${r}/streams/${i}/events/${o}`});return s},defineFunction:async function(t,{db:e,name:n,source:r}){await t.put({endpoint:`/db/${e}/fn/${n}`,body:r,headers:{"content-type":"text/javascript"}})},destroyFunction:async function(t,{db:e,name:n}){await t.delete({endpoint:`/db/${e}/fn/${n}`})},listFunctions:async function(t,{db:e,each:n}){const{body:r}=await t.get({endpoint:`/db/${e}/functions`});for(const i of r)await n(i)},createNamespace:async function(t,{identity:e,db:n,ns:r}){await t.put({identity:e,endpoint:`/db/${n}/ns/${r}`})},destroyNamespace:async function(t,{db:e,ns:n}){await t.delete({endpoint:`/db/${e}/ns/${n}`})},readNamespace:async function(t,{db:e,ns:n,from:r,after:i,to:o,until:s,types:a,limit:u,each:c}){const{body:l}=await t.get({endpoint:`/db/${e}/ns/${n}/events`,query:{types:a,from:r,after:i,to:o,until:s,limit:u,schema:"jsonapi"}});for(const h of l.data)await c(h);if(l.meta.cursor)return l.meta.cursor.after},renameNamespace:async function(t,{db:e,ns:n,to:r}){await t.post({endpoint:`/db/${e}/ns/${n}/rename?to=${r}`})},truncateNamespace:async function(t,{db:e,ns:n}){await t.delete({endpoint:`/db/${e}/ns/${n}/contents`})},listNamespaces:async function(t,{db:e,each:n}){const{body:r}=await t.get({endpoint:`/db/${e}/ns`});for(const i of r)await n(i)},destroyObject:async function(t,{db:e,id:n}){await t.delete({endpoint:`/db/${e}/objects/${n}`})},readObject:async function(t,{db:e,id:n}){try{const{body:r}=await t.get({endpoint:`/db/${e}/objects/${n}`});return r}catch(r){if(r&&404===r.statusCode)return;if(r)throw r}},watchObject:async function(t,{db:e,id:n,changed:r}){const i=t.url({endpoint:`/db/${e}/objects/${n}`,headers:{accept:"text/event-stream"}}),o=new w(i,{headers:await t.auth()});let s,a;o.addEventListener("error",t=>{t.message?(o.close(),u.jobs.length=0,a(t)):o.close()});const u=new f;return o.addEventListener("message",t=>{!async function(t,e,n){u.run(async(r,i)=>{await e(t,n),i.success(),u.running||s()})}(JSON.parse(t.data),r,{cancel:async()=>{o.close(),u.jobs.length=0,s()}})}),new Promise((t,e)=>{s=t,a=e})},writeObject:async function(t,{db:e,id:n,data:r}){await t.put({endpoint:`/db/${e}/objects/${n}`,body:r})},annotateStream:async function(t,{db:e,ns:n,stream:r,annotation:i}){await t.put({endpoint:`/db/${e}/ns/${n}/streams/${r}/annotation`,body:i})},destroyStream:async function(t,{db:e,ns:n,stream:r}){await t.delete({endpoint:`/db/${e}/streams/${r}`,query:{ns:n}})},readStream:async function(t,{db:e,ns:n,stream:r,from:i,after:o,to:s,until:a,types:u,limit:c,each:l}){const h=t.url({endpoint:`/db/${e}/ns/${n}/streams/${r}/events`,query:{types:u,from:i,after:o,to:s,until:a,limit:c,schema:"jsonapi"},headers:{accept:"text/event-stream"}}),d=new w(h,{headers:await t.auth()});let p,y;d.addEventListener("error",t=>{t.message?(d.close(),m.jobs.length=0,y(t)):d.close()});const m=new f;return d.addEventListener("message",t=>{!async function(t,e,n){m.run(async(r,i)=>{await e(t,n),i.success(),m.running||p()})}(JSON.parse(t.data),l,{cancel:async()=>{d.close(),m.jobs.length=0,p()}})}),new Promise((t,e)=>{p=t,y=e})},writeStream:async function(t,{db:e,ns:n,stream:r,data:i,meta:o,id:s}){const a={meta:{tz:Ir.local().zoneName,...o,id:null!=s?s:Fr(),db:e,ns:n,stream:r},data:null!=i?i:{}};return await t.put({endpoint:"/events/"+a.meta.id,body:a}),a},listStreams:async function(t,{db:e,ns:n,each:r}){const{body:i}=await t.get({endpoint:n?`/db/${e}/ns/${n}/streams`:`/db/${e}/streams`});for(const o of i)await r(o)},createTrigger:async function(t,{db:e,name:n,options:r}){await t.post({endpoint:`/db/${e}/triggers/${n}`,body:r})},destroyTrigger:async function(t,{db:e,name:n}){await t.delete({endpoint:`/db/${e}/triggers/${n}`})},listTriggers:async function(t,{db:e,each:n}){const{body:r}=await t.get({endpoint:`/db/${e}/triggers`});for(const i of r)await n(i)}};var Pr=class{constructor(t,e){this.connection=t,this.name=null==e?void 0:e.name,this.username=null==e?void 0:e.username}get api(){return this.connection.api}async create({password:t}){return await this.api.createAccount({name:this.name,username:this.username,password:t}),this}async destroy(){return await this.api.destroyAccount({username:this.username}),this}async activate(){return await this.api.activateAccount({username:this.username}),this}async deactivate(){return await this.api.deactivateAccount({username:this.username}),this}async profile(){return this.username?this.api.profileAccount({username:this.username}):this.api.getAccount()}},Lr={};function $r(t){var e=this;if(e instanceof $r||(e=new $r),e.tail=null,e.head=null,e.length=0,t&&"function"==typeof t.forEach)t.forEach((function(t){e.push(t)}));else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)e.push(arguments[n]);return e}function Vr(t,e){t.tail=new qr(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function Ur(t,e){t.head=new qr(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function qr(t,e,n,r){if(!(this instanceof qr))return new qr(t,e,n,r);this.list=r,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}Lr=$r,$r.Node=qr,$r.create=$r,$r.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null},$r.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},$r.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}},$r.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)Vr(this,arguments[t]);return this.length},$r.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)Ur(this,arguments[t]);return this.length},$r.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}},$r.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}},$r.prototype.forEach=function(t,e){e=e||this;for(var n=this.head,r=0;null!==n;r++)t.call(e,n.value,r,this),n=n.next},$r.prototype.forEachReverse=function(t,e){e=e||this;for(var n=this.tail,r=this.length-1;null!==n;r--)t.call(e,n.value,r,this),n=n.prev},$r.prototype.get=function(t){for(var e=0,n=this.head;null!==n&&e<t;e++)n=n.next;if(e===t&&null!==n)return n.value},$r.prototype.getReverse=function(t){for(var e=0,n=this.tail;null!==n&&e<t;e++)n=n.prev;if(e===t&&null!==n)return n.value},$r.prototype.map=function(t,e){e=e||this;for(var n=new $r,r=this.head;null!==r;)n.push(t.call(e,r.value,this)),r=r.next;return n},$r.prototype.mapReverse=function(t,e){e=e||this;for(var n=new $r,r=this.tail;null!==r;)n.push(t.call(e,r.value,this)),r=r.prev;return n},$r.prototype.reduce=function(t,e){var n,r=this.head;if(arguments.length>1)n=e;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=t(n,r.value,i),r=r.next;return n},$r.prototype.reduceReverse=function(t,e){var n,r=this.tail;if(arguments.length>1)n=e;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=t(n,r.value,i),r=r.prev;return n},$r.prototype.toArray=function(){for(var t=new Array(this.length),e=0,n=this.head;null!==n;e++)t[e]=n.value,n=n.next;return t},$r.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,n=this.tail;null!==n;e++)t[e]=n.value,n=n.prev;return t},$r.prototype.slice=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new $r;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var r=0,i=this.head;null!==i&&r<t;r++)i=i.next;for(;null!==i&&r<e;r++,i=i.next)n.push(i.value);return n},$r.prototype.sliceReverse=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new $r;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var r=this.length,i=this.tail;null!==i&&r>e;r--)i=i.prev;for(;null!==i&&r>t;r--,i=i.prev)n.push(i.value);return n},$r.prototype.reverse=function(){for(var t=this.head,e=this.tail,n=t;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=e,this.tail=t,this};try{!function(t){t.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}($r)}catch(bo){}const zr=Symbol("max"),Hr=Symbol("length"),Br=Symbol("lengthCalculator"),Zr=Symbol("allowStale"),Wr=Symbol("maxAge"),Gr=Symbol("dispose"),Jr=Symbol("noDisposeOnSet"),Qr=Symbol("lruList"),Yr=Symbol("cache"),Xr=Symbol("updateAgeOnGet"),Kr=()=>1,ti=(t,e,n)=>{const r=t[Yr].get(e);if(r){const e=r.value;if(ei(t,e)){if(ri(t,r),!t[Zr])return}else n&&(t[Xr]&&(r.value.now=Date.now()),t[Qr].unshiftNode(r));return e.value}},ei=(t,e)=>{if(!e||!e.maxAge&&!t[Wr])return!1;const n=Date.now()-e.now;return e.maxAge?n>e.maxAge:t[Wr]&&n>t[Wr]},ni=t=>{if(t[Hr]>t[zr])for(let e=t[Qr].tail;t[Hr]>t[zr]&&null!==e;){const n=e.prev;ri(t,e),e=n}},ri=(t,e)=>{if(e){const n=e.value;t[Gr]&&t[Gr](n.key,n.value),t[Hr]-=n.length,t[Yr].delete(n.key),t[Qr].removeNode(e)}};class ii{constructor(t,e,n,r,i){this.key=t,this.value=e,this.length=n,this.now=r,this.maxAge=i||0}}const oi=(t,e,n,r)=>{let i=n.value;ei(t,i)&&(ri(t,n),t[Zr]||(i=void 0)),i&&e.call(r,i.value,i.key,t)};var si=class{constructor({stream:t,id:e,type:n,data:r}){this.stream=t,this.id=e,this.type=n,this.data=r}get account(){return this.db.account}get db(){return this.ns.db}get ns(){return this.stream.ns}async destroy(){return this.account.api.destroyEvent({db:this.db.name,ns:this.ns.name,stream:this.stream.id,event:this.id})}async read(){return this.account.api.readEvent({db:this.db.name,ns:this.ns.name,stream:this.stream.id,event:this.id})}async append(){return await this.stream.events().write(this.type,this.data)}};const ai=k;ai.config({cancellation:!0});var ui=class{constructor({db:t,cursor:e,ns:n,stream:r,from:i,after:o,to:s,until:a,types:u,filters:c,limit:l}){this._db=t,this.cursor=e,this._ns=n,this.stream=r,this.from=i,this.after=o,this.to=s,this.until=a,this.types=u,this.filters=c||[],this.limit=l,this.shouldRead=!0}get api(){return this.account.api}get account(){return this.db.account}get db(){return this._db||this.ns.db}get ns(){return this._ns||(this.stream?this.stream.ns:void 0)}filter(t){return this.filters.push(t),this}group(t){return this.groupby=t,this.until||(this.until="caught-up"),this}rollup(t){return this.rollupto=t,this}async write(t){var e,n;return 1===arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof String)&&(t={meta:{type:arguments[0]},data:{}}),2===arguments.length&&(t={meta:{type:arguments[0]},data:{...arguments[1]}}),await this.api.writeStream({db:this.db.name,ns:null!==(e=null===(n=this.ns)||void 0===n?void 0:n.name)&&void 0!==e?e:"",stream:this.stream.id,id:t.id,data:t.data,meta:t.meta})}each(t){let e,n,r=new class{constructor(){this.cache=new class{constructor(t){if("number"==typeof t&&(t={max:t}),t||(t={}),t.max&&("number"!=typeof t.max||t.max<0))throw new TypeError("max must be a non-negative number");this[zr]=t.max||1/0;const e=t.length||Kr;if(this[Br]="function"!=typeof e?Kr:e,this[Zr]=t.stale||!1,t.maxAge&&"number"!=typeof t.maxAge)throw new TypeError("maxAge must be a number");this[Wr]=t.maxAge||0,this[Gr]=t.dispose,this[Jr]=t.noDisposeOnSet||!1,this[Xr]=t.updateAgeOnGet||!1,this.reset()}set max(t){if("number"!=typeof t||t<0)throw new TypeError("max must be a non-negative number");this[zr]=t||1/0,ni(this)}get max(){return this[zr]}set allowStale(t){this[Zr]=!!t}get allowStale(){return this[Zr]}set maxAge(t){if("number"!=typeof t)throw new TypeError("maxAge must be a non-negative number");this[Wr]=t,ni(this)}get maxAge(){return this[Wr]}set lengthCalculator(t){"function"!=typeof t&&(t=Kr),t!==this[Br]&&(this[Br]=t,this[Hr]=0,this[Qr].forEach(t=>{t.length=this[Br](t.value,t.key),this[Hr]+=t.length})),ni(this)}get lengthCalculator(){return this[Br]}get length(){return this[Hr]}get itemCount(){return this[Qr].length}rforEach(t,e){e=e||this;for(let n=this[Qr].tail;null!==n;){const r=n.prev;oi(this,t,n,e),n=r}}forEach(t,e){e=e||this;for(let n=this[Qr].head;null!==n;){const r=n.next;oi(this,t,n,e),n=r}}keys(){return this[Qr].toArray().map(t=>t.key)}values(){return this[Qr].toArray().map(t=>t.value)}reset(){this[Gr]&&this[Qr]&&this[Qr].length&&this[Qr].forEach(t=>this[Gr](t.key,t.value)),this[Yr]=new Map,this[Qr]=new Lr,this[Hr]=0}dump(){return this[Qr].map(t=>!ei(this,t)&&{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[Qr]}set(t,e,n){if((n=n||this[Wr])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,i=this[Br](e,t);if(this[Yr].has(t)){if(i>this[zr])return ri(this,this[Yr].get(t)),!1;const o=this[Yr].get(t).value;return this[Gr]&&(this[Jr]||this[Gr](t,o.value)),o.now=r,o.maxAge=n,o.value=e,this[Hr]+=i-o.length,o.length=i,this.get(t),ni(this),!0}const o=new ii(t,e,i,r,n);return o.length>this[zr]?(this[Gr]&&this[Gr](t,e),!1):(this[Hr]+=o.length,this[Qr].unshift(o),this[Yr].set(t,this[Qr].head),ni(this),!0)}has(t){if(!this[Yr].has(t))return!1;const e=this[Yr].get(t).value;return!ei(this,e)}get(t){return ti(this,t,!0)}peek(t){return ti(this,t,!1)}pop(){const t=this[Qr].tail;return t?(ri(this,t),t.value):null}del(t){ri(this,this[Yr].get(t))}load(t){this.reset();const e=Date.now();for(let n=t.length-1;n>=0;n--){const r=t[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const t=i-e;t>0&&this.set(r.k,r.v,t)}}}prune(){this[Yr].forEach((t,e)=>ti(this,e,!1))}}({max:1e5,length:function(t,e){return 16},maxAge:3e5})}seen(t){if(this.cache.peek(t))return!0;this.cache.set(t,!0)}},i={db:this.db.name,cursor:this.cursor?this.cursor.name:void 0,ns:this.ns?this.ns.name:void 0,stream:this.stream?this.stream.id:void 0,from:this.from,after:this.after,to:this.to,until:this.until,types:this.types,filters:this.filters,groupby:this.groupby,rollupto:this.rollupto,limit:this.groupby?void 0:this.limit||50,each:async(e,n)=>{e.meta&&e.meta.id&&r.seen(e.meta.id)||await t(e,n)}},o=!1,s=void 0,a=i.cursor?this.api.readCursor.bind(this.api):this.api.readDatabase.bind(this.api),u=i.after;return(s=a({...i,after:u})).then((function t(n){o||(n?(u=n,i.from=void 0,(s=a({...i,after:u})).then(t)):e(u))})),new ai((t,r,i)=>{e=t,n=r,i((function(){o=!0,s&&s.cancel()}))})}},ci=class{constructor(t,e,n){this.db=t,this.name=e,this.options=n}get api(){return this.account.api}get account(){return this.db.account}events(){return new ui({...this.options,db:this.db,cursor:this})}async create(){return this.api.createCursor({db:this.db.name,cursor:this.name,options:this.options})}async destroy(){return this.api.destroyCursor({db:this.db.name,cursor:this.name})}async rewind(){return this.api.rewindCursor({db:this.db.name,cursor:this.name})}async details(){return this.api.getCursor({db:this.db.name,cursor:this.name})}async read(){return this.api.getCursor({db:this.db.name,cursor:this.name})}};function li(t){return"view_"+t.replace(/[^a-zA-Z0-9]+/gi,"")}var hi=class{constructor(t,e,n){this.id=t||Fr(),this.ns=e,n&&(this.created=n.created,this.modified=n.modified,this.size=n.size,this.annotation=n.annotation)}get api(){return this.account.api}get account(){return this.db.account}get db(){return this.ns.db}events(t){return new ui({...t,stream:this})}event(t,e){return new si({stream:this,id:t,type:t,data:e})}async annotate(t){return this.api.annotateStream({db:this.db.name,ns:this.ns.name,stream:this.id,annotation:t})}annotation(){return new class{constructor(t){this.stream=t}get api(){return this.account.api}get account(){return this.db.account}get db(){return this.ns.db}get ns(){return this.stream.ns}async destroy(){return this.api.destroyAnnotation({db:this.db.name,ns:this.ns.name,stream:this.stream.id})}async read(){return this.api.readAnnotation({db:this.db.name,ns:this.ns.name,stream:this.stream.id})}}(this)}async destroy(){return this.api.destroyStream({db:this.db.name,ns:this.ns.name,stream:this.id})}},fi=class{constructor({db:t,ns:e}){this._db=t,this.ns=e}get api(){return this.account.api}get account(){return this.db.account}get db(){var t;return this._db||(null===(t=this.ns)||void 0===t?void 0:t.db)}stream(t,e){return(void 0!==e.ns?this.db.ns(e.ns):this.ns).stream(t,e)}async each(t){var e;return this.api.listStreams({db:this.db.name,ns:null===(e=this.ns)||void 0===e?void 0:e.name,each:async e=>await t(this.stream(e.id,e))}).catch(t=>{throw t})}async all(){let t=[];return await this.each(e=>t.push(e)),t.sort((t,e)=>t.id.localeCompare(e.id)),t}},di=class{constructor(t,e){this.name=t,this.db=e}get api(){return this.account.api}get account(){return this.db.account}streams(){return new fi({ns:this})}stream(t,e){return new hi(t,this,e)}events(t){return"string"==typeof t&&(t={types:[t]}),new ui({...t,ns:this})}async create(){return await this.api.createNamespace({db:this.db.name,ns:this.name}),this}async destroy(){await this.api.destroyNamespace({db:this.db.name,ns:this.name})}async truncate(){await this.api.truncateNamespace({db:this.db.name,ns:this.name})}async rename(t){return await this.api.renameNamespace({db:this.db.name,ns:this.name,to:t}),this.name=t,this}async export(){return await this.streams().each(t=>this.stream(t.id).export()),this}};const pi=fi,yi=require("fs"),mi=require("path");class vi{constructor(t,e){this.name=t,this.account=e,this.objects=new class{constructor(t){this.db=t,this.types={}}async register(t,e,n){const r=this.db;this.types[t]={type:e,toolbox:n},r.events({types:e.events}).each(async t=>{let i=await r.object(t.meta.stream).read()||{};i=await e.on(n,i,t)||{},await r.object(t.meta.stream,{...i,_last:t.meta}).write()})}async create(t){const e=this.db,n=this.types[t],r=n.type;let i={_type:r,id:Fr()};return r.commands.forEach(t=>{i[t]=async function(r){let i=await this._type.do({...n.toolbox,db:e},this,t,r);return i.meta.stream=this.id,await e.stream(this.id).event(i.meta.type,i.data).append()}}),await e.object(i.id,i).write(),i}async get(t,e){const n=await this.db.object(t).read();if(e&&e.plain){let t={...n};return delete t._type,delete t._last,t}return n}}(this),this.views=new class{constructor(t){this.db=t,this.registrations={},this.promises={}}async register(t,e,n){this.db,this.registrations[t]={type:e,toolbox:n},e.extends||await this.resume(t)}async get(t,e){const n=this.registrations[t],r=n.type;if(r.extends){let t=await this.get(r.extends,e);return await r.get({...n.toolbox,db:this.db},t,e)}let i=await this.db.object(li(t)).read()||r.default;r.get&&(i=await r.get({...n.toolbox,db:this.db},i,e));let o={...i};return delete o._type,delete o._last,o}async refresh(t){this.registrations[t].type.extends||(this.pause(t),this.rewind(t),this.resume(t))}async rewind(t){this.registrations[t].type.extends||await this.db.object(li(t)).destroy()}async pause(t){if(this.registrations[t].type.extends)return;const e=this.promises[t];e&&(e.cancel(),delete this.promises[t])}async resume(t){const e=this.registrations[t],n=e.type;if(n.extends)return;if(this.promises[t])return;const r=this.db;let i=await r.object(li(t)).read()||n.default,o={types:n.events};i&&i._last&&i._last.stream&&i._last.id&&(o.after=`${i._last.stream}.${i._last.id}`),this.promises[t]=r.events(o).each(async i=>{let o=await r.object(li(t)).read()||n.default;o=await n.on({...e.toolbox,db:r},o,i)||{},await r.object(li(t),{...o,_last:i.meta}).write()})}}(this)}get api(){return this.account.api}use(t){return new vi(t,this.account)}async close(){await this.account.close()}namespaces(){return new class{constructor(t){this.db=t}get api(){return this.account.api}get account(){return this.db.account}namespace(t){return this.ns(t)}ns(t){return new di(t,this.db)}async each(t){return this.api.listNamespaces({db:this.db.name,each:async e=>await t(this.ns(e))}).catch(t=>{throw t})}async all(){let t=[];return await this.each(e=>t.push(e)),t.sort((t,e)=>t.name.localeCompare(e.name)),t}}(this)}namespace(t){return this.ns(t)}ns(t){return new di(t,this)}streams(t){return t.ns&&(t.ns=this.ns(t.ns)),new pi({...t,db:this})}events(t){return new ui({...t,db:this})}stream(t){return this.ns("").stream(t)}cursors(){return new class{constructor(t){this.db=t}get api(){return this.account.api}get account(){return this.db.account}cursor(t,e){return new ci(this.db,t,e)}async each(t){return this.api.listCursors({db:this.db.name,each:async e=>await t(e)}).catch(t=>{throw t})}async all(){let t=[];return await this.each(e=>t.push(e)),t}}(this)}cursor(t,e){return new ci(this,t,e)}object(t,e){return new class{constructor(t,e,n){this.db=t,this.id=e,this.data=n}get api(){return this.account.api}get account(){return this.db.account}async write(){return this.api.writeObject({db:this.db.name,id:this.id,data:this.data})}async read(){return this.api.readObject({db:this.db.name,id:this.id})}async watch(t){return this.api.watchObject({db:this.db.name,id:this.id,changed:t})}async destroy(){return this.api.destroyObject({db:this.db.name,id:this.id})}}(this,t,e)}async domain({folder:t,tools:e}){const n={...e,db:this},r=async function(t,e,n){const i=mi.resolve(t,...e),o=yi.readdirSync(i);for(let s of o){if(yi.statSync(`${i}/${s}`).isDirectory())return await r(t,[...e,s],n);s.toLowerCase().endsWith(".js")&&await n(t,e,i,s,mi.resolve(i,s))}};await r(mi.resolve(t,"objects"),[],async(t,e,r,i,o)=>this.objects.register(mi.parse(i).name,require(o),n)),await r(mi.resolve(t,"views"),[],async(t,e,r,i,o)=>this.views.register(""+[...e,mi.parse(i).name].join("."),require(o),n))}async create(){return await this.api.createDatabase({db:this.name}),this}async destroy(){await this.api.destroyDatabase({db:this.name})}async rename(t){return await this.api.renameDatabase({db:this.name,to:t}),this.name=t,this}async grant({role:t,email:e}){return await this.api.grantAccount({db:this.name,role:t,email:e}),this}async revoke({email:t}){return await this.api.revokeAccount({db:this.name,email:t}),this}}var gi=vi,_i=class{constructor(t){this.api=t}async close(){}use(t){return new gi(t,this)}databases(){return new class{constructor(t){this.account=t}get api(){return this.account.api}async each(t){return this.api.listDatabases({each:t}).catch(t=>{throw t})}async all(){let t=[];return await this.each(e=>t.push(e)),t.sort((t,e)=>t.localeCompare(e)),t}}(this)}accounts(){return new class{constructor(t){this.connection=t}get api(){return this.connection.api}async each(t){return this.api.listAccounts({each:async e=>await t(e)}).catch(t=>{throw t})}async all(){let t=[];return await this.each(e=>t.push(e)),t.sort((t,e)=>t.username.localeCompare(e.username)),t}}(this)}account(t){return new Pr(this,t)}},bi=function(t,e){let n={};return Object.keys(t).filter(t=>!t.startsWith(e)).forEach(e=>{n[e]=t[e]}),n};const wi=/[|\\{}()[\]^$+*?.-]/g;var ki;const Oi=new Map;function Ei(t,e){e={caseSensitive:!1,...e};const n=t+JSON.stringify(e);if(Oi.has(n))return Oi.get(n);const r="!"===t[0];r&&(t=t.slice(1)),t=(t=>{if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(wi,"\\$&")})(t).replace(/\\\*/g,".*");const i=new RegExp(`^${t}$`,e.caseSensitive?"":"i");return i.negated=r,Oi.set(n,i),i}(ki=(t,e,n)=>{if(!Array.isArray(t)||!Array.isArray(e))throw new TypeError(`Expected two arrays, got ${typeof t} ${typeof e}`);if(0===e.length)return t;const r="!"===e[0][0];e=e.map(t=>Ei(t,n));const i=[];for(const o of t){let t=r;for(const n of e)n.test(o)&&(t=!n.negated);t&&i.push(o)}return i}).isMatch=(t,e,n)=>{const r=Array.isArray(t)?t:[t],i=Array.isArray(e)?e:[e];return r.some(t=>i.every(e=>{const r=Ei(e,n),i=r.test(t);return r.negated?!i:i}))};var Ci;k.config({cancellation:!0}),Ci=function(t,{db:e,ns:n,stream:r,from:i,after:o,to:s,until:a,types:u,limit:c,each:l}){let h,f,d=t.events.filter(t=>!(t.meta.db!==e||n&&t.meta.ns!==n||r&&t.meta.stream!==r));if(u&&(u=Array.isArray(u)?u:[u],d=d.filter(t=>u.some(e=>ki.isMatch(t.meta.type,e)))),i){const t=d.findIndex(t=>t.meta.id===i);t>=0&&(d=d.slice(t))}if(o){const t=d.findIndex(t=>t.meta.id===o);t>=0&&(d=d.slice(t+1))}if(s){const t=d.findIndex(t=>t.meta.id===s);t>=0&&(d=d.slice(0,t+1))}if(a){const t=d.findIndex(t=>t.meta.id===a);t>=0&&(d=d.slice(0,t))}c&&(d.length=Math.min(d.length,c));let p=!1,y=void 0,m=new k((e,n,r)=>{h=e,f=n,r((function(){p=!0,t.subscriptions.splice(y,1)}))});return function i(o){!p&&o<d.length?l(d[o]).then(i.bind(null,o+1)):!p&&!s&&!a&&d.length<c?y=t.subscriptions.push({count:d.length,limit:c,db:e,ns:n,stream:r,types:u,each:l})-1:h()}(0),m};var xi,Si,ji={exports:{}};xi=this,Si=function(t){"use strict";function e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function n(t){var n;return 1===t.length&&(n=t,t=function(t,r){return e(n(t),r)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}var r=n(e),i=r.right,o=r.left;function s(t,e){let n=0;if(void 0===e)for(let r of t)null!=r&&(r=+r)>=r&&++n;else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(i=+i)>=i&&++n}return n}function a(t){return 0|t.length}function u(t){return!(t>0)}function c(t){return"object"!=typeof t||"length"in t?t:Array.from(t)}function l(t,e){let n,r=0,i=0,o=0;if(void 0===e)for(let s of t)null!=s&&(s=+s)>=s&&(o+=(n=s-i)*(s-(i+=n/++r)));else{let s=-1;for(let a of t)null!=(a=e(a,++s,t))&&(a=+a)>=a&&(o+=(n=a-i)*(a-(i+=n/++r)))}if(r>1)return o/(r-1)}function h(t,e){const n=l(t,e);return n?Math.sqrt(n):n}function f(t,e){let n,r;if(void 0===e)for(const i of t)null!=i&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(void 0===n?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}function d(t){return t}function p(t,e,n,r){return function t(i,o){if(o>=r.length)return n(i);const s=new Map,a=r[o++];let u=-1;for(const e of i){const t=a(e,++u,i),n=s.get(t);n?n.push(e):s.set(t,[e])}for(const[e,n]of s)s.set(e,t(n,o));return e(s)}(t,0)}var y=Array.prototype.slice;function m(t){return function(){return t}}function v(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o}var g=Math.sqrt(50),_=Math.sqrt(10),b=Math.sqrt(2);function w(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=g?10:o>=_?5:o>=b?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=g?10:o>=_?5:o>=b?2:1)}function k(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=g?i*=10:o>=_?i*=5:o>=b&&(i*=2),e<t?-i:i}function O(t){return Math.ceil(Math.log(s(t))/Math.LN2)+1}function E(){var t=d,e=f,n=O;function r(r){Array.isArray(r)||(r=Array.from(r));var o,s,a=r.length,u=new Array(a);for(o=0;o<a;++o)u[o]=t(r[o],o,r);var c=e(u),l=c[0],h=c[1],f=n(u,l,h);Array.isArray(f)||(f=k(l,h,f),f=v(Math.ceil(l/f)*f,h,f));for(var d=f.length;f[0]<=l;)f.shift(),--d;for(;f[d-1]>h;)f.pop(),--d;var p,y=new Array(d+1);for(o=0;o<=d;++o)(p=y[o]=[]).x0=o>0?f[o-1]:l,p.x1=o<d?f[o]:h;for(o=0;o<a;++o)l<=(s=u[o])&&s<=h&&y[i(f,s,0,d)].push(r[o]);return y}return r.value=function(e){return arguments.length?(t="function"==typeof e?e:m(e),r):t},r.domain=function(t){return arguments.length?(e="function"==typeof t?t:m([t[0],t[1]]),r):e},r.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?m(y.call(t)):m(t),r):n},r}function C(t,e){let n;if(void 0===e)for(const r of t)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function x(t,e){let n;if(void 0===e)for(const r of t)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function S(t,n,r=0,i=t.length-1,o=e){for(;i>r;){if(i-r>600){const e=i-r+1,s=n-r+1,a=Math.log(e),u=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*u*(e-u)/e)*(s-e/2<0?-1:1);S(t,n,Math.max(r,Math.floor(n-s*u/e+c)),Math.min(i,Math.floor(n+(e-s)*u/e+c)),o)}const e=t[n];let s=r,a=i;for(j(t,r,n),o(t[i],e)>0&&j(t,r,i);s<a;){for(j(t,s,a),++s,--a;o(t[s],e)<0;)++s;for(;o(t[a],e)>0;)--a}0===o(t[r],e)?j(t,r,a):j(t,++a,i),a<=n&&(r=a+1),n<=a&&(i=a-1)}return t}function j(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function T(t,e,n){if(r=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let n of t)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of t)null!=(r=e(r,++n,t))&&(r=+r)>=r&&(yield r)}}(t,n))).length){if((e=+e)<=0||r<2)return x(t);if(e>=1)return C(t);var r,i=(r-1)*e,o=Math.floor(i),s=C(S(t,o).subarray(0,o+1));return s+(x(t.subarray(o+1))-s)*(i-o)}}function A(t,e){let n,r=-1,i=-1;if(void 0===e)for(const o of t)++i,null!=o&&(n<o||void 0===n&&o>=o)&&(n=o,r=i);else for(let o of t)null!=(o=e(o,++i,t))&&(n<o||void 0===n&&o>=o)&&(n=o,r=i);return r}function F(t,e){let n,r=-1,i=-1;if(void 0===e)for(const o of t)++i,null!=o&&(n>o||void 0===n&&o>=o)&&(n=o,r=i);else for(let o of t)null!=(o=e(o,++i,t))&&(n>o||void 0===n&&o>=o)&&(n=o,r=i);return r}function N(t,n=e){if(1===n.length)return F(t,n);let r,i=-1,o=-1;for(const e of t)++o,(i<0?0===n(e,e):n(e,r)<0)&&(r=e,i=o);return i}function D(t){if(!(i=t.length))return[];for(var e=-1,n=x(t,I),r=new Array(n);++e<n;)for(var i,o=-1,s=r[e]=new Array(i);++o<i;)s[o]=t[o][e];return r}function I(t){return t.length}t.ascending=e,t.bin=E,t.bisect=i,t.bisectLeft=o,t.bisectRight=i,t.bisector=n,t.count=s,t.cross=function(...t){const e="function"==typeof t[t.length-1]&&function(t){return e=>t(...e)}(t.pop()),n=(t=t.map(c)).map(a),r=t.length-1,i=new Array(r+1).fill(0),o=[];if(r<0||n.some(u))return o;for(;;){o.push(i.map((e,n)=>t[n][e]));let s=r;for(;++i[s]===n[s];){if(0===s)return e?o.map(e):o;i[s--]=0}}},t.cumsum=function(t,e){var n=0,r=0;return Float64Array.from(t,void 0===e?t=>n+=+t||0:i=>n+=+e(i,r++,t)||0)},t.descending=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},t.deviation=h,t.extent=f,t.greatest=function(t,n=e){let r,i=!1;if(1===n.length){let o;for(const s of t){const t=n(s);(i?e(t,o)>0:0===e(t,t))&&(r=s,o=t,i=!0)}}else for(const e of t)(i?n(e,r)>0:0===n(e,e))&&(r=e,i=!0);return r},t.greatestIndex=function(t,n=e){if(1===n.length)return A(t,n);let r,i=-1,o=-1;for(const e of t)++o,(i<0?0===n(e,e):n(e,r)>0)&&(r=e,i=o);return i},t.group=function(t,...e){return p(t,d,d,e)},t.groups=function(t,...e){return p(t,Array.from,d,e)},t.histogram=E,t.least=function(t,n=e){let r,i=!1;if(1===n.length){let o;for(const s of t){const t=n(s);(i?e(t,o)<0:0===e(t,t))&&(r=s,o=t,i=!0)}}else for(const e of t)(i?n(e,r)<0:0===n(e,e))&&(r=e,i=!0);return r},t.leastIndex=N,t.max=C,t.maxIndex=A,t.mean=function(t,e){let n=0,r=0;if(void 0===e)for(let i of t)null!=i&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(o=+o)>=o&&(++n,r+=o)}if(n)return r/n},t.median=function(t,e){return T(t,.5,e)},t.merge=function(t){return Array.from(function*(t){for(const e of t)yield*e}(t))},t.min=x,t.minIndex=F,t.pairs=function(t,e=function(t,e){return[t,e]}){const n=[];let r,i=!1;for(const o of t)i&&n.push(e(r,o)),r=o,i=!0;return n},t.permute=function(t,e){return Array.from(e,e=>t[e])},t.quantile=T,t.quantileSorted=function(t,e,n=function(t){return null===t?NaN:+t}){if(r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),s=+n(t[o],o,t);return s+(+n(t[o+1],o+1,t)-s)*(i-o)}},t.quickselect=S,t.range=v,t.rollup=function(t,e,...n){return p(t,d,e,n)},t.rollups=function(t,e,...n){return p(t,Array.from,e,n)},t.scan=function(t,e){const n=N(t,e);return n<0?void 0:n},t.shuffle=function(t,e=0,n=t.length){for(var r,i,o=n-(e=+e);o;)i=Math.random()*o--|0,r=t[o+e],t[o+e]=t[i+e],t[i+e]=r;return t},t.sum=function(t,e){let n=0;if(void 0===e)for(let r of t)(r=+r)&&(n+=r);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n},t.thresholdFreedmanDiaconis=function(t,e,n){return Math.ceil((n-e)/(2*(T(t,.75)-T(t,.25))*Math.pow(s(t),-1/3)))},t.thresholdScott=function(t,e,n){return Math.ceil((n-e)/(3.5*h(t)*Math.pow(s(t),-1/3)))},t.thresholdSturges=O,t.tickIncrement=w,t.tickStep=k,t.ticks=function(t,e,n){var r,i,o,s,a=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(s=w(t,e,n))||!isFinite(s))return[];if(s>0)for(t=Math.ceil(t/s),e=Math.floor(e/s),o=new Array(i=Math.ceil(e-t+1));++a<i;)o[a]=(t+a)*s;else for(t=Math.floor(t*s),e=Math.ceil(e*s),o=new Array(i=Math.ceil(t-e+1));++a<i;)o[a]=(t-a)/s;return r&&o.reverse(),o},t.transpose=D,t.variance=l,t.zip=function(){return D(arguments)},Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof ji.exports?Si(ji.exports):"function"==typeof define&&define.amd?define(["exports"],Si):Si((xi=xi||self).d3=xi.d3||{}),ji=ji.exports;var Ti={};Object.defineProperty(Ti,"__esModule",{value:!0}),Ti.typeChecker=function(t){var e="[object "+t+"]";return function(t){return Ai(t)===e}};var Ai=function(t){return Object.prototype.toString.call(t)};Ti.comparable=function(t){return t instanceof Date?t.getTime():Ti.isArray(t)?t.map(Ti.comparable):t&&"function"==typeof t.toJSON?t.toJSON():t},Ti.isArray=Ti.typeChecker("Array"),Ti.isObject=Ti.typeChecker("Object"),Ti.isFunction=Ti.typeChecker("Function"),Ti.isVanillaObject=function(t){return t&&(t.constructor===Object||t.constructor===Array||"function Object() { [native code] }"===t.constructor.toString()||"function Array() { [native code] }"===t.constructor.toString())&&!t.toJSON},Ti.equals=function(t,e){if(null==t&&t==e)return!0;if(t===e)return!0;if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))return!1;if(Ti.isArray(t)){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(!Ti.equals(t[n],e[n]))return!1;return!0}if(Ti.isObject(t)){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t)if(!Ti.equals(t[i],e[i]))return!1;return!0}return!1};var Fi,Ni={},Di=this&&this.__extends||(Fi=function(t,e){return(Fi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Fi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Ii=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r};Object.defineProperty(Ni,"__esModule",{value:!0});var Mi=function(t,e,n,r,i,o){var s=e[r];if(Ti.isArray(t)&&isNaN(Number(s)))for(var a=0,u=t.length;a<u;a++)if(!Mi(t[a],e,n,r,a,t))return!1;return r===e.length||null==t?n(t,i,o):Mi(t[s],e,n,r+1,s,t)},Ri=function(){function t(t,e,n){this.params=t,this.owneryQuery=e,this.options=n,this.init()}return t.prototype.init=function(){},t.prototype.reset=function(){this.done=!1,this.success=!1},t}();Ni.BaseOperation=Ri;var Pi=function(t){function e(e,n,r,i){var o=t.call(this,e,n,r)||this;return o._children=i,o}return Di(e,t),e.prototype.reset=function(){this.success=!1,this.done=!1;for(var t=0,e=this._children.length;t<e;t++)this._children[t].reset()},e.prototype.childrenNext=function(t,e,n){for(var r=!0,i=!0,o=0,s=this._children.length;o<s;o++){var a=this._children[o];if(a.next(t,e,n),a.success||(i=!1),a.done){if(!a.success)break}else r=!1}this.done=r,this.success=i},e}(Ri);Ni.GroupOperation=Pi;var Li=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Di(e,t),e.prototype.next=function(t,e,n){this.childrenNext(t,e,n)},e}(Pi);Ni.QueryOperation=Li;var $i=function(t){function e(e,n,r,i,o){var s=t.call(this,n,r,i,o)||this;return s.keyPath=e,s._nextNestedValue=function(t,e,n){return s.childrenNext(t,e,n),!s.done},s}return Di(e,t),e.prototype.next=function(t,e,n){Mi(t,this.keyPath,this._nextNestedValue,0,e,n)},e}(Pi);Ni.NestedOperation=$i,Ni.createTester=function(t,e){if(t instanceof Function)return t;if(t instanceof RegExp)return function(e){return"string"==typeof e&&t.test(e)};var n=Ti.comparable(t);return function(t){return e(n,Ti.comparable(t))}};var Vi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Di(e,t),e.prototype.init=function(){this._test=Ni.createTester(this.params,this.options.compare)},e.prototype.next=function(t,e,n){this._test(t,e,n)&&(this.done=!0,this.success=!0)},e}(Ri);Ni.EqualsOperation=Vi,Ni.createEqualsOperation=function(t,e,n){return new Vi(t,e,n)};var Ui=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Di(e,t),e.prototype.next=function(){this.done=!0,this.success=!1},e}(Ri);Ni.NopeOperation=Ui,Ni.numericalOperationCreator=function(t){return function(e,n,r){return null==e?new Ui(e,n,r):t(e,n,r)}},Ni.numericalOperation=function(t){return Ni.numericalOperationCreator((function(e,n,r){var i=typeof Ti.comparable(e),o=t(e);return new Vi((function(t){return typeof Ti.comparable(t)===i&&o(t)}),n,r)}))};var qi=function(t,e,n,r){var i=r.operations[t];if(!i)throw new Error("Unsupported operation: "+t);return i(e,n,r)},zi=function(t,e,n,r){if(function(t){for(var e in t)if("$"===e.charAt(0))return!0;return!1}(e)){var i=Hi(e,r),o=i[0];if(i[1].length)throw new Error("Property queries must contain only operations, or exact objects.");return new $i(t,e,n,r,o)}return new $i(t,e,n,r,[new Vi(e,n,r)])};Ni.createQueryOperation=function(t,e,n){var r=Hi(t,n),i=r[0],o=r[1],s=Ii([new $i([],t,e,n,i)],o);return 1===s.length?s[0]:new Li(t,e,n,s)};var Hi=function(t,e){var n=[],r=[];if(!Ti.isVanillaObject(t))return n.push(new Vi(t,t,e)),[n,r];for(var i in t)if("$"===i.charAt(0)){var o=qi(i,t[i],t,e);null!=o&&n.push(o)}else r.push(zi(i.split("."),t[i],t,e));return[n,r]};Ni.createQueryTester=function(t,e){var n=void 0===e?{}:e,r=n.compare,i=n.operations,o=Ni.createQueryOperation(t,null,{compare:r||Ti.equals,operations:Object.assign({},i||{})});return function(t,e,n){return o.reset(),o.next(t,e,n),o.success}};var Bi={};(function(t){"use strict";var e,n=this&&this.__extends||(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,n)},function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(Bi,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.init=function(){this._test=Ni.createTester(this.params,this.options.compare)},e.prototype.reset=function(){t.prototype.reset.call(this),this.success=!0},e.prototype.next=function(t){this._test(t)&&(this.done=!0,this.success=!1)},e}(Ni.BaseOperation),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.init=function(){this._queryOperation=Ni.createQueryOperation(this.params,this.owneryQuery,this.options)},e.prototype.reset=function(){this._queryOperation.reset()},e.prototype.next=function(t,e,n){this._queryOperation.next(t,e,n),this.done=this._queryOperation.done,this.success=this._queryOperation.success},e}(Ni.BaseOperation),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.next=function(e,n,r){t.prototype.next.call(this,e,n,r),this.success=!this.success},e}(i),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.init=function(){var t=this;this._ops=this.params.map((function(e){return Ni.createQueryOperation(e,null,t.options)}))},e.prototype.reset=function(){this.done=!1,this.success=!1;for(var t=0,e=this._ops.length;t<e;t++)this._ops[t].reset()},e.prototype.next=function(t,e,n){for(var r=!1,i=!1,o=0,s=this._ops.length;o<s;o++){var a=this._ops[o];if(a.next(t,e,n),a.success){r=!0,i=a.success;break}}this.success=i,this.done=r},e}(Ni.BaseOperation),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.next=function(e,n,r){t.prototype.next.call(this,e,n,r),this.success=!this.success},e}(s),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.next=function(t,e,n){n.hasOwnProperty(e)===this.params&&(this.done=!0,this.success=!0)},e}(Ni.BaseOperation),c=function(t){function e(e,n,r){return t.call(this,e,n,r,e.map((function(t){return Ni.createQueryOperation(t,n,r)})))||this}return n(e,t),e.prototype.next=function(t,e,n){this.childrenNext(t,e,n)},e}(Ni.GroupOperation);Bi.$eq=function(t,e,n){return new Ni.EqualsOperation(t,e,n)},Bi.$ne=function(t,e,n){return new r(t,e,n)},Bi.$or=function(t,e,n){return new s(t,e,n)},Bi.$nor=function(t,e,n){return new a(t,e,n)},Bi.$elemMatch=function(t,e,n){return new i(t,e,n)},Bi.$nin=function(t,e,n){return new a(t,e,n)},Bi.$in=function(t,e,n){return new s(t,e,n)},Bi.$lt=Ni.numericalOperation((function(t){return function(e){return e<t}})),Bi.$lte=Ni.numericalOperation((function(t){return function(e){return e<=t}})),Bi.$gt=Ni.numericalOperation((function(t){return function(e){return e>t}})),Bi.$gte=Ni.numericalOperation((function(t){return function(e){return e>=t}})),Bi.$mod=function(t,e,n){var r=t[0],i=t[1];return new Ni.EqualsOperation((function(t){return Ti.comparable(t)%r===i}),e,n)},Bi.$exists=function(t,e,n){return new u(t,e,n)},Bi.$regex=function(t,e,n){return new Ni.EqualsOperation(new RegExp(t,e.$options),e,n)},Bi.$not=function(t,e,n){return new o(t,e,n)},Bi.$type=function(t,e,n){return new Ni.EqualsOperation((function(e){return null!=e&&(e instanceof t||e.constructor===t)}),e,n)},Bi.$and=function(t,e,n){return new c(t,e,n)},Bi.$all=Bi.$and,Bi.$size=function(t,e,n){return new Ni.EqualsOperation((function(e){return e&&e.length===t}),e,n)},Bi.$options=function(){return null},Bi.$where=function(e,n,r){var i;if(Ti.isFunction(e))i=e;else{if(t.env.CSP_ENABLED)throw new Error('In CSP mode, sift does not support strings in "$where" condition');i=new Function("obj","return "+e)}return new Ni.EqualsOperation((function(t){return i.bind(t)(t)}),n,r)}}).call(this,require("_process"));var Zi={};Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.createQueryTester=Ni.createQueryTester,Zi.EqualsOperation=Ni.EqualsOperation,Zi.createEqualsOperation=Ni.createEqualsOperation,function(t){for(var e in t)Zi.hasOwnProperty(e)||(Zi[e]=t[e])}(Bi),Zi.default=function(t,e){var n=void 0===e?{}:e,r=n.compare,i=n.operations;return Ni.createQueryTester(t,{compare:r,operations:Object.assign({},Bi,i)})};var Wi={};Wi=Zi.default,Object.assign(Wi,Zi);const{DateTime:Gi}=C;const{DateTime:Ji}=C;const Qi=async function(t,{db:e,ns:n,stream:r}){delete t.annotations[`${e}.${n}.${r}`]},Yi=async function(t,{db:e,ns:n,stream:r}){return t.annotations[`${e}.${n}.${r}`]},Xi=async function(t,{db:e}){},Ki=async function(t,{db:e}){t.events=t.events.filter(t=>t.meta.db!==e),t.index.events=bi(t.index.events,e+".")},to=Ci,eo=async function(t,{each:e}){const n=t.events.map(t=>t.meta.db).sort().filter((t,e,n)=>!e||t!==n[e-1]);for(const r of n)await e(r)},no=async function(t,{db:e,ns:n,stream:r,event:i}){const o=t.index.events[`${e}.${n}.${r}.${i}`];delete t.index.events[`${e}.${n}.${r}.${i}`],delete t.events[o]},ro=async function(t,{identity:e,db:n,ns:r,stream:i,event:o}){const s=t.index.events[`${n}.${r}.${i}.${o}`];return t.events[s]},io=async function(t,{identity:e,db:n,ns:r}){},oo=async function(t,{db:e,ns:n}){t.events=t.events.filter(t=>t.meta.db!==e||t.meta.ns!==n),t.index.events=bi(t.index.events,`${e}.${n}.`)},so=async function(t,{db:e,ns:n,from:r,after:i,to:o,until:s,types:a,filters:u,groupby:c,rollupto:l,limit:h,each:f}){let d=t.events.filter(t=>t.meta.db===e&&t.meta.ns===n);if(a&&(a=Array.isArray(a)?a:[a],d=d.filter(t=>a.some(e=>e===t.meta.type))),u&&u.forEach(t=>{let e={};Object.keys(t).forEach(n=>{n.startsWith("$")||n.startsWith("meta.")?e[n]=t[n]:e["data."+n]=t[n]}),d=d.filter(Wi(e))}),c&&c.timestamp)if(l){d=ji.rollup(d,t=>{let e={};for(const n of Object.keys(l))"$count"===l[n]&&(e[n]=t.length);return e},t=>Gi.fromISO(t.meta.ts).toFormat(c.timestamp));let t=[];for(let[e,n]of d){for(const t of Object.keys(l))if("$key"===l[t]){n[t]=e;break}t.push(n)}d=t}else d=ji.group(d,t=>Gi.fromISO(t.meta.ts).toFormat(c.timestamp));for(const p of d)await f(p)},ao=async function(t,{db:e,ns:n}){t.events=t.events.filter(t=>t.meta.db!==e||t.meta.ns!==n),t.index.events=bi(t.index.events,`${e}.${n}.`)},uo=async function(t,{db:e,each:n}){const r=t.events.filter(t=>t.meta.db===e).map(t=>t.meta.ns).sort().filter((t,e,n)=>!e||t!==n[e-1]);for(const i of r)await n(i)},co=async function(t,{db:e,id:n}){delete t.objects[n]},lo=async function(t,{db:e,id:n}){return t.objects[n]},ho=async function(t,{db:e,id:n,data:r}){t.objects[n]=r},fo=async function(t,{db:e,ns:n,stream:r,annotation:i}){t.annotations[`${e}.${n}.${r}`]=i},po=async function(t,{db:e,ns:n,stream:r}){t.events=t.events.filter(t=>t.meta.db!==e||t.meta.ns!==n||t.meta.stream!==r),t.index.events=bi(t.index.events,`${e}.${n}.${r}.`)},yo=async function(t,{db:e,ns:n,stream:r,from:i,after:o,to:s,until:a,types:u,limit:c,each:l}){let h=t.events.filter(t=>t.meta.db===e&&t.meta.ns===n&&t.meta.stream===r);if(u&&(u=Array.isArray(u)?u:[u],h=h.filter(t=>u.some(e=>ki.isMatch(t.meta.type,e)))),i){const t=h.findIndex(t=>t.meta.id===i);t>=0&&(h=h.slice(t))}if(o){const t=h.findIndex(t=>t.meta.id===o);t>=0&&(h=h.slice(t+1))}if(s){const t=h.findIndex(t=>t.meta.id===s);t>=0&&(h=h.slice(0,t+1))}if(a){const t=h.findIndex(t=>t.meta.id===a);t>=0&&(h=h.slice(0,t))}c&&(h.length=Math.min(h.length,c));for(const f of h)await l(f)},mo=async function(t,{db:e,ns:n,stream:r,data:i,meta:o,id:s}){const a={data:i||{},meta:{tz:Ji.local().zoneName,ts:(new Date).toISOString(),...o,id:s||Fr(),stream:r,ns:n,db:e}},u=t.events.push(a)-1;t.index.events[`${e}.${n}.${r}.${a.meta.id}`]=u;for(let c=0;c<t.subscriptions.length;c++){const e=t.subscriptions[c];let n=[a];const{db:r,ns:i,stream:o,types:s,limit:u,each:l}=e;n=n.filter(t=>!(t.meta.db!==r||t.meta.ns!==i&&i||t.meta.stream!==o&&o)),s&&(n=n.filter(t=>s.some(e=>ki.isMatch(t.meta.type,e))));for(const t of n)await l(t);e.count+=n.length}return a},vo=async function(t,{db:e,ns:n,each:r}){const i=t.events.filter(t=>t.meta.db===e&&t.meta.ns===n).map(t=>t.meta.stream).sort().filter((t,e,n)=>!e||t!==n[e-1]);for(const o of i)await r(o)};var go={exports:{}};!function(t){if("object"==typeof go.exports){var e=t(require,go.exports);void 0!==e&&(go.exports=e)}else"function"==typeof define&&define.amd&&define(["require","exports"],t)}((function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){this.scheme=t&&t.scheme||n.DEFAULT_SCHEME}format(t){if(!t)return this.scheme+"://localhost";if(this.scheme&&t.scheme&&this.scheme!==t.scheme)throw new Error("Scheme not supported: "+t.scheme);let e=(this.scheme||t.scheme||n.DEFAULT_SCHEME)+"://";return t.username&&(e+=encodeURIComponent(t.username),t.password&&(e+=":"+encodeURIComponent(t.password)),e+="@"),e+=this._formatAddress(t),t.endpoint&&(e+="/"+encodeURIComponent(t.endpoint)),t.options&&Object.keys(t.options).length>0&&(e+="?"+Object.keys(t.options).map(e=>encodeURIComponent(e)+"="+encodeURIComponent(t.options[e])).join("&")),e}parse(t){const e=new RegExp("^\\s*([^:]+)://(?:([^:@,/?=&]+)(?::([^:@,/?=&]+))?@)?([^@/?=&]+)(?:/([^:@,/?=&]+)?)?(?:\\?([^:@,/?]+)?)?\\s*$","gi"),n={};if(!t.includes("://"))throw new Error("No scheme found in URI "+t);const r=e.exec(t);if(Array.isArray(r)){if(n.scheme=r[1],this.scheme&&this.scheme!==n.scheme)throw new Error(`URI must start with '${this.scheme}://'`);n.username=r[2]?decodeURIComponent(r[2]):r[2],n.password=r[3]?decodeURIComponent(r[3]):r[3],n.hosts=this._parseAddress(r[4]),n.endpoint=r[5]?decodeURIComponent(r[5]):r[5],n.options=r[6]?this._parseOptions(r[6]):r[6]}return n}_formatAddress(t){return t.hosts.map(t=>encodeURIComponent(t.host)+(t.port?":"+encodeURIComponent(t.port.toString(10)):"")).join(",")}_parseAddress(t){return t.split(",").map(t=>{const e=t.indexOf(":");return e>=0?{host:decodeURIComponent(t.substring(0,e)),port:+t.substring(e+1)}:{host:decodeURIComponent(t)}})}_parseOptions(t){const e={};return t.split("&").forEach(t=>{const n=t.indexOf("=");n>=0&&(e[decodeURIComponent(t.substring(0,n))]=decodeURIComponent(t.substring(n+1)))}),e}}e.ConnectionStringParser=n,n.DEFAULT_SCHEME="db"})),go=go.exports;var _o={};(function(t){const e=class{constructor({credentials:t}){t&&(this.username=t.username,this.password=t.password)}get username(){return localStorage.getItem("username")}set username(t){localStorage.setItem("username",t)}async authenticate(t,{username:e,password:n}){localStorage.setItem("username",e),this.password=n,await t.details()}forget(){localStorage.removeItem("authorization"),localStorage.removeItem("username")}get credentials(){if(this.username||this.password)return{username:this.username,password:this.password}}async authorization(){return localStorage.getItem("authorization")||(this.credentials&&this.credentials.apikey?"Apikey "+this.credentials.apikey:this.credentials&&this.credentials.username&&this.credentials.password?"Basic "+(t=`${this.credentials.username}:${this.credentials.password}`,btoa(unescape(encodeURIComponent(t)))):void 0);var t}async authorized(t){localStorage.setItem("authorization",t)}async revoked(t){localStorage.removeItem("authorization")}},{ConnectionStringParser:i}=go;class o{async connect(t){if("[object String]"===Object.prototype.toString.call(t)){var e,r,i,o;const n=s.parse(t);n.host={name:null===(e=n.hosts)||void 0===e||null===(r=e[0])||void 0===r?void 0:r.host,port:null===(i=n.hosts)||void 0===i||null===(o=i[0])||void 0===o?void 0:o.port},n.host=n.host||{},t={server:`${"http"+(void 0===n.options.tls||"true"===n.options.tls?"s":"")}://${n.host.name}${n.host.port?":"+n.host.port:""}`,database:n.endpoint,credentials:{apikey:n.options.apikey,username:n.username,password:n.password}}}let u;return t||(t={server:null}),u=null===t.server?function(t){const e=new _i(null,t.database);t.authorization||t.authorized||(t.authorization=()=>e.authorization,t.authorized=t=>e.authorization=t);const r=new class{constructor(){this.type="local",this.store={events:[],index:{events:{}},annotations:{},objects:{},subscriptions:[]}}destroyAnnotation(t){return n.handle(()=>Qi(this.store,t))}readAnnotation(t){return n.handle(()=>Yi(this.store,t))}createDatabase(t){return n.handle(()=>Xi(this.store,t))}destroyDatabase(t){return n.handle(()=>Ki(this.store,t))}readDatabase(t){return n.handle(()=>to(this.store,t))}listDatabases(t){return n.handle(()=>eo(this.store,t))}destroyEvent(t){return n.handle(()=>no(this.store,t))}readEvent(t){return n.handle(()=>ro(this.store,t))}createNamespace(t){return n.handle(()=>io(this.store,t))}destroyNamespace(t){return n.handle(()=>oo(this.store,t))}readNamespace(t){return n.handle(()=>so(this.store,t))}truncateNamespace(t){return n.handle(()=>ao(this.store,t))}listNamespaces(t){return n.handle(()=>uo(this.store,t))}destroyObject(t){return n.handle(()=>co(this.store,t))}readObject(t){return n.handle(()=>lo(this.store,t))}writeObject(t){return n.handle(()=>ho(this.store,t))}annotateStream(t){return n.handle(()=>fo(this.store,t))}destroyStream(t){return n.handle(()=>po(this.store,t))}readStream(t){return n.handle(()=>yo(this.store,t))}writeStream(t){return n.handle(()=>mo(this.store,t))}listStreams(t){return n.handle(()=>vo(this.store,t))}}(t);return e.api=r,e}(t):t.server?a(t,t.server):a(t,`https://api${t&&t.environment?"-"+t.environment:""}.persistr.com`),t.database&&(u.db=new gi(t.database,u)),null===t.server&&(u.db=new gi("default",u)),u}}const s=new i({scheme:"persistr",hosts:[]});function a(t,e){const i=new _i(null,t.database);t.authorization||t.authorized||(t.authorization=()=>i.authorization,t.authorized=t=>i.authorization=t);const o=new class{constructor(t,e){this.type="persistr",this.identity=t,this.server=e,this.http=new class{constructor(t,e){this.server=t,this.identity=e,this.headers={}}url({endpoint:t,query:e}){return`${this.server}${t}${h(e)}`}async auth(){let t=void 0,e=void 0;var n;return this.identity&&this.identity.authorization&&(e=await this.identity.authorization()),e?t={authorization:e}:this.identity&&this.identity.credentials&&(this.identity.credentials.apikey?t={Authorization:"Apikey "+this.identity.credentials.apikey,...t}:this.identity.credentials.username&&void 0!==this.identity.credentials.password&&(t={Authorization:"Basic "+(n=`${this.identity.credentials.username}:${this.identity.credentials.password}`,r(unescape(encodeURIComponent(n)))),...t})),t}async fetch({method:t,endpoint:e,query:r,body:i,headers:o}){const s=`${this.server}${e}${h(r)}`;let a={method:t,headers:{...this.headers,...await this.auth(),"content-type":"application/json",...o},credentials:"same-origin",mode:"cors"};i&&(a.headers["content-type"]&&a.headers["content-type"].includes("json")?a.body=JSON.stringify(i):a.body=i);let u=void 0;try{u=await l(s,{...a})}catch(f){if("ECONNREFUSED"===f.code)throw new n.ConnectionRefused(this.server);throw new n.Fetch(f.message)}if(!u.ok)throw new n.StatusCode(s,u.status,u.statusText,await u.text());u.headers.has("Authorization")&&this.identity.authorized&&this.identity.authorized(u.headers.get("Authorization"));let c=await u.text();return c&&(u.headers.has("content-type")?u.headers.get("content-type").includes("json")&&(c=JSON.parse(c)):c=JSON.parse(c)),{body:c||""}}async get(t){return await this.fetch({...t,method:"GET"})}async post(t){return await this.fetch({...t,method:"POST"})}async put(t){return await this.fetch({...t,method:"PUT"})}async patch(t){return await this.fetch({...t,method:"PATCH"})}async delete(t){return await this.fetch({...t,method:"DELETE"})}}(this.server,this.identity)}async activateAccount(t){return n.handle(async()=>Rr.activateAccount(this.http,t))}async createAccount(t){return n.handle(async()=>Rr.createAccount(this.http,t))}async deactivateAccount(t){return n.handle(async()=>Rr.deactivateAccount(this.http,t))}async destroyAccount(t){return n.handle(async()=>Rr.destroyAccount(this.http,t))}async getAccount(t){return n.handle(async()=>Rr.getAccount(this.http,t))}async grantAccount(t){return n.handle(async()=>Rr.grantAccount(this.http,t))}async profileAccount(t){return n.handle(async()=>Rr.profileAccount(this.http,t))}async revokeAccount(t){return n.handle(async()=>Rr.revokeAccount(this.http,t))}async listAccounts(t){return n.handle(async()=>Rr.listAccounts(this.http,t))}async destroyAnnotation(t){return n.handle(async()=>Rr.destroyAnnotation(this.http,t))}async readAnnotation(t){return n.handle(async()=>Rr.readAnnotation(this.http,t))}async advanceCursor(t){return n.handle(async()=>Rr.advanceCursor(this.http,t))}async createCursor(t){return n.handle(async()=>Rr.createCursor(this.http,t))}async destroyCursor(t){return n.handle(async()=>Rr.destroyCursor(this.http,t))}async getCursor(t){return n.handle(async()=>Rr.getCursor(this.http,t))}async readCursor(t){return n.handle(async()=>Rr.readCursor(this.http,t))}async rewindCursor(t){return n.handle(async()=>Rr.rewindCursor(this.http,t))}async listCursors(t){return n.handle(async()=>Rr.listCursors(this.http,t))}async cloneDatabase(t){return n.handle(async()=>Rr.cloneDatabase(this.http,t))}async createDatabase(t){return n.handle(async()=>Rr.createDatabase(this.http,t))}async destroyDatabase(t){return n.handle(async()=>Rr.destroyDatabase(this.http,t))}async readDatabase(t){return n.handle(async()=>Rr.readDatabase(this.http,t))}async renameDatabase(t){return n.handle(async()=>Rr.renameDatabase(this.http,t))}async listDatabases(t){return n.handle(async()=>Rr.listDatabases(this.http,t))}async destroyEvent(t){return n.handle(async()=>Rr.destroyEvent(this.http,t))}async readEvent(t){return n.handle(async()=>Rr.readEvent(this.http,t))}async defineFunction(t){return n.handle(async()=>Rr.defineFunction(this.http,t))}async destroyFunction(t){return n.handle(async()=>Rr.destroyFunction(this.http,t))}async listFunctions(t){return n.handle(async()=>Rr.listFunctions(this.http,t))}async createNamespace(t){return n.handle(async()=>Rr.createNamespace(this.http,t))}async destroyNamespace(t){return n.handle(async()=>Rr.destroyNamespace(this.http,t))}async readNamespace(t){return n.handle(async()=>Rr.readNamespace(this.http,t))}async renameNamespace(t){return n.handle(async()=>Rr.renameNamespace(this.http,t))}async truncateNamespace(t){return n.handle(async()=>Rr.truncateNamespace(this.http,t))}async listNamespaces(t){return n.handle(async()=>Rr.listNamespaces(this.http,t))}async destroyObject(t){return n.handle(async()=>Rr.destroyObject(this.http,t))}async readObject(t){return n.handle(async()=>Rr.readObject(this.http,t))}async watchObject(t){return n.handle(async()=>Rr.watchObject(this.http,t))}async writeObject(t){return n.handle(async()=>Rr.writeObject(this.http,t))}async annotateStream(t){return n.handle(async()=>Rr.annotateStream(this.http,t))}async destroyStream(t){return n.handle(async()=>Rr.destroyStream(this.http,t))}async readStream(t){return n.handle(async()=>Rr.readStream(this.http,t))}async writeStream(t){return n.handle(async()=>Rr.writeStream(this.http,t))}async listStreams(t){return n.handle(async()=>Rr.listStreams(this.http,t))}async createTrigger(t){return n.handle(async()=>Rr.createTrigger(this.http,t))}async destroyTrigger(t){return n.handle(async()=>Rr.destroyTrigger(this.http,t))}async listTriggers(t){return n.handle(async()=>Rr.listTriggers(this.http,t))}}(t,e);return i.api=o,i}_o={Persistr:o,persistr:new o,Identity:e},"undefined"!=typeof window&&"[object Window]"==={}.toString.call(window)&&(t.persistr=_o.persistr)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}();